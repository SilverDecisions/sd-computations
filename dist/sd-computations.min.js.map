{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/idb/build/cjs/index.js","node_modules/idb/build/cjs/wrap-idb-value.js","src/computations-engine.js","src/computations-manager.js","src/computations-utils.js","src/expressions-evaluator.js","src/index.js","src/jobs/configurations/league-table/league-table-job-parameters.js","src/jobs/configurations/league-table/league-table-job.js","src/jobs/configurations/league-table/steps/calculate-step.js","src/jobs/configurations/payoffs-transformation/payoffs-transformation-job-parameters.js","src/jobs/configurations/payoffs-transformation/payoffs-transformation-job.js","src/jobs/configurations/recompute/recompute-job-parameters.js","src/jobs/configurations/recompute/recompute-job.js","src/jobs/configurations/sensitivity-analysis/n-way/sensitivity-analysis-job-parameters.js","src/jobs/configurations/sensitivity-analysis/n-way/sensitivity-analysis-job.js","src/jobs/configurations/sensitivity-analysis/n-way/steps/calculate-step.js","src/jobs/configurations/sensitivity-analysis/n-way/steps/init-policies-step.js","src/jobs/configurations/sensitivity-analysis/n-way/steps/prepare-variables-step.js","src/jobs/configurations/sensitivity-analysis/probabilistic/probabilistic-sensitivity-analysis-job-parameters.js","src/jobs/configurations/sensitivity-analysis/probabilistic/probabilistic-sensitivity-analysis-job.js","src/jobs/configurations/sensitivity-analysis/probabilistic/steps/compute-policy-stats-step.js","src/jobs/configurations/sensitivity-analysis/probabilistic/steps/prob-calculate-step.js","src/jobs/configurations/sensitivity-analysis/spider-plot/spider-plot-job-parameters.js","src/jobs/configurations/sensitivity-analysis/spider-plot/spider-plot-job.js","src/jobs/configurations/sensitivity-analysis/spider-plot/steps/calculate-step.js","src/jobs/configurations/sensitivity-analysis/tornado-diagram/steps/calculate-step.js","src/jobs/configurations/sensitivity-analysis/tornado-diagram/steps/prepare-variables-step.js","src/jobs/configurations/sensitivity-analysis/tornado-diagram/tornado-diagram-job-parameters.js","src/jobs/configurations/sensitivity-analysis/tornado-diagram/tornado-diagram-job.js","src/jobs/engine/batch/batch-step.js","src/jobs/engine/exceptions/extendable-error.js","src/jobs/engine/exceptions/index.js","src/jobs/engine/exceptions/job-computation-exception.js","src/jobs/engine/exceptions/job-data-invalid-exception.js","src/jobs/engine/exceptions/job-execution-already-running-exception.js","src/jobs/engine/exceptions/job-instance-already-complete-exception.js","src/jobs/engine/exceptions/job-interrupted-exception.js","src/jobs/engine/exceptions/job-parameters-invalid-exception.js","src/jobs/engine/exceptions/job-restart-exception.js","src/jobs/engine/execution-context.js","src/jobs/engine/index.js","src/jobs/engine/job-execution-flag.js","src/jobs/engine/job-execution-listener.js","src/jobs/engine/job-execution.js","src/jobs/engine/job-instance.js","src/jobs/engine/job-key-generator.js","src/jobs/engine/job-launcher.js","src/jobs/engine/job-parameter-definition.js","src/jobs/engine/job-parameters.js","src/jobs/engine/job-repository/idb-job-repository.js","src/jobs/engine/job-repository/job-repository.js","src/jobs/engine/job-repository/simple-job-repository.js","src/jobs/engine/job-repository/timeout-job-repository.js","src/jobs/engine/job-result.js","src/jobs/engine/job-status.js","src/jobs/engine/job.js","src/jobs/engine/simple-job.js","src/jobs/engine/step-execution-listener.js","src/jobs/engine/step-execution.js","src/jobs/engine/step.js","src/jobs/index.js","src/jobs/job-instance-manager.js","src/jobs/job-worker.js","src/jobs/jobs-manager.js","src/objective/objective-rules-manager.js","src/objective/rules/expected-value-maximization-rule.js","src/objective/rules/expected-value-minimization-rule.js","src/objective/rules/index.js","src/objective/rules/max-max-rule.js","src/objective/rules/max-min-rule.js","src/objective/rules/maxi-max-rule.js","src/objective/rules/maxi-min-rule.js","src/objective/rules/min-max-rule.js","src/objective/rules/min-min-rule.js","src/objective/rules/mini-max-rule.js","src/objective/rules/mini-min-rule.js","src/objective/rules/multi-criteria-rule.js","src/objective/rules/objective-rule.js","src/operations/flip-subtree.js","src/operations/job-executing-operation.js","src/operations/operation.js","src/operations/operations-manager.js","src/operations/payoffs-transformation.js","src/policies/decision.js","src/policies/policies-collector.js","src/policies/policy.js","src/validation/mcdm-weight-value-validator.js","src/validation/payoff-value-validator.js","src/validation/probability-value-validator.js","src/validation/tree-validator.js","index.js"],"names":["require","r","e","n","t","o","i","f","c","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","wrapIdbValue","readMethods","writeMethods","cachedMethods","Map","getMethod","target","prop","IDBDatabase","get","targetFuncName","replace","useIndex","isWrite","includes","IDBIndex","IDBObjectStore","prototype","method","_ref3","regeneratorRuntime","mark","_callee","storeName","_target","tx","_len","args","_key","_args","arguments","wrap","_context","prev","next","this","transaction","store","Array","index","shift","Promise","all","apply","done","abrupt","sent","stop","_x","set","replaceTraps","oldTraps","_objectSpread","receiver","has","unwrap","deleteDB","name","blocked","undefined","request","indexedDB","deleteDatabase","addEventListener","then","openDB","version","_ref","upgrade","blocking","terminated","open","openPromise","event","result","oldVersion","newVersion","db","catch","idbProxyableTypes","cursorAdvanceMethods","instanceOfAny","object","constructors","some","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","IDBTransaction","objectStoreNames","objectStore","wrapFunction","func","IDBCursor","advance","continue","continuePrimaryKey","_len2","_key2","_len3","_key3","storeNames","concat","sort","transformCachableValue","resolve","reject","unlisten","removeEventListener","complete","error","DOMException","cacheDonePromiseForTransaction","Proxy","IDBRequest","promise","success","newValue","callback","_sdUtils","_sdModel","_computationsManager","ComputationsEngineConfig","ComputationsManagerConfig","custom","_this","_classCallCheck","_super","logLevel","Utils","deepExtend","_assertThisInitialized","ComputationsEngine","ComputationsManager","config","data","_this2","_super2","global","getGlobalObject","isWorker","jobsManger","registerJobExecutionListener","beforeJob","jobExecution","reply","getDTO","afterJob","instance","queryableFunctions","runJob","jobName","jobParametersValues","dataDTO","DataModel","executeJob","jobExecutionId","execute","getErrorDTO","recompute","ruleName","evalCode","evalNumeric","objectiveRulesManager","setCurrentRuleByName","allRules","_checkValidityAndRecomputeObjective","onmessage","oEvent","hasOwnProperty","queryMethod","self","queryArguments","defaultReply","_get","_getPrototypeOf","setLogLevel","level","log","setLevel","message","TypeError","postMessage","queryMethodListener","queryMethodArguments","slice","_sdExpressionEngine","_objectiveRulesManager","_treeValidator","_operationsManager","_jobsManager","_expressionsEvaluator","_jobInstanceManager","_policy","_mcdmWeightValueValidator","worker","delegateRecomputation","url","jobRepositoryType","clearRepository","setConfig","expressionEngine","ExpressionEngine","expressionsEvaluator","ExpressionsEvaluator","ObjectiveRulesManager","JobsManager","workerUrl","repositoryType","operationsManager","OperationsManager","treeValidator","TreeValidator","mcdmWeightValueValidator","McdmWeightValueValidator","setData","checkValidityAndRecomputeObjective","params","getCurrentRule","d","getData","updateFrom","updateDisplayValues","updateDefaultCriterion1Weight","defaultCriterion1Weight","validationResults","evalExpressions","weightValid","validate","multiCriteria","getRoots","forEach","root","vr","getAllNodesInSubtree","push","isValid","recomputeTree","currentRule","getJobByName","operationsForObject","every","jobParamsValues","resolvePromiseAfterJobIsLaunched","run","jobInstanceManagerConfig","_this3","je","JobInstanceManager","operationName","performOperation","rules","getObjectiveRuleByName","isRuleName","reversePayoffs","tmp","weightLowerBound","flip","weightUpperBound","flipRule","Infinity","serialize","divide","_this4","policyToDisplay","displayPolicy","nodes","updateNodeDisplayValues","edges","updateEdgeDisplayValues","node","_this5","$DISPLAY_VALUE_NAMES","displayValue","getNodeDisplayValue","_this6","getEdgeDisplayValue","_this7","clearDisplayValues","displayPolicyForNode","policy","_this8","domain","DecisionNode","decision","Policy","getDecision","childEdge","childEdges","decisionValue","childNode","ChanceNode","TerminalNode","ComputationsUtils","min","max","extent","subtract","step","curr","add","toFloat","clearComputedValues","initScopes","debug","evalGlobalCode","clearTree","evalExpressionsForNode","clearExpressionScope","$codeDirty","$codeError","eval","expressionScope","edge","hasAssignmentExpression","payoff","parentNode","initScope","initScopeForNode","scope","probabilitySum","toNumber","hashEdges","invalidProb","rawPayoff","payoffIndex","path","isFieldValid","computedValue","evalPayoff","err","isHash","probability","warn","prob","compare","hash","parent","$parent","parentScope","cloneDeep","_computationsEngine","keys","key","enumerable","_index","_jobParameters","_jobParameterDefinition","LeagueTableJobParameters","JobParameters","definitions","JobParameterDefinition","PARAMETER_TYPE","STRING","BOOLEAN","NUMBER_EXPRESSION","v","allVals","computeNumberExpression","values","id","guid","nameOfCriterion1","nameOfCriterion2","extendedPolicyDescription","defaultWeight","_simpleJob","_calculateStep","_leagueTableJobParameters","LeagueTableJob","SimpleJob","jobRepository","initSteps","calculateStep","CalculateStep","addStep","jobResult","jobParameters","withHeaders","headers","payoffNames","rows","row","policies","rowCells","toPolicyString","payoffs","dominatedBy","extendedDominatedBy","incratio","optimal","optimalForDefaultWeight","_step","_jobStatus","_policiesCollector","Step","stepExecution","getJobParameters","rule","treeRoot","PoliciesCollector","payoffCoeffs","b","map","reduce","previousValue","currentValue","array","_prev$policies","_toConsumableArray","bestCost","bestCostRow","cmp","notDominated","filter","current","computeICER","splice","lastLELower","lastLELowerDef","sub","arr","exitStatus","JOB_STATUS","COMPLETED","Math","abs","PayoffsTransformationJobParameters","functionName","functionBody","functionArgumentName","makeClone","_payoffsTransformationJobParameters","_job","PayoffsTransformationJob","Job","$NAME","isRestartable","execution","findNodeById","rootTarget","cloneSubtree","allNodes","processNodePayoff","minY","Number","MAX_VALUE","maxY","MIN_VALUE","location","y","offset","move","attachSubtree","parentEdge","aggregatedPayoff","type","$TYPE","fill","computedBasePayoff","toFraction","RecomputeJobParameters","_recomputeJobParameters","RecomputeJob","SensitivityAnalysisJobParameters","NUMBER","INTEGER","isUnique","failOnInvalidTree","_sensitivityAnalysisJobParameters","_prepareVariablesStep","_initPoliciesStep","SensitivityAnalysisJob","batchSize","PrepareVariablesStep","InitPoliciesStep","chunkSize","variableNames","roundVariables","policyIndex","variables","_variables","uniqueValues","Set","uniqueValuesNo","s","size","precision","notReadyVariablesIndexes","variableIndex","notReadyIndex","val","round","newReadyIndexes","uniqueVals","reverse","stepExecutions","total","steps","getProgress","_batchStep","_jobComputationException","BatchStep","getJobExecutionContext","variableValues","executionContext","put","startIndex","item","clear","variableName","valid","errorData","JobComputationException","items","isString","_computationsUtils","sequence","cartesianProductOf","ProbabilisticSensitivityAnalysisJobParameters","_probabilisticSensitivityAnalysisJobParameters","_sensitivityAnalysisJob","_probCalculateStep","_computePolicyStatsStep","ProbabilisticSensitivityAnalysisJob","ProbCalculateStep","ComputePolicyStatsStep","numberOfRuns","ruleByName","payoffsPerPolicy","maximization","medians","median","standardDeviations","std","policyIsBestProbabilities","policyToHighestPayoffCount","policyToLowestPayoffCount","expectedValues","runIndex","singleRunVariableValues","errors","evaluated","formula","variable","currentItemCount","updatePolicyStats","highestPayoff","lowestPayoff","bestPolicyIndexes","worstPolicyIndexes","zeroNum","equals","SpiderPlotJobParameters","_spiderPlotJobParameters","SpiderPlotJob","percentageRangeValues","percentageChangeRange","policiesCollector","defaultValues","getGlobalVariableNames","defVal","multiply","defaultPayoff","itemIndex","variableValue","_jobResult$data$rows","jobExecutionContext","variableExtents","extents","extentVariableValues","TornadoDiagramJobParameters","_tornadoDiagramJobParameters","TornadoDiagramJob","_jobInterruptedException","count","TOTAL_ITEM_COUNT_PROP","CURRENT_ITEM_COUNT_PROP","init","totalItemCount","setCurrentItemCount","getCurrentItemCount","setTotalItemCount","handleNextChunk","JobInterruptedException","postProcess","getTotalItemCount","checkJobExecutionFlags","terminateOnly","readNextChunk","chunk","processChunk","processedChunk","writeChunk","res","updateJobProgress","processItem","progress","jobInstance","updateJobExecutionProgress","checkExecutionFlags","ExtendableError","constructor","_extendableError","_jobDataInvalidException","_jobExecutionAlreadyRunningException","_jobInstanceAlreadyCompleteException","_jobParametersInvalidException","_jobRestartException","JobDataInvalidException","JobExecutionAlreadyRunningException","JobInstanceAlreadyCompleteException","JobParametersInvalidException","JobRestartException","ExecutionContext","context","dirty","clone","prevValue","filteredProperties","deepClone","cloneMethod","cloneDeepWith","cloneWith","assign","stack","indexOf","$ObjectWithIdAndEditableFields","findById","exceptions","_interopRequireWildcard","_executionContext","_exportNames","_jobExecution","_jobExecutionFlag","_jobExecutionListener","_jobInstance","_jobKeyGenerator","_jobLauncher","_stepExecution","_stepExecutionListener","STOP","JobExecutionListener","JobExecution","status","STARTING","UNKNOWN","startTime","createTime","Date","endTime","lastUpdated","failureExceptions","stepName","StepExecution","STOPPING","se","JobInstance","JobKeyGenerator","identifying","JobLauncher","jobWorker","dataModelSerializer","jobOrName","job","createJobParameters","createJobExecution","executionPromise","_execute","getLastJobExecution","lastExecution","jobParametersValidator","jobDataValidator","jobExecutionOrId","getJobExecutionById","info","DATE","COMPOSITE","typeOrNestedParametersDefinitions","minOccurs","maxOccurs","singleValueValidator","validator","nestedParameters","required","isArray","parsed","parseFloat","allValues","validateSingleValue","isDate","isInt","isNumber","isBoolean","isObject","nestedDef","_value","initDefinitions","initDefaultValues","def","defs","split","find","getDefinition","_jobRepository","_idb","_jobResult","IdbJobRepository","JobRepository","expressionsReviver","dbName","initDB","dbPromise","createObjectStore","jobExecutionsOS","createIndex","unique","jobInstanceDao","ObjectStoreDao","jobExecutionDao","jobExecutionProgressDao","jobExecutionFlagDao","stepExecutionDao","jobResultDao","_","generateJobInstanceKey","remove","findJobExecutions","jobExecutions","removeJobExecution","getJobResultByInstance","removeJobResult","findStepExecutions","removeStepExecution","jobResultId","revive","dto","reviveJobResult","getByIndex","reviveJobInstance","_this9","stepExecutionsDTOs","saveStepExecutionsDTOS","flag","_this10","savedExecutions","stepExecutionDTO","_this11","fetchJobExecutionRelations","jobExecutionDTO","_this12","reviveJobExecution","jobExecutionDtoList","_this13","fetched","fetchJobExecutionsRelations","_this14","getAllByIndex","dtos","reviveStepExecution","_this15","fetchRelationsAndRevive","sorted","getTime","_this16","executions","latest","dataModel","loadFromDTO","reviveFromDTO","mergeWith","dtoValue","_this17","reviveExecutionContext","objValue","srcValue","source","stepDTO","_this18","getLastJobExecutionByInstance","jobExecutionDto","reviveResultData","JobResult","_this19","indexName","_this20","getAll","_this21","_this22","_this23","delete","_this24","_this25","getAllKeys","jobByName","saveJobInstance","getJobInstance","generateKey","isRunning","ABANDONED","createJobInstance","_setNewState","createStateSnapshot","instanceAndExecutionContext","saveJobExecution","saveStepExecution","SimpleJobRepository","jobInstancesByKey","executionProgress","executionFlags","jobResults","forOwn","ji","ex","_simpleJobRepository","TimeoutJobRepository","valueToResolve","delay","setTimeout","createTimeoutPromise","STARTED","STOPPED","FAILED","EXECUTING","executionListeners","getJobParametersValidator","getJobDataValidator","updateStatus","getResult","updateProgress","listener","doExecute","saveJobResult","update","getJobExecutionFlag","JOB_EXECUTION_FLAG","getJobResultByExecution","handleNextStep","lastExecutedStepExecution","_execution$failureExc","prevStep","prevStepExecution","stepIndex","handleStep","isStopping","getLastStepExecution","lastStepExecution","stepExecutionPartOfExistingJobExecution","currentStepExecution","shouldStart","createStepExecution","isCompleted","isRestart","skipExecution","skipOnRestartIfCompleted","containsKey","addStepExecution","_currentStepExecution","stepStatus","completedSteps","StepExecutionListener","beforeStep","determineJobStatus","afterStep","close","engine","_jobWorker","JobInstanceManagerConfig","onJobStarted","onJobCompleted","onJobFailed","onJobStopped","onJobTerminated","onProgress","updateInterval","jobInstanceOrExecution","checkProgress","lastJobExecution","_possibleConstructorReturn","getProgressPercents","lastUpdateTime","callbacksThisArg","deregisterJobExecutionListener","getProgressFromExecution","forceUpdate","terminate","JobWorker","defaultListener","onError","listeners","Worker","onerror","deserializer","fn","thisArg","sendQuery","ruleNames","_idbJobRepository","_recomputeJob","_probabilisticSensitivityAnalysisJob","_timeoutJobRepository","_tornadoDiagramJob","_leagueTableJob","_spiderPlotJob","_payoffsTransformationJob","JobsManagerConfig","jobExecutionListeners","afterJobExecutionPromiseResolves","jobInstancesToTerminate","useWorker","initWorker","initRepository","registerJobs","jobLauncher","serializeData","getJsonReviver","getJsonReplacer","getJobExecutionProgress","saveJobExecutionFlag","removeJobInstance","_arguments","argsDeserializer","addListener","onJobFatalError","sensitivityAnalysisJob","probabilisticSensitivityAnalysisJob","setBatchSize","registerJob","registerExecutionListener","l","promiseResolve","_rules","model","_minMaxRule","_maxMinRule","_minMinRule","_maxMaxRule","currentRuleName","flipPair","addRule","ExpectedValueMaximizationRule","ExpectedValueMinimizationRule","MaxiMinRule","MaxiMaxRule","MiniMinRule","MiniMaxRule","minMax","MinMaxRule","maxMin","MaxMinRule","addFlipPair","minMin","MinMinRule","maxMax","MaxMaxRule","flipped","setDefaultCriterion1Weight","decisionPolicy","trace","time","setPayoffIndex","setDecisionPolicy","computePayoff","computeOptimal","clearDecisionPolicy","computedBaseProbability","rule1","rule2","_objectiveRule","ObjectiveRule","NAME","probabilityToEnter","cValue","computedPayoff","basePayoff","_expectedValueMaximizationRule","_expectedValueMinimizationRule","_maxiMaxRule","_maxiMinRule","_miniMaxRule","_miniMinRule","_multiCriteriaRule","MultiCriteriaRule","bestChildPayoff","bestCount","worstChildPayoff","worstCount","optimalEdge","maxBy","minBy","criterion1Weight","childrenPayoff","selectedIndexes","bestChild","basePayoffs","childCombinedPayoff","baseProbability","sumweight","ep","div","computeCombinedPayoff","combinedPayoff","decisionNode","childrenPayoffs","best","makeDecision","_makeDecision","worstChild","childPayoff","modifyChanceProbability","fieldPath","_operation","FlipSubtree","Operation","isApplicable","grandchildrenNumber","grandchildrenEdgeLabels","childrenEdgeLabelsSet","child","trim","ge","rootClone","oldChildrenNumber","oldGrandChildrenNumber","childrenNumber","grandChildrenNumber","callbacksDisabled","childX","x","topY","stepY","removeNode","Point","addNode","j","grandChild","grandChildEdge","divideGrandChildEdgeProbability","_normalizeProbabilitiesAfterFlip","_fireNodeAddedCallback","newProbabilitySum","parseInt","rest","JobExecutingOperation","_flipSubtree","_payoffsTransformation","operations","operationByName","registerOperation","PayoffsTransformation","operation","op","getOperationByName","perform","_jobExecutingOperation","Decision","children","keyProperty","extended","indent","childrenRes","toDecisionString","_decision","optimalForRuleName","collect","decisions","nodeQueue","decisionNodes","cd","prependId","ignoreId","additionalValidator","maxSafeInteger","MAX_SAFE_INTEGER","PayoffValueValidator","ProbabilityValueValidator","_probabilityValueValidator","_payoffValueValidator","probabilityValueValidator","payoffValueValidator","validationResult","ValidationResult","validateNode","addError","setValueValidity","number","isNaN"],"mappings":"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","file":"sd-computations.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar wrapIdbValue = require('./wrap-idb-value.js');\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrapIdbValue.wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrapIdbValue.wrap(request.result), event.oldVersion, event.newVersion, wrapIdbValue.wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrapIdbValue.wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nwrapIdbValue.replaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexports.unwrap = wrapIdbValue.unwrap;\nexports.wrap = wrapIdbValue.wrap;\nexports.deleteDB = deleteDB;\nexports.openDB = openDB;\n","'use strict';\n\nconst instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexports.instanceOfAny = instanceOfAny;\nexports.replaceTraps = replaceTraps;\nexports.reverseTransformCache = reverseTransformCache;\nexports.unwrap = unwrap;\nexports.wrap = wrap;\n","import {Utils, log} from \"sd-utils\";\nimport {DataModel} from \"sd-model\";\nimport {ComputationsManager} from \"./computations-manager\";\nimport {ComputationsManagerConfig} from \"./computations-manager\";\n\n\n\nexport class ComputationsEngineConfig extends ComputationsManagerConfig{\n    logLevel = 'warn';\n    constructor(custom) {\n        super();\n        if (custom) {\n            Utils.deepExtend(this, custom);\n        }\n    }\n}\n\n/**\n * Entry point class for standalone computation workers\n */\nexport class ComputationsEngine extends ComputationsManager{\n\n    global = Utils.getGlobalObject();\n    isWorker = Utils.isWorker();\n\n    constructor(config, data){\n        super(config, data);\n\n        if(this.isWorker) {\n            this.jobsManger.registerJobExecutionListener({\n                beforeJob: (jobExecution)=>{\n                    this.reply('beforeJob', jobExecution.getDTO());\n                },\n\n                afterJob: (jobExecution)=>{\n                    this.reply('afterJob', jobExecution.getDTO());\n                }\n            });\n\n            var instance = this;\n            this.queryableFunctions = {\n                runJob: function(jobName, jobParametersValues, dataDTO){\n                    // console.log(jobName, jobParameters, serializedData);\n                    var data = new DataModel(dataDTO);\n                    instance.runJob(jobName, jobParametersValues, data);\n                },\n                executeJob: function(jobExecutionId){\n                    instance.jobsManger.execute(jobExecutionId).catch(e=>{\n                        instance.reply('jobFatalError', jobExecutionId, Utils.getErrorDTO(e));\n                    })\n                },\n                recompute: function(dataDTO, ruleName, evalCode, evalNumeric){\n                    if(ruleName){\n                        instance.objectiveRulesManager.setCurrentRuleByName(ruleName);\n                    }\n                    var allRules = !ruleName;\n                    var data = new DataModel(dataDTO);\n                    instance._checkValidityAndRecomputeObjective(data, allRules, evalCode, evalNumeric)\n                    this.reply('recomputed', data.getDTO());\n                }\n            };\n\n            global.onmessage = function(oEvent) {\n                if (oEvent.data instanceof Object && oEvent.data.hasOwnProperty('queryMethod') && oEvent.data.hasOwnProperty('queryArguments')) {\n                    instance.queryableFunctions[oEvent.data.queryMethod].apply(self, oEvent.data.queryArguments);\n                } else {\n                    instance.defaultReply(oEvent.data);\n                }\n            };\n        }\n    }\n\n\n\n    setConfig(config) {\n        super.setConfig(config);\n        if(this.config.logLevel){\n            this.setLogLevel(this.config.logLevel);\n        }\n\n        return this;\n    }\n\n    setLogLevel(level){\n        log.setLevel(level)\n    }\n\n    defaultReply(message) {\n        this.reply('test', message);\n    }\n\n    reply() {\n        if (arguments.length < 1) {\n            throw new TypeError('reply - not enough arguments');\n        }\n        this.global.postMessage({\n            'queryMethodListener': arguments[0],\n            'queryMethodArguments': Array.prototype.slice.call(arguments, 1)\n        });\n    }\n}\n\n","import {ExpressionEngine} from \"sd-expression-engine\";\nimport {Utils} from \"sd-utils\";\nimport {ObjectiveRulesManager} from \"./objective/objective-rules-manager\";\nimport {TreeValidator} from \"./validation/tree-validator\";\nimport {OperationsManager} from \"./operations/operations-manager\";\nimport {JobsManager} from \"./jobs/jobs-manager\";\nimport {ExpressionsEvaluator} from \"./expressions-evaluator\";\nimport {JobInstanceManager} from \"./jobs/job-instance-manager\";\nimport {domain as model} from \"sd-model\";\nimport {Policy} from \"./policies/policy\";\nimport {McdmWeightValueValidator} from \"./validation/mcdm-weight-value-validator\";\n\n/** Computation manager configuration object\n * @param custom configuration object to extend\n */\nexport class ComputationsManagerConfig {\n\n    /**\n     * logging level\n     * */\n    logLevel = null;\n\n    /**\n     * default objective rule name\n     * */\n    ruleName = null;\n\n    /**\n     * worker configuration object\n     * */\n    worker = {\n        /**\n         * delegate tree recomputation to worker\n         * */\n        delegateRecomputation: false,\n\n        /**\n         * worker url\n         * */\n        url: null\n    };\n\n    /**\n     * job repository to use, available types: idb, timeout, simple\n    * */\n    jobRepositoryType = 'idb';\n\n    /**\n     * clear repository after init\n     * */\n    clearRepository = false;\n\n    constructor(custom) {\n        if (custom) {\n            Utils.deepExtend(this, custom);\n        }\n    }\n}\n\n/** Computation manager\n* @param {object} config\n* @param {DataModel} data model object\n* */\nexport class ComputationsManager {\n\n    data;\n    expressionEngine;\n    expressionsEvaluator;\n    objectiveRulesManager;\n    operationsManager;\n    jobsManger;\n\n    treeValidator;\n\n    constructor(config, data = null) {\n        this.data = data;\n        this.setConfig(config);\n        this.expressionEngine = new ExpressionEngine();\n        this.expressionsEvaluator = new ExpressionsEvaluator(this.expressionEngine);\n        this.objectiveRulesManager = new ObjectiveRulesManager(this.expressionEngine, this.config.ruleName);\n\n        this.jobsManger = new JobsManager(this.expressionsEvaluator, this.objectiveRulesManager, {\n            workerUrl: this.config.worker.url,\n            repositoryType: this.config.jobRepositoryType,\n            clearRepository: this.config.clearRepository\n        });\n\n        this.operationsManager = new OperationsManager(this.data, this.expressionEngine, new JobsManager(this.expressionsEvaluator, this.objectiveRulesManager, {\n            repositoryType: 'timeout',\n        }));\n\n        this.treeValidator = new TreeValidator(this.expressionEngine);\n        this.mcdmWeightValueValidator = new McdmWeightValueValidator();\n    }\n\n    setConfig(config) {\n        this.config = new ComputationsManagerConfig(config);\n        return this;\n    }\n\n    setData(data){\n        this.data = data;\n        this.operationsManager.setData(data);\n    }\n\n\n    /** Alias function for checkValidityAndRecomputeObjective*/\n    recompute(){\n        return this.checkValidityAndRecomputeObjective(...arguments);\n    }\n\n    /**\n     * Checks validity of data model and recomputes objective rules\n     * @returns promise\n     * @param {boolean} allRules - recompute all objective rules\n     * @param {boolean} evalCode - evaluate code\n     * @param {boolean} evalNumeric - evaluate numeric expressions\n     */\n    checkValidityAndRecomputeObjective(allRules, evalCode = false, evalNumeric = true) {\n        return Promise.resolve().then(()=> {\n            if (this.config.worker.delegateRecomputation) {\n                var params = {\n                    evalCode: evalCode,\n                    evalNumeric: evalNumeric\n                };\n                if (!allRules) {\n                    params.ruleName = this.getCurrentRule().name;\n                }\n                return this.runJob(\"recompute\", params, this.data, false).then((jobExecution)=> {\n                    var d = jobExecution.getData();\n                    this.data.updateFrom(d)\n                })\n            }\n            return this._checkValidityAndRecomputeObjective(this.data, allRules, evalCode, evalNumeric);\n        }).then(()=> {\n            this.updateDisplayValues(this.data);\n        })\n\n    }\n\n    _checkValidityAndRecomputeObjective(data, allRules, evalCode = false, evalNumeric = true) {\n\n        this.objectiveRulesManager.updateDefaultCriterion1Weight(data.defaultCriterion1Weight);\n        data.validationResults = [];\n\n        if (evalCode || evalNumeric) {\n            this.expressionsEvaluator.evalExpressions(data, evalCode, evalNumeric);\n        }\n\n        var weightValid = this.mcdmWeightValueValidator.validate(data.defaultCriterion1Weight);\n        var multiCriteria = this.getCurrentRule().multiCriteria;\n\n\n        data.getRoots().forEach(root=> {\n            var vr = this.treeValidator.validate(data.getAllNodesInSubtree(root));\n            data.validationResults.push(vr);\n            if (vr.isValid() && (!multiCriteria || weightValid)) {\n                this.objectiveRulesManager.recomputeTree(root, allRules);\n            }\n        });\n    }\n\n    /**\n     * @returns {ObjectiveRule} current objective rule\n     * */\n    getCurrentRule() {\n        return this.objectiveRulesManager.currentRule;\n    }\n\n    /**\n     * Sets current objective rule\n     * @param {string} ruleName - name of objective rule\n     * */\n    setCurrentRuleByName(ruleName) {\n        this.config.ruleName = ruleName;\n        return this.objectiveRulesManager.setCurrentRuleByName(ruleName)\n    }\n\n    /**\n     *\n     *  @param {string} jobName\n     *  @returns {Job}\n     * */\n    getJobByName(jobName) {\n        return this.jobsManger.getJobByName(jobName);\n    }\n\n    /**\n     * @returns array of operations applicable to the given object (node or edge)\n     * @param object\n     */\n    operationsForObject(object) {\n        return this.operationsManager.operationsForObject(object);\n    }\n\n\n    /**\n     * Checks validity of data model without recomputation and revalidation\n     * @param {DataModel} data to check\n     */\n\n    isValid(data) {\n        data = data || this.data;\n        return data.validationResults.every(vr=>vr.isValid());\n    }\n    /**\n     * Run job\n     * @param {string} name - job name\n     * @param {object} jobParamsValues - job parameter values object\n     * @param {DataModel} data model\n     * @param {boolean} resolvePromiseAfterJobIsLaunched - immediately resolve promise with still running JobExecution\n     * @returns {Promise} resolving to JobExecution\n     */\n    runJob(name, jobParamsValues, data, resolvePromiseAfterJobIsLaunched = true) {\n        return this.jobsManger.run(name, jobParamsValues, data || this.data, resolvePromiseAfterJobIsLaunched)\n    }\n\n    /**\n     * Run job using JobInstanceManager\n     * @param {string} name - job name\n     * @param {object} jobParamsValues - job parameter values object\n     * @param {JobInstanceManagerConfig} jobInstanceManagerConfig - JobInstanceManager configuration\n     * @returns {Promise} resolving to JobInstanceManager\n     */\n    runJobWithInstanceManager(name, jobParamsValues, jobInstanceManagerConfig) {\n        return this.runJob(name, jobParamsValues).then(je=> {\n            return new JobInstanceManager(this.jobsManger, je, jobInstanceManagerConfig);\n        })\n    }\n\n    performOperation(object, operationName, jobParamsValues){\n        return this.operationsManager.performOperation(object, operationName, jobParamsValues);\n    }\n\n    getObjectiveRules() {\n        return this.objectiveRulesManager.rules;\n    }\n\n    getObjectiveRuleByName(ruleName){\n        return this.objectiveRulesManager.getObjectiveRuleByName(ruleName)\n    }\n\n    isRuleName(ruleName) {\n        return this.objectiveRulesManager.isRuleName(ruleName)\n    }\n\n\n    flipCriteria(data){\n        data = data || this.data;\n        data.reversePayoffs();\n        let tmp = data.weightLowerBound;\n        data.weightLowerBound = this.flip(data.weightUpperBound);\n        data.weightUpperBound = this.flip(tmp);\n        data.defaultCriterion1Weight = this.flip(data.defaultCriterion1Weight);\n        this.objectiveRulesManager.flipRule();\n        return this.checkValidityAndRecomputeObjective(false);\n    }\n\n    flip(a){\n        if(a == Infinity){\n            return 0;\n        }\n\n        if(a == 0){\n            return Infinity;\n        }\n\n        return this.expressionEngine.serialize(ExpressionEngine.divide(1, a))\n    }\n\n    updateDisplayValues(data, policyToDisplay = null) {\n        data = data || this.data;\n        if (policyToDisplay) {\n            return this.displayPolicy(data, policyToDisplay);\n        }\n\n        data.nodes.forEach(n=> {\n            this.updateNodeDisplayValues(n);\n        });\n        data.edges.forEach(e=> {\n            this.updateEdgeDisplayValues(e);\n        })\n    }\n\n    updateNodeDisplayValues(node) {\n        node.$DISPLAY_VALUE_NAMES.forEach(n=>node.displayValue(n, this.objectiveRulesManager.getNodeDisplayValue(node, n)));\n    }\n\n    updateEdgeDisplayValues(e) {\n        e.$DISPLAY_VALUE_NAMES.forEach(n=>e.displayValue(n, this.objectiveRulesManager.getEdgeDisplayValue(e, n)));\n    }\n\n    displayPolicy(policyToDisplay, data) {\n\n\n        data = data || this.data;\n        data.nodes.forEach(n=> {\n            n.clearDisplayValues();\n        });\n        data.edges.forEach(e=> {\n            e.clearDisplayValues();\n        });\n        data.getRoots().forEach((root)=>this.displayPolicyForNode(root, policyToDisplay));\n    }\n\n    displayPolicyForNode(node, policy) {\n        if (node instanceof model.DecisionNode) {\n            var decision = Policy.getDecision(policy, node);\n            //console.log(decision, node, policy);\n            if (decision) {\n                node.displayValue('optimal', true)\n                var childEdge = node.childEdges[decision.decisionValue];\n                childEdge.displayValue('optimal', true)\n                return this.displayPolicyForNode(childEdge.childNode, policy)\n            }\n            return;\n        } else if(node instanceof model.ChanceNode){\n            node.displayValue('optimal', true);\n            node.childEdges.forEach(e=>{\n                e.displayValue('optimal', true);\n                this.displayPolicyForNode(e.childNode, policy)\n            })\n        }else if(node instanceof model.TerminalNode){\n            node.displayValue('optimal', true);\n        }\n\n\n    }\n}\n","import {ExpressionEngine} from \"sd-expression-engine\";\nexport class ComputationsUtils{\n\n    static sequence(min, max, length) {\n        var extent = ExpressionEngine.subtract(max, min);\n        var result = [min];\n        var steps = length - 1;\n        if(!steps){\n            return result;\n        }\n        var step = ExpressionEngine.divide(extent,length - 1);\n        var curr = min;\n        for (var i = 0; i < length - 2; i++) {\n            curr = ExpressionEngine.add(curr, step);\n            result.push(ExpressionEngine.toFloat(curr));\n        }\n        result.push(max);\n        return result;\n    }\n}\n","import {ExpressionEngine} from \"sd-expression-engine\";\nimport {domain as model} from 'sd-model'\nimport {Utils, log} from 'sd-utils'\n\n/*Evaluates code and expressions in trees*/\nexport class ExpressionsEvaluator {\n    expressionEngine;\n    constructor(expressionEngine){\n        this.expressionEngine = expressionEngine;\n    }\n\n    clear(data){\n        data.nodes.forEach(n=>{\n            n.clearComputedValues();\n        });\n        data.edges.forEach(e=>{\n            e.clearComputedValues();\n        });\n    }\n\n    clearTree(data, root){\n        data.getAllNodesInSubtree(root).forEach(n=>{\n            n.clearComputedValues();\n            n.childEdges.forEach(e=>{\n                e.clearComputedValues();\n            })\n        })\n    }\n\n    evalExpressions(data, evalCode=true, evalNumeric=true, initScopes=false){\n        log.debug('evalExpressions evalCode:'+evalCode+' evalNumeric:'+evalNumeric);\n        if(evalCode){\n            this.evalGlobalCode(data);\n        }\n\n        data.getRoots().forEach(n=>{\n            this.clearTree(data, n);\n            this.evalExpressionsForNode(data, n, evalCode, evalNumeric,initScopes);\n        });\n\n    }\n\n    evalGlobalCode(data){\n        data.clearExpressionScope();\n        data.$codeDirty = false;\n        try{\n            data.$codeError = null;\n            this.expressionEngine.eval(data.code, false, data.expressionScope);\n        }catch (e){\n            data.$codeError = e;\n        }\n    }\n\n    evalPayoff(edge, index = 0) {\n        if (ExpressionEngine.hasAssignmentExpression(edge.payoff[index])) {\n            return null;\n        }\n        return this.expressionEngine.eval(edge.payoff[index], true, edge.parentNode.expressionScope);\n    }\n\n    evalExpressionsForNode(data, node, evalCode=true, evalNumeric=true, initScope=false) {\n        if(!node.expressionScope || initScope || evalCode){\n            this.initScopeForNode(data, node);\n        }\n        if(evalCode){\n            node.$codeDirty = false;\n            if(node.code){\n                try{\n                    node.$codeError = null;\n                    this.expressionEngine.eval(node.code, false, node.expressionScope);\n                }catch (e){\n                    node.$codeError = e;\n                    log.debug(e);\n                }\n            }\n        }\n\n        if(evalNumeric){\n            var scope = node.expressionScope;\n            var probabilitySum=ExpressionEngine.toNumber(0);\n            var hashEdges= [];\n            var invalidProb = false;\n\n            node.childEdges.forEach(e=>{\n                e.payoff.forEach((rawPayoff, payoffIndex)=> {\n                    let path = 'payoff[' + payoffIndex + ']';\n                    if(e.isFieldValid(path, true, false)){\n                        try{\n                            e.computedValue(null, path, this.evalPayoff(e, payoffIndex))\n                        }catch (err){\n                            //   Left empty intentionally\n                        }\n                    }\n                });\n\n\n\n                if(node instanceof model.ChanceNode){\n                    if(ExpressionEngine.isHash(e.probability)){\n                        hashEdges.push(e);\n                        return;\n                    }\n\n                    if(ExpressionEngine.hasAssignmentExpression(e.probability)){ //It should not occur here!\n                        log.warn(\"evalExpressionsForNode hasAssignmentExpression!\", e);\n                        return null;\n                    }\n\n                    if(e.isFieldValid('probability', true, false)){\n                        try{\n                            var prob = this.expressionEngine.eval(e.probability, true, scope);\n                            e.computedValue(null, 'probability', prob);\n                            probabilitySum = ExpressionEngine.add(probabilitySum, prob);\n                        }catch (err){\n                            invalidProb = true;\n                        }\n                    }else{\n                        invalidProb = true;\n                    }\n                }\n\n            });\n\n\n            if(node instanceof model.ChanceNode){\n                var computeHash = hashEdges.length && !invalidProb && (probabilitySum.compare(0) >= 0 && probabilitySum.compare(1) <= 0);\n\n                if(computeHash) {\n                    var hash = ExpressionEngine.divide(ExpressionEngine.subtract(1, probabilitySum), hashEdges.length);\n                    hashEdges.forEach(e=> {\n                        e.computedValue(null, 'probability', hash);\n                    });\n                }\n            }\n\n            node.childEdges.forEach(e=>{\n                this.evalExpressionsForNode(data, e.childNode, evalCode, evalNumeric, initScope);\n            });\n        }\n    }\n\n    initScopeForNode(data, node){\n        var parent = node.$parent;\n        var parentScope = parent?parent.expressionScope : data.expressionScope;\n        node.expressionScope = Utils.cloneDeep(parentScope);\n    }\n}\n","export * from './computations-engine'\nexport * from './computations-manager'\nexport * from './expressions-evaluator'\nexport * from './jobs/index'\n\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../engine/job-parameter-definition\";\n\nexport class LeagueTableJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"ruleName\", PARAMETER_TYPE.STRING));\n        this.definitions.push(new JobParameterDefinition(\"extendedPolicyDescription\", PARAMETER_TYPE.BOOLEAN));\n        this.definitions.push(new JobParameterDefinition(\"weightLowerBound\", PARAMETER_TYPE.NUMBER_EXPRESSION).set(\"singleValueValidator\", (v, allVals) => {\n            return v >= 0 && v <= JobParameterDefinition.computeNumberExpression(allVals['weightUpperBound'])\n        }));\n        this.definitions.push(new JobParameterDefinition(\"defaultWeight\", PARAMETER_TYPE.NUMBER_EXPRESSION).set(\"singleValueValidator\", (v, allVals) => {\n            return v >= 0 && v >= JobParameterDefinition.computeNumberExpression(allVals['weightLowerBound']) && v <= JobParameterDefinition.computeNumberExpression(allVals['weightUpperBound'])\n        }));\n        this.definitions.push(new JobParameterDefinition(\"weightUpperBound\", PARAMETER_TYPE.NUMBER_EXPRESSION).set(\"singleValueValidator\", (v, allVals) => {\n            return v >= 0 && v >= JobParameterDefinition.computeNumberExpression(allVals['weightLowerBound'])\n        }));\n\n    }\n\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            nameOfCriterion1: 'Cost',\n            nameOfCriterion2: 'Effect',\n            extendedPolicyDescription: true,\n            weightLowerBound: 0,\n            defaultWeight: 0,\n            weightUpperBound: Infinity,\n        }\n    }\n}\n","import {SimpleJob} from \"../../engine/simple-job\";\nimport {Policy} from \"../../../policies/policy\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {CalculateStep} from \"./steps/calculate-step\";\nimport {LeagueTableJobParameters} from \"./league-table-job-parameters\";\n\n\nexport class LeagueTableJob extends SimpleJob {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"league-table\", jobRepository, expressionsEvaluator, objectiveRulesManager);\n        this.initSteps();\n    }\n\n    initSteps() {\n        this.calculateStep = new CalculateStep(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager);\n        this.addStep(this.calculateStep);\n    }\n\n    createJobParameters(values) {\n        return new LeagueTableJobParameters(values);\n    }\n\n    getJobDataValidator() {\n        return {\n            validate: (data) => data.getRoots().length === 1\n        }\n    }\n\n    jobResultToCsvRows(jobResult, jobParameters, withHeaders = true) {\n        var result = [];\n        if (withHeaders) {\n            var headers = ['policy_id', 'policy', jobResult.payoffNames[0], jobResult.payoffNames[1], 'dominated_by', 'extended-dominated_by', 'incratio', 'optimal', 'optimal_for_default_weight'];\n            result.push(headers);\n        }\n\n        jobResult.rows.forEach(row => {\n            row.policies.forEach(policy=> {\n                var rowCells = [\n                    row.id,\n                    Policy.toPolicyString(policy, jobParameters.values.extendedPolicyDescription),\n                    row.payoffs[1],\n                    row.payoffs[0],\n                    row.dominatedBy,\n                    row.extendedDominatedBy === null ? null : row.extendedDominatedBy[0] + ', ' + row.extendedDominatedBy[1],\n                    row.incratio,\n                    row.optimal,\n                    row.optimalForDefaultWeight\n                ];\n                result.push(rowCells);\n            })\n        });\n\n        return result;\n    }\n}\n","import {Step} from \"../../../engine/step\";\nimport {JOB_STATUS} from \"../../../engine/job-status\";\nimport {PoliciesCollector} from \"../../../../policies/policies-collector\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {TreeValidator} from \"../../../../validation/tree-validator\";\n\nexport class CalculateStep extends Step {\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"calculate_step\", jobRepository);\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n        this.treeValidator = new TreeValidator();\n    }\n\n    doExecute(stepExecution, jobResult) {\n        var data = stepExecution.getData();\n        var params = stepExecution.getJobParameters();\n        var ruleName = params.value(\"ruleName\");\n        this.objectiveRulesManager.setCurrentRuleByName(ruleName);\n        let rule = this.objectiveRulesManager.currentRule;\n        var treeRoot = data.getRoots()[0];\n        var policiesCollector = new PoliciesCollector(treeRoot);\n\n        var policies = policiesCollector.policies;\n\n\n        var payoffCoeffs = this.payoffCoeffs = rule.payoffCoeffs;\n\n        this.expressionsEvaluator.evalExpressions(data);\n        var vr = this.treeValidator.validate(data.getAllNodesInSubtree(treeRoot));\n\n        if (!vr.isValid()) {\n            return stepExecution;\n        }\n\n        var compare = (a, b)=>(-payoffCoeffs[0] *  (b.payoffs[0] - a.payoffs[0])) || (-payoffCoeffs[1] *  (a.payoffs[1] - b.payoffs[1]));\n\n        var rows = policies.map(policy => {\n            this.objectiveRulesManager.recomputeTree(treeRoot, false, policy);\n            return {\n                policies: [policy],\n                payoffs: treeRoot.computedValue(ruleName, 'payoff').slice(),\n                dominatedBy: null,\n                extendedDominatedBy: null,\n                incratio: null,\n                optimal: false,\n                optimalForDefaultWeight: false\n            }\n        }).sort(compare);\n\n        rows = rows.reduce((previousValue, currentValue, index, array)=>{\n            if(!previousValue.length){\n                return [currentValue]\n            }\n\n            let prev = previousValue[previousValue.length-1];\n            if(compare(prev, currentValue) == 0){\n                prev.policies.push(...currentValue.policies);\n                return previousValue\n            }\n            return previousValue.concat(currentValue)\n        }, []);\n\n        rows.sort((a, b)=>(payoffCoeffs[0] *  (a.payoffs[0] - b.payoffs[0])) || (-payoffCoeffs[1] *   (a.payoffs[1] - b.payoffs[1])));\n        rows.forEach((r, i)=> {\n            r.id = i+1;\n        });\n        // rows.sort(compare);\n        rows.sort((a, b)=>(-payoffCoeffs[0] *  (a.payoffs[0] - b.payoffs[0])) || (-payoffCoeffs[1] *   (a.payoffs[1] - b.payoffs[1])));\n\n        let bestCost = -payoffCoeffs[1] * Infinity,\n            bestCostRow = null;\n\n        let cmp= (a, b) => a > b;\n        if(payoffCoeffs[1]<0){\n            cmp= (a, b) => a < b;\n        }\n\n        rows.forEach((r, i)=> {\n            if (cmp(r.payoffs[1], bestCost)) {\n                bestCost = r.payoffs[1];\n                bestCostRow = r;\n            } else if(bestCostRow) {\n                r.dominatedBy = bestCostRow.id;\n            }\n        });\n\n        cmp = (a, b) => a < b;\n        if(payoffCoeffs[0] > 0 && payoffCoeffs[1] < 0){\n            cmp = (a, b) => a < b;\n        }else if(payoffCoeffs[0] < 0 && payoffCoeffs[1] > 0){\n            cmp = (a, b) => a < b;\n        }else if(payoffCoeffs[1]<0){\n            cmp = (a, b) => a > b;\n        }\n\n        const notDominated = rows.filter(r => !r.dominatedBy).sort((a, b) => (payoffCoeffs[0] * (a.payoffs[0] - b.payoffs[0])));\n        if (notDominated.length) {\n\n            notDominated[0].incratio = 0\n            let i = 1;\n            while (i < notDominated.length && notDominated.length > 1) {\n                let current = notDominated[i];\n                let prev = notDominated[i - 1];\n\n                current.incratio = this.computeICER(current, prev);\n\n                if (cmp(current.incratio, prev.incratio)) {\n                    prev.incratio = null;\n                    prev.extendedDominatedBy = [notDominated[i - 2].id, current.id];\n                    notDominated.splice(i - 1, 1);\n                    i--;\n                } else {\n                    i++;\n                }\n            }\n        }\n\n        let weightLowerBound = params.value(\"weightLowerBound\");\n        let defaultWeight = params.value(\"defaultWeight\");\n        let weightUpperBound = params.value(\"weightUpperBound\");\n\n        //mark optimal for weight in [weightLowerBound, weightUpperBound] and optimal for default Weight\n        let lastLELower = null;\n        let lastLELowerDef = null;\n        rows.slice().filter(r=>!r.dominatedBy && !r.extendedDominatedBy).sort((a, b) => {\n            let sub = a.incratio - b.incratio;\n            return sub ? sub : payoffCoeffs[0] * (a.payoffs[0] - b.payoffs[0])\n        }).forEach((row, i, arr)=>{\n\n            if(row.incratio < weightLowerBound){\n                lastLELower  = row;\n            }\n            if(row.incratio < defaultWeight){\n                lastLELowerDef  = row;\n            }\n\n            row.optimal = row.incratio >= weightLowerBound && row.incratio <= weightUpperBound;\n            row.optimalForDefaultWeight = row.incratio == defaultWeight;\n\n        });\n        if(lastLELower){\n            lastLELower.optimal = true;\n        }\n\n        if(lastLELowerDef){\n            lastLELowerDef.optimalForDefaultWeight = true;\n        }\n\n        rows.forEach(row=>{\n            row.payoffs[0] =  ExpressionEngine.toFloat(row.payoffs[0]);\n            row.payoffs[1] =  ExpressionEngine.toFloat(row.payoffs[1]);\n            row.incratio = row.incratio === null ? null : ExpressionEngine.toFloat(row.incratio);\n        });\n\n        jobResult.data = {\n            payoffNames: data.payoffNames.slice(),\n            payoffCoeffs : payoffCoeffs,\n            rows: rows.sort((a, b)=>(a.id - b.id)),\n            weightLowerBound: ExpressionEngine.toFloat(weightLowerBound),\n            defaultWeight: ExpressionEngine.toFloat(defaultWeight),\n            weightUpperBound: ExpressionEngine.toFloat(weightUpperBound)\n        };\n\n        stepExecution.exitStatus = JOB_STATUS.COMPLETED;\n        return stepExecution;\n    }\n\n    computeICER(r, prev){\n        let d = ExpressionEngine.subtract(r.payoffs[0], prev.payoffs[0]);\n        let n = ExpressionEngine.subtract(r.payoffs[1], prev.payoffs[1]);\n        if (d == 0){\n            if(n<0){\n                return - Infinity;\n            }\n            return Infinity;\n        }\n        return Math.abs(ExpressionEngine.divide(n, d));\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../engine/job-parameter-definition\";\nexport class PayoffsTransformationJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"objectId\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"functionName\", PARAMETER_TYPE.STRING).set('required', true));\n        this.definitions.push(new JobParameterDefinition(\"functionBody\", PARAMETER_TYPE.STRING).set('required', true));\n        this.definitions.push(new JobParameterDefinition(\"functionArgumentName\", PARAMETER_TYPE.STRING).set('required', true));\n        this.definitions.push(new JobParameterDefinition(\"makeClone\", PARAMETER_TYPE.BOOLEAN));\n    }\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            functionName: 'transformPayoff',\n            functionBody: 'log(p)',\n            functionArgumentName: 'p',\n            makeClone: true\n        }\n    }\n}\n","import {SimpleJob} from \"../../engine/simple-job\";\nimport {Step} from \"../../engine/step\";\nimport {JOB_STATUS} from \"../../engine/job-status\";\nimport {TreeValidator} from \"../../../validation/tree-validator\";\n\nimport {PayoffsTransformationJobParameters} from \"./payoffs-transformation-job-parameters\";\nimport {Job} from \"../../engine/job\";\nimport {domain as model} from \"sd-model\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\n\nexport class PayoffsTransformationJob extends Job {\n\n    static $NAME = 'payoffs-transformation';\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(PayoffsTransformationJob.$NAME, jobRepository);\n        this.isRestartable = false;\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n        this.treeValidator = new TreeValidator();\n    }\n\n    doExecute(execution) {\n        var data = execution.getData();\n        var params = execution.jobParameters;\n        let functionName = params.value(\"functionName\");\n\n        const root = data.findNodeById(params.value(\"objectId\"));\n\n        let makeClone = params.value(\"makeClone\");\n\n        let rootTarget = makeClone ? data.cloneSubtree(root, true) : root;\n\n\n        rootTarget.code += '\\n' + functionName + '('+ params.value('functionArgumentName') + ') = ' + params.value('functionBody');\n\n        let allNodes = data.getAllNodesInSubtree(rootTarget);\n\n\n        this.processNodePayoff(rootTarget, params);\n\n        if(makeClone){\n            let minY = Number.MAX_VALUE;\n            let maxY = Number.MIN_VALUE;\n            allNodes.forEach(n => {\n                if (n.location.y < minY) {\n                    minY = n.location.y;\n                }\n                if (n.location.y > maxY) {\n                    maxY = n.location.y;\n                }\n\n            });\n\n            let extentY = maxY - minY;\n            let margin = 30;\n            let offset = extentY + margin;\n\n\n            rootTarget.move(0, offset);\n            data.attachSubtree(rootTarget);\n        }\n\n        return execution;\n    }\n\n    processNodePayoff(node, params, parentEdge = null, aggregatedPayoff = [0, 0]){\n        if(node.type === model.TerminalNode.$TYPE){\n            parentEdge.payoff = aggregatedPayoff.map(p => params.value(\"functionName\") + '(' + ExpressionEngine.toNumber(p).toFraction(false) + ')');\n            return;\n        }\n\n        if (parentEdge) {\n            parentEdge.payoff.fill(0);\n        }\n\n\n        node.childEdges.forEach((e) => {\n            this.processNodePayoff(e.childNode, params, e, aggregatedPayoff.map((p,i) => ExpressionEngine.add(p, e.computedBasePayoff(undefined, i))))\n        })\n    }\n\n    createJobParameters(values) {\n        return new PayoffsTransformationJobParameters(values);\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../engine/job-parameter-definition\";\nexport class RecomputeJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"ruleName\", PARAMETER_TYPE.STRING).set('required', false));\n        this.definitions.push(new JobParameterDefinition(\"evalCode\", PARAMETER_TYPE.BOOLEAN));\n        this.definitions.push(new JobParameterDefinition(\"evalNumeric\", PARAMETER_TYPE.BOOLEAN));\n    }\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            ruleName: null, //recompute all rules\n            evalCode: true,\n            evalNumeric: true\n        }\n    }\n}\n","import {SimpleJob} from \"../../engine/simple-job\";\nimport {Step} from \"../../engine/step\";\nimport {JOB_STATUS} from \"../../engine/job-status\";\nimport {TreeValidator} from \"../../../validation/tree-validator\";\nimport {BatchStep} from \"../../engine/batch/batch-step\";\nimport {RecomputeJobParameters} from \"./recompute-job-parameters\";\nimport {Job} from \"../../engine/job\";\n\nexport class RecomputeJob extends Job {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"recompute\", jobRepository);\n        this.isRestartable = false;\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n        this.treeValidator = new TreeValidator();\n    }\n\n    doExecute(execution) {\n        var data = execution.getData();\n        var params = execution.jobParameters;\n        var ruleName = params.value(\"ruleName\");\n        var allRules = !ruleName;\n        if(ruleName){\n            this.objectiveRulesManager.setCurrentRuleByName(ruleName);\n        }\n        this.checkValidityAndRecomputeObjective(data, allRules, params.value(\"evalCode\"), params.value(\"evalNumeric\"))\n        return execution;\n    }\n\n    checkValidityAndRecomputeObjective(data, allRules, evalCode, evalNumeric) {\n        data.validationResults = [];\n\n        if(evalCode||evalNumeric){\n            this.expressionsEvaluator.evalExpressions(data, evalCode, evalNumeric);\n        }\n\n        data.getRoots().forEach(root=> {\n            var vr = this.treeValidator.validate(data.getAllNodesInSubtree(root));\n            data.validationResults.push(vr);\n            if (vr.isValid()) {\n                this.objectiveRulesManager.recomputeTree(root, allRules);\n            }\n        });\n    }\n\n    createJobParameters(values) {\n        return new RecomputeJobParameters(values);\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../../engine/job-parameter-definition\";\nexport class SensitivityAnalysisJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"ruleName\", PARAMETER_TYPE.STRING));\n        this.definitions.push(new JobParameterDefinition(\"extendedPolicyDescription\", PARAMETER_TYPE.BOOLEAN));\n        this.definitions.push(new JobParameterDefinition(\"failOnInvalidTree\", PARAMETER_TYPE.BOOLEAN));\n        this.definitions.push(new JobParameterDefinition(\"variables\", [\n                new JobParameterDefinition(\"name\", PARAMETER_TYPE.STRING),\n                new JobParameterDefinition(\"min\", PARAMETER_TYPE.NUMBER),\n                new JobParameterDefinition(\"max\", PARAMETER_TYPE.NUMBER),\n                new JobParameterDefinition(\"length\", PARAMETER_TYPE.INTEGER).set(\"singleValueValidator\", v => v >= 2),\n            ], 1, Infinity, false,\n            v => v[\"min\"] < v[\"max\"],\n            values => Utils.isUnique(values, v=>v[\"name\"]) //Variable names should be unique\n        ))\n    }\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            extendedPolicyDescription: true,\n            failOnInvalidTree: true\n        }\n    }\n}\n","import {SimpleJob} from \"../../../engine/simple-job\";\nimport {SensitivityAnalysisJobParameters} from \"./sensitivity-analysis-job-parameters\";\nimport {PrepareVariablesStep} from \"./steps/prepare-variables-step\";\nimport {InitPoliciesStep} from \"./steps/init-policies-step\";\nimport {CalculateStep} from \"./steps/calculate-step\";\nimport {Policy} from \"../../../../policies/policy\";\nimport {Utils} from \"sd-utils\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\n\n\nexport class SensitivityAnalysisJob extends SimpleJob {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager, batchSize=5) {\n        super(\"sensitivity-analysis\", jobRepository, expressionsEvaluator, objectiveRulesManager);\n        this.batchSize = 5;\n        this.initSteps();\n    }\n\n    initSteps(){\n        this.addStep(new PrepareVariablesStep(this.jobRepository, this.expressionsEvaluator.expressionEngine));\n        this.addStep(new InitPoliciesStep(this.jobRepository));\n        this.calculateStep = new CalculateStep(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager, this.batchSize);\n        this.addStep(this.calculateStep);\n    }\n\n    createJobParameters(values) {\n        return new SensitivityAnalysisJobParameters(values);\n    }\n\n    getJobDataValidator() {\n        return {\n            validate: (data) => data.getRoots().length === 1\n        }\n    }\n\n    setBatchSize(batchSize){\n        this.batchSize = batchSize;\n        this.calculateStep.chunkSize = batchSize;\n    }\n\n    jobResultToCsvRows(jobResult, jobParameters, withHeaders=true){\n        var result = [];\n        if(withHeaders){\n            var headers = ['policy_number', 'policy'];\n            jobResult.variableNames.forEach(n=>headers.push(n));\n            headers.push('payoff');\n            result.push(headers);\n        }\n\n        var roundVariables = !!jobParameters.values.roundVariables;\n        if(roundVariables){\n            this.roundVariables(jobResult);\n        }\n\n        jobResult.rows.forEach(row => {\n            var policy = jobResult.policies[row.policyIndex];\n            var rowCells = [row.policyIndex+1, Policy.toPolicyString(policy, jobParameters.values.extendedPolicyDescription)];\n            row.variables.forEach(v=> rowCells.push(v));\n            rowCells.push(row.payoff);\n            result.push(rowCells);\n\n            if(row._variables){ //revert original variables\n                row.variables = row._variables;\n                delete row._variables;\n            }\n        });\n\n        return result;\n    }\n\n    roundVariables(jobResult){\n        var uniqueValues = jobResult.variableNames.map(()=>new Set());\n\n        jobResult.rows.forEach(row => {\n            row._variables = row.variables.slice(); // save original row variables\n            row.variables.forEach((v,i)=> {\n                uniqueValues[i].add(v)\n            });\n        });\n\n        var uniqueValuesNo = uniqueValues.map((s)=>s.size);\n        var maxPrecision = 14;\n        var precision = 2;\n        var notReadyVariablesIndexes = jobResult.variableNames.map((v,i)=>i);\n        while(precision<=maxPrecision && notReadyVariablesIndexes.length){\n            uniqueValues = notReadyVariablesIndexes.map(()=>new Set());\n            jobResult.rows.forEach(row => {\n                notReadyVariablesIndexes.forEach((variableIndex, notReadyIndex)=>{\n\n                    var val = row._variables[variableIndex];\n                    val = Utils.round(val, precision);\n                    uniqueValues[notReadyIndex].add(val);\n\n                    row.variables[variableIndex] = val;\n                })\n            });\n\n            var newReadyIndexes = [];\n            uniqueValues.forEach((uniqueVals, notReadyIndex)=>{\n                var origUniqueCount = uniqueValuesNo[notReadyVariablesIndexes[notReadyIndex]] ;\n                if(origUniqueCount==uniqueVals.size){ //ready in previous iteration\n                    newReadyIndexes.push(notReadyIndex);\n                }\n            });\n            if(newReadyIndexes.length) { //revert values to prev iteration\n                newReadyIndexes.reverse();\n                newReadyIndexes.forEach(notReadyIndex=>{\n                    notReadyVariablesIndexes.splice(notReadyIndex, 1);\n                })\n            }\n            precision++;\n        }\n    }\n\n    /*Should return progress object with fields:\n     * current\n     * total */\n    getProgress(execution){\n\n        if (execution.stepExecutions.length <= 2) {\n            return {\n                total: 1,\n                current: 0\n            };\n        }\n\n        return this.steps[2].getProgress(execution.stepExecutions[2]);\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {BatchStep} from \"../../../../engine/batch/batch-step\";\nimport {TreeValidator} from \"../../../../../validation/tree-validator\";\nimport {Policy} from \"../../../../../policies/policy\";\nimport {JobComputationException} from \"../../../../engine/exceptions/job-computation-exception\";\n\nexport class CalculateStep extends BatchStep {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager, batchSize) {\n        super(\"calculate_step\", jobRepository, batchSize);\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n        this.treeValidator = new TreeValidator();\n    }\n\n    init(stepExecution, jobResult) {\n        var jobExecutionContext = stepExecution.getJobExecutionContext();\n        var params = stepExecution.getJobParameters();\n        var ruleName = params.value(\"ruleName\");\n\n        this.objectiveRulesManager.setCurrentRuleByName(ruleName);\n        var variableValues = jobResult.data.variableValues;\n        var variableNames = params.value(\"variables\").map(v=>v.name);\n        stepExecution.executionContext.put(\"variableNames\", variableNames);\n\n\n        if (!jobResult.data.rows) {\n            jobResult.data.rows = [];\n            jobResult.data.variableNames = variableNames;\n        }\n\n        return variableValues.length;\n    }\n\n\n    readNextChunk(stepExecution, startIndex, chunkSize, jobResult) {\n        var variableValues = jobResult.data.variableValues;\n        return variableValues.slice(startIndex, startIndex + chunkSize);\n    }\n\n\n    processItem(stepExecution, item) {\n        var params = stepExecution.getJobParameters();\n        var ruleName = params.value(\"ruleName\");\n        var failOnInvalidTree = params.value(\"failOnInvalidTree\");\n        var data = stepExecution.getData();\n        var treeRoot = data.getRoots()[0];\n        var variableNames = stepExecution.executionContext.get(\"variableNames\");\n        var policies = stepExecution.getJobExecutionContext().get(\"policies\");\n\n        this.expressionsEvaluator.clear(data);\n        this.expressionsEvaluator.evalGlobalCode(data);\n        variableNames.forEach((variableName, i)=> {\n            data.expressionScope[variableName] = item[i];\n        });\n\n        this.expressionsEvaluator.evalExpressionsForNode(data, treeRoot);\n        var vr = this.treeValidator.validate(data.getAllNodesInSubtree(treeRoot));\n\n        var valid = vr.isValid();\n\n        if(!valid && failOnInvalidTree){\n            let errorData = {\n                variables: {}\n            };\n            variableNames.forEach((variableName, i)=> {\n                errorData.variables[variableName] = item[i];\n            });\n            throw new JobComputationException(\"computations\", errorData)\n        }\n\n        var payoffs = [];\n\n        policies.forEach(policy=> {\n            var payoff = 'n/a';\n            if (valid) {\n                this.objectiveRulesManager.recomputeTree(treeRoot, false, policy);\n                payoff = treeRoot.computedValue(ruleName, 'payoff')[0];\n            }\n            payoffs.push(payoff);\n        });\n\n        return {\n            policies: policies,\n            variables: item,\n            payoffs: payoffs\n        };\n    }\n\n    writeChunk(stepExecution, items, jobResult) {\n        var params = stepExecution.getJobParameters();\n        var extendedPolicyDescription = params.value(\"extendedPolicyDescription\");\n\n        items.forEach(item=> {\n            if (!item) {\n                return;\n            }\n            item.policies.forEach((policy, i)=> {\n                var variables = item.variables.map(v => this.toFloat(v));\n\n                var payoff = item.payoffs[i];\n                var row = {\n                    policyIndex: i,\n                    variables: variables,\n                    payoff: Utils.isString(payoff) ? payoff : this.toFloat(payoff)\n                };\n                jobResult.data.rows.push(row);\n            })\n        })\n    }\n\n    postProcess(stepExecution, jobResult) {\n        delete jobResult.data.variableValues;\n    }\n\n\n    toFloat(v) {\n        return ExpressionEngine.toFloat(v);\n    }\n}\n","import {Step} from \"../../../../engine/step\";\nimport {JOB_STATUS} from \"../../../../engine/job-status\";\nimport {PoliciesCollector} from \"../../../../../policies/policies-collector\";\n\nexport class InitPoliciesStep extends Step {\n    constructor(jobRepository) {\n        super(\"init_policies\", jobRepository);\n    }\n\n    doExecute(stepExecution, jobResult) {\n        var data = stepExecution.getData();\n        var treeRoot = data.getRoots()[0];\n        var policiesCollector = new PoliciesCollector(treeRoot);\n\n        var policies = policiesCollector.policies;\n        stepExecution.getJobExecutionContext().put(\"policies\", policies);\n\n        if(!jobResult.data){\n            jobResult.data={}\n        }\n\n        jobResult.data.policies = policies;\n\n        stepExecution.exitStatus = JOB_STATUS.COMPLETED;\n        return stepExecution;\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {Step} from \"../../../../engine/step\";\nimport {JOB_STATUS} from \"../../../../engine/job-status\";\nimport {ComputationsUtils} from \"../../../../../computations-utils\";\n\nexport class PrepareVariablesStep extends Step {\n    constructor(jobRepository, expressionEngine) {\n        super(\"prepare_variables\", jobRepository);\n        this.expressionEngine = expressionEngine;\n    }\n\n    doExecute(stepExecution, jobResult) {\n        var params = stepExecution.getJobParameters();\n        var variables = params.value(\"variables\");\n\n        var variableValues = [];\n        variables.forEach(v=> {\n            variableValues.push(ComputationsUtils.sequence(v.min, v.max, v.length));\n        });\n        variableValues = Utils.cartesianProductOf(variableValues);\n        jobResult.data={\n            variableValues: variableValues\n        };\n        stepExecution.exitStatus = JOB_STATUS.COMPLETED;\n        return stepExecution;\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../../engine/job-parameter-definition\";\nexport class ProbabilisticSensitivityAnalysisJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"ruleName\", PARAMETER_TYPE.STRING));\n        this.definitions.push(new JobParameterDefinition(\"failOnInvalidTree\", PARAMETER_TYPE.BOOLEAN));\n        this.definitions.push(new JobParameterDefinition(\"extendedPolicyDescription\", PARAMETER_TYPE.BOOLEAN));\n        this.definitions.push(new JobParameterDefinition(\"numberOfRuns\", PARAMETER_TYPE.INTEGER).set(\"singleValueValidator\", v => v > 0));\n\n        this.definitions.push(new JobParameterDefinition(\"variables\", [\n                new JobParameterDefinition(\"name\", PARAMETER_TYPE.STRING),\n                new JobParameterDefinition(\"formula\", PARAMETER_TYPE.NUMBER_EXPRESSION)\n            ], 1, Infinity, false,\n            null,\n            values => Utils.isUnique(values, v=>v[\"name\"]) //Variable names should be unique\n        ))\n    }\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            extendedPolicyDescription: true,\n            failOnInvalidTree: true\n        }\n    }\n}\n","import {ProbabilisticSensitivityAnalysisJobParameters} from \"./probabilistic-sensitivity-analysis-job-parameters\";\nimport {InitPoliciesStep} from \"../n-way/steps/init-policies-step\";\nimport {SensitivityAnalysisJob} from \"../n-way/sensitivity-analysis-job\";\nimport {ProbCalculateStep} from \"./steps/prob-calculate-step\";\nimport {ComputePolicyStatsStep} from \"./steps/compute-policy-stats-step\";\n\nexport class ProbabilisticSensitivityAnalysisJob extends SensitivityAnalysisJob {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager, batchSize=5) {\n        super(jobRepository, expressionsEvaluator, objectiveRulesManager, batchSize);\n        this.name = \"probabilistic-sensitivity-analysis\";\n    }\n\n    initSteps() {\n        this.addStep(new InitPoliciesStep(this.jobRepository));\n        this.calculateStep = new ProbCalculateStep(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager, this.batchSize);\n        this.addStep(this.calculateStep);\n        this.addStep(new ComputePolicyStatsStep(this.expressionsEvaluator.expressionEngine, this.objectiveRulesManager, this.jobRepository));\n    }\n\n    createJobParameters(values) {\n        return new ProbabilisticSensitivityAnalysisJobParameters(values);\n    }\n\n    /*Should return progress object with fields:\n     * current\n     * total */\n    getProgress(execution) {\n\n        if (execution.stepExecutions.length <= 1) {\n            return {\n                total: 1,\n                current: 0\n            };\n        }\n\n        return this.steps[1].getProgress(execution.stepExecutions[1]);\n    }\n}\n","import {log, Utils} from \"sd-utils\";\nimport {Step} from \"../../../../engine/step\";\nimport {JOB_STATUS} from \"../../../../engine/job-status\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\n\nexport class ComputePolicyStatsStep extends Step {\n    constructor(expressionEngine, objectiveRulesManager, jobRepository) {\n        super(\"compute_policy_stats\", jobRepository);\n        this.expressionEngine = expressionEngine;\n        this.objectiveRulesManager = objectiveRulesManager;\n    }\n\n    doExecute(stepExecution, jobResult) {\n        var params = stepExecution.getJobParameters();\n        var numberOfRuns = params.value(\"numberOfRuns\");\n        var ruleName = params.value(\"ruleName\");\n\n        let rule = this.objectiveRulesManager.ruleByName[ruleName];\n\n\n        var payoffsPerPolicy = jobResult.data.policies.map(()=>[]);\n\n        jobResult.data.rows.forEach(row=> {\n            payoffsPerPolicy[row.policyIndex].push(Utils.isString(row.payoff) ? 0 : row.payoff)\n        });\n\n        log.debug('payoffsPerPolicy', payoffsPerPolicy, jobResult.data.rows.length, rule.maximization);\n\n        jobResult.data.medians = payoffsPerPolicy.map(payoffs=>ExpressionEngine.median(payoffs));\n        jobResult.data.standardDeviations = payoffsPerPolicy.map(payoffs=>ExpressionEngine.std(payoffs));\n\n        if (rule.maximization) {\n            jobResult.data.policyIsBestProbabilities = jobResult.data.policyToHighestPayoffCount.map(v=>ExpressionEngine.toFloat(ExpressionEngine.divide(v, numberOfRuns)));\n        } else {\n            jobResult.data.policyIsBestProbabilities = jobResult.data.policyToLowestPayoffCount.map(v=>ExpressionEngine.toFloat(ExpressionEngine.divide(v, numberOfRuns)));\n        }\n\n        jobResult.data.policyToHighestPayoffCount = jobResult.data.policyToHighestPayoffCount.map(v=>ExpressionEngine.toFloat(v));\n        jobResult.data.policyToLowestPayoffCount = jobResult.data.policyToLowestPayoffCount.map(v=>ExpressionEngine.toFloat(v));\n\n\n        stepExecution.exitStatus = JOB_STATUS.COMPLETED;\n        return stepExecution;\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {CalculateStep} from \"../../n-way/steps/calculate-step\";\nimport {JobComputationException} from \"../../../../engine/exceptions/job-computation-exception\";\n\nexport class ProbCalculateStep extends CalculateStep {\n\n    init(stepExecution, jobResult) {\n        var jobExecutionContext = stepExecution.getJobExecutionContext();\n        var params = stepExecution.getJobParameters();\n        var ruleName = params.value(\"ruleName\");\n\n        this.objectiveRulesManager.setCurrentRuleByName(ruleName);\n        var variableNames = params.value(\"variables\").map(v=>v.name);\n        stepExecution.executionContext.put(\"variableNames\", variableNames);\n\n        if(!jobResult.data.rows){\n            jobResult.data.rows = [];\n            jobResult.data.variableNames = variableNames;\n            jobResult.data.expectedValues = Utils.fill(new Array(jobResult.data.policies.length), 0);\n            jobResult.data.policyToHighestPayoffCount = Utils.fill(new Array(jobResult.data.policies.length), 0);\n            jobResult.data.policyToLowestPayoffCount = Utils.fill(new Array(jobResult.data.policies.length), 0);\n        }\n\n        return params.value(\"numberOfRuns\");\n    }\n\n    readNextChunk(stepExecution, startIndex, chunkSize, jobResult) {\n        var params = stepExecution.getJobParameters();\n        var variables = params.value(\"variables\");\n        var data = stepExecution.getData();\n        var variableValues = [];\n        for(var runIndex=0; runIndex<chunkSize; runIndex++){\n            var singleRunVariableValues = [];\n            var errors = [];\n            variables.forEach(v=> {\n                try{\n                    var evaluated = this.expressionsEvaluator.expressionEngine.eval(v.formula, true, Utils.cloneDeep(data.expressionScope));\n                    singleRunVariableValues.push(ExpressionEngine.toFloat(evaluated));\n                }catch(e){\n                    errors.push({\n                        variable: v,\n                        error: e\n                    });\n                }\n\n            });\n            if(errors.length) {\n                var errorData = {variables: []};\n                errors.forEach(e=>{\n                    errorData.variables[e.variable.name] = e.error.message;\n                });\n                throw new JobComputationException(\"param-computation\", errorData)\n            }\n            variableValues.push(singleRunVariableValues)\n        }\n\n        return variableValues;\n    }\n\n    processItem(stepExecution, item, currentItemCount, jobResult) {\n        var r = super.processItem(stepExecution, item, jobResult);\n\n        var params = stepExecution.getJobParameters();\n        var numberOfRuns = params.value(\"numberOfRuns\");\n        var policies = stepExecution.getJobExecutionContext().get(\"policies\");\n\n        this.updatePolicyStats(r, policies, numberOfRuns, jobResult);\n\n        return r;\n    }\n\n    updatePolicyStats(r, policies, numberOfRuns, jobResult){\n        var highestPayoff = -Infinity;\n        var lowestPayoff = Infinity;\n        var bestPolicyIndexes = [];\n        var worstPolicyIndexes = [];\n\n        var zeroNum = ExpressionEngine.toNumber(0);\n\n        policies.forEach((policy,i)=>{\n            let payoff = r.payoffs[i];\n            if(Utils.isString(payoff)){\n                payoff = zeroNum;\n            }\n            if(payoff < lowestPayoff){\n                lowestPayoff = payoff;\n                worstPolicyIndexes = [i];\n            }else if(payoff.equals(lowestPayoff)){\n                worstPolicyIndexes.push(i)\n            }\n            if(payoff > highestPayoff){\n                highestPayoff = payoff;\n                bestPolicyIndexes = [i]\n            }else if(payoff.equals(highestPayoff)){\n                bestPolicyIndexes.push(i)\n            }\n\n            jobResult.data.expectedValues[i] = ExpressionEngine.add(jobResult.data.expectedValues[i], ExpressionEngine.divide(payoff, numberOfRuns));\n        });\n\n        bestPolicyIndexes.forEach(policyIndex=>{\n            jobResult.data.policyToHighestPayoffCount[policyIndex] = ExpressionEngine.add(jobResult.data.policyToHighestPayoffCount[policyIndex], ExpressionEngine.divide(1, bestPolicyIndexes.length))\n        });\n\n        worstPolicyIndexes.forEach(policyIndex=>{\n            jobResult.data.policyToLowestPayoffCount[policyIndex] = ExpressionEngine.add(jobResult.data.policyToLowestPayoffCount[policyIndex], ExpressionEngine.divide(1, worstPolicyIndexes.length))\n        });\n    }\n\n\n    postProcess(stepExecution, jobResult) {\n        jobResult.data.expectedValues = jobResult.data.expectedValues.map(v=>this.toFloat(v));\n    }\n\n\n    toFloat(v) {\n        return ExpressionEngine.toFloat(v);\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../../engine/job-parameter-definition\";\nexport class SpiderPlotJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"ruleName\", PARAMETER_TYPE.STRING));\n        this.definitions.push(new JobParameterDefinition(\"percentageChangeRange\", PARAMETER_TYPE.NUMBER).set(\"singleValueValidator\", v => v > 0 && v <=100));\n        this.definitions.push(new JobParameterDefinition(\"length\", PARAMETER_TYPE.INTEGER).set(\"singleValueValidator\", v => v >= 0));\n        this.definitions.push(new JobParameterDefinition(\"variables\", [\n                new JobParameterDefinition(\"name\", PARAMETER_TYPE.STRING),\n            ], 1, Infinity, false,\n            null,\n            values => Utils.isUnique(values, v=>v[\"name\"]) //Variable names should be unique\n        ));\n        this.definitions.push(new JobParameterDefinition(\"failOnInvalidTree\", PARAMETER_TYPE.BOOLEAN));\n    }\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            failOnInvalidTree: true\n        }\n    }\n}\n","import {SimpleJob} from \"../../../engine/simple-job\";\nimport {CalculateStep} from \"./steps/calculate-step\";\nimport {SpiderPlotJobParameters} from \"./spider-plot-job-parameters\";\n\nexport class SpiderPlotJob extends SimpleJob {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"spider-plot\", jobRepository);\n        this.addStep(new CalculateStep(jobRepository, expressionsEvaluator, objectiveRulesManager));\n    }\n\n    createJobParameters(values) {\n        return new SpiderPlotJobParameters(values);\n    }\n\n    getJobDataValidator() {\n        return {\n            validate: (data) => data.getRoots().length === 1\n        }\n    }\n\n\n    /*Should return progress object with fields:\n     * current\n     * total */\n    getProgress(execution){\n        if (execution.stepExecutions.length < 1) {\n            return {\n                total: 1,\n                current: 0\n            };\n        }\n\n        return this.steps[0].getProgress(execution.stepExecutions[0]);\n    }\n\n    jobResultToCsvRows(jobResult, jobParameters, withHeaders=true){\n\n        let result = [];\n        if(withHeaders){\n            result.push(['variable_name', 'policy_no'].concat(jobResult.percentageRangeValues));\n        }\n\n        jobResult.rows.forEach((row, index) => {\n\n            result.push(...row.payoffs.map((payoffs, policyIndex)=>[\n                row.variableName,\n                policyIndex+1,\n                ...payoffs\n            ]));\n\n        });\n\n        return result;\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {JobComputationException} from \"../../../../engine/exceptions/job-computation-exception\";\nimport {BatchStep} from \"../../../../engine/batch/batch-step\";\nimport {TreeValidator} from \"../../../../../validation/tree-validator\";\nimport {Policy} from \"../../../../../policies/policy\";\nimport {PoliciesCollector} from \"../../../../../policies/policies-collector\";\nimport {ComputationsUtils} from \"../../../../../computations-utils\";\n\nexport class CalculateStep extends BatchStep {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"calculate_step\", jobRepository, 1);\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n        this.treeValidator = new TreeValidator();\n    }\n\n    init(stepExecution, jobResult) {\n        let jobExecutionContext = stepExecution.getJobExecutionContext();\n        let params = stepExecution.getJobParameters();\n        let ruleName = params.value(\"ruleName\");\n        let percentageChangeRange = params.value(\"percentageChangeRange\");\n        let length = params.value(\"length\");\n        let variables = params.value(\"variables\");\n\n        this.objectiveRulesManager.setCurrentRuleByName(ruleName);\n        let variableNames = params.value(\"variables\").map(v=>v.name);\n        stepExecution.executionContext.put(\"variableNames\", variableNames);\n        let data = stepExecution.getData();\n\n        let treeRoot = data.getRoots()[0];\n        let payoff = treeRoot.computedValue(ruleName, 'payoff');\n\n        this.expressionsEvaluator.clear(data);\n        this.expressionsEvaluator.evalExpressions(data);\n\n        this.objectiveRulesManager.recomputeTree(treeRoot, false);\n\n        let policiesCollector = new PoliciesCollector(treeRoot, ruleName);\n\n        let defaultValues = {};\n        data.getGlobalVariableNames().forEach(name => {\n            let v = data.expressionScope[name];\n            try {\n                defaultValues[name] = this.toFloat(v);\n            } catch (e) {\n                throw new JobComputationException(\"error computing float value of a variable\", {\n                    name: name,\n                    value: v,\n                })\n            }\n        });\n\n\n        let percentageRangeValues = ComputationsUtils.sequence(-percentageChangeRange, percentageChangeRange, 2*length+1);\n\n        let variableValues = [];\n\n        variables.forEach(v=> {\n            let defVal = defaultValues[v.name];\n            variableValues.push(percentageRangeValues.map(p=> this.toFloat(ExpressionEngine.add(defVal, ExpressionEngine.multiply(ExpressionEngine.divide(p,100), defVal)))));\n        });\n\n\n        if(!jobResult.data){\n            jobResult.data = {\n                variableNames: variableNames,\n                defaultValues: defaultValues,\n                percentageRangeValues: percentageRangeValues,\n                defaultPayoff: this.toFloat(payoff)[0],\n                policies: policiesCollector.policies,\n                rows: []\n            };\n        }\n\n        stepExecution.getJobExecutionContext().put(\"variableValues\", variableValues);\n        return variableValues.length;\n    }\n\n\n    readNextChunk(stepExecution, startIndex, chunkSize) {\n        let variableValues = stepExecution.getJobExecutionContext().get(\"variableValues\");\n        return variableValues.slice(startIndex, startIndex + chunkSize);\n    }\n\n    processItem(stepExecution, item, itemIndex, jobResult) {\n        let params = stepExecution.getJobParameters();\n        let ruleName = params.value(\"ruleName\");\n        let failOnInvalidTree = params.value(\"failOnInvalidTree\");\n        let data = stepExecution.getData();\n        let treeRoot = data.getRoots()[0];\n        let variableNames = stepExecution.executionContext.get(\"variableNames\");\n        let variableName = variableNames[itemIndex];\n\n\n        let payoffs = jobResult.data.policies.map(policy=>[]);\n\n        this.expressionsEvaluator.clear(data);\n        this.expressionsEvaluator.evalGlobalCode(data);\n\n\n        item.forEach(variableValue=>{\n\n            data.expressionScope[variableName] = variableValue;\n\n            this.expressionsEvaluator.evalExpressionsForNode(data, treeRoot);\n            let vr = this.treeValidator.validate(data.getAllNodesInSubtree(treeRoot));\n            let valid = vr.isValid();\n\n            if(!valid && failOnInvalidTree){\n                let errorData = {\n                    variables: {}\n                };\n                errorData.variables[variableName] = variableValue;\n\n                throw new JobComputationException(\"computations\", errorData)\n            }\n\n            jobResult.data.policies.forEach((policy, policyIndex)=>{\n                this.objectiveRulesManager.recomputeTree(treeRoot, false, policy);\n                let payoff = treeRoot.computedValue(ruleName, 'payoff')[0];\n                payoffs[policyIndex].push(this.toFloat(payoff));\n            });\n\n        });\n\n        return {\n            variableName: variableName,\n            variableIndex: itemIndex,\n            variableValues: item,\n            payoffs: payoffs\n        };\n\n    }\n\n    writeChunk(stepExecution, items, jobResult) {\n        jobResult.data.rows.push(...items);\n    }\n\n\n    toFloat(v){\n        return ExpressionEngine.toFloat(v);\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {JobComputationException} from \"../../../../engine/exceptions/job-computation-exception\";\nimport {BatchStep} from \"../../../../engine/batch/batch-step\";\nimport {TreeValidator} from \"../../../../../validation/tree-validator\";\nimport {Policy} from \"../../../../../policies/policy\";\nimport {PoliciesCollector} from \"../../../../../policies/policies-collector\";\n\nexport class CalculateStep extends BatchStep {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"calculate_step\", jobRepository, 1);\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n        this.treeValidator = new TreeValidator();\n    }\n\n    init(stepExecution, jobResult) {\n        let jobExecutionContext = stepExecution.getJobExecutionContext();\n        let params = stepExecution.getJobParameters();\n        let ruleName = params.value(\"ruleName\");\n\n        this.objectiveRulesManager.setCurrentRuleByName(ruleName);\n        let variableValues = jobExecutionContext.get(\"variableValues\");\n        let variableNames = params.value(\"variables\").map(v=>v.name);\n        stepExecution.executionContext.put(\"variableNames\", variableNames);\n        let data = stepExecution.getData();\n\n        let treeRoot = data.getRoots()[0];\n        let payoff = treeRoot.computedValue(ruleName, 'payoff');\n\n        this.expressionsEvaluator.clear(data);\n        this.expressionsEvaluator.evalExpressions(data);\n\n        this.objectiveRulesManager.recomputeTree(treeRoot, false);\n\n\n\n        let policiesCollector = new PoliciesCollector(treeRoot, ruleName);\n\n        let defaultValues = {};\n        data.getGlobalVariableNames().forEach(name => {\n            let v = data.expressionScope[name];\n            try {\n                defaultValues[name] = this.toFloat(v);\n            } catch (e) {\n                throw new JobComputationException(\"error computing float value of a variable\", {\n                    name: name,\n                    value: v,\n                })\n            }\n        });\n\n        if(!jobResult.data){\n            jobResult.data = {\n                variableNames: variableNames,\n                defaultValues: defaultValues,\n                variableExtents: variableValues.map(v=>[v[0], v[v.length-1]]),\n                defaultPayoff: this.toFloat(payoff)[0],\n                policies: policiesCollector.policies,\n                rows: []\n            };\n        }\n\n        return variableValues.length;\n    }\n\n\n    readNextChunk(stepExecution, startIndex, chunkSize) {\n        let variableValues = stepExecution.getJobExecutionContext().get(\"variableValues\");\n        return variableValues.slice(startIndex, startIndex + chunkSize);\n    }\n\n    processItem(stepExecution, item, itemIndex, jobResult) {\n        let params = stepExecution.getJobParameters();\n        let ruleName = params.value(\"ruleName\");\n        let failOnInvalidTree = params.value(\"failOnInvalidTree\");\n        let data = stepExecution.getData();\n        let treeRoot = data.getRoots()[0];\n        let variableNames = stepExecution.executionContext.get(\"variableNames\");\n        let variableName = variableNames[itemIndex];\n\n        let extents = jobResult.data.policies.map(policy=>{\n            return {\n                min: Infinity,\n                max: -Infinity\n            }\n        });\n\n        let values = jobResult.data.policies.map(policy=>{\n            return {\n                min: null,\n                max: null\n            }\n        });\n\n        this.expressionsEvaluator.clear(data);\n        this.expressionsEvaluator.evalGlobalCode(data);\n\n\n        item.forEach(variableValue=>{\n\n            data.expressionScope[variableName] = variableValue;\n\n            this.expressionsEvaluator.evalExpressionsForNode(data, treeRoot);\n            let vr = this.treeValidator.validate(data.getAllNodesInSubtree(treeRoot));\n            let valid = vr.isValid();\n\n            if(!valid && failOnInvalidTree){\n                let errorData = {\n                    variables: {}\n                };\n                errorData.variables[variableName] = variableValue;\n\n                throw new JobComputationException(\"computations\", errorData)\n            }\n\n            jobResult.data.policies.forEach((policy, policyIndex)=>{\n                this.objectiveRulesManager.recomputeTree(treeRoot, false, policy);\n                let payoff = treeRoot.computedValue(ruleName, 'payoff')[0];\n\n                if(payoff < extents[policyIndex].min){\n                    extents[policyIndex].min = payoff;\n                    values[policyIndex].min = variableValue\n                }\n\n                if(payoff > extents[policyIndex].max){\n                    extents[policyIndex].max = payoff;\n                    values[policyIndex].max = variableValue\n                }\n            });\n\n        });\n\n        return {\n            variableName: variableName,\n            variableIndex: itemIndex,\n            extents: extents.map(e=>[this.toFloat(e.min), this.toFloat(e.max)]),\n            extentVariableValues: values.map(v=>[this.toFloat(v.min), this.toFloat(v.max)])\n        };\n\n    }\n\n    writeChunk(stepExecution, items, jobResult) {\n        jobResult.data.rows.push(...items);\n    }\n\n    postProcess(stepExecution, jobResult) {\n        jobResult.data.rows.sort((a, b)=>(b.extents[0][1]-b.extents[0][0])-(a.extents[0][1]-a.extents[0][0]))\n\n    }\n\n\n    toFloat(v){\n        return ExpressionEngine.toFloat(v);\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {Step} from \"../../../../engine/step\";\nimport {JOB_STATUS} from \"../../../../engine/job-status\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {ComputationsUtils} from \"../../../../../computations-utils\";\n\nexport class PrepareVariablesStep extends Step {\n    constructor(jobRepository) {\n        super(\"prepare_variables\", jobRepository);\n    }\n\n    doExecute(stepExecution) {\n        var params = stepExecution.getJobParameters();\n        var variables = params.value(\"variables\");\n\n        var variableValues = [];\n        variables.forEach(v=> {\n            variableValues.push(ComputationsUtils.sequence(v.min, v.max, v.length));\n        });\n        stepExecution.getJobExecutionContext().put(\"variableValues\", variableValues);\n\n        stepExecution.exitStatus = JOB_STATUS.COMPLETED;\n        return stepExecution;\n    }\n\n}\n","import {Utils} from \"sd-utils\";\nimport {JobParameters} from \"../../../engine/job-parameters\";\nimport {JobParameterDefinition, PARAMETER_TYPE} from \"../../../engine/job-parameter-definition\";\nexport class TornadoDiagramJobParameters extends JobParameters {\n\n    initDefinitions() {\n        this.definitions.push(new JobParameterDefinition(\"id\", PARAMETER_TYPE.STRING, 1, 1, true));\n        this.definitions.push(new JobParameterDefinition(\"ruleName\", PARAMETER_TYPE.STRING));\n        this.definitions.push(new JobParameterDefinition(\"variables\", [\n                new JobParameterDefinition(\"name\", PARAMETER_TYPE.STRING),\n                new JobParameterDefinition(\"min\", PARAMETER_TYPE.NUMBER),\n                new JobParameterDefinition(\"max\", PARAMETER_TYPE.NUMBER),\n                new JobParameterDefinition(\"length\", PARAMETER_TYPE.INTEGER).set(\"singleValueValidator\", v => v >= 0),\n            ], 1, Infinity, false,\n            v => v[\"min\"] <= v[\"max\"],\n            values => Utils.isUnique(values, v=>v[\"name\"]) //Variable names should be unique\n        ));\n        this.definitions.push(new JobParameterDefinition(\"failOnInvalidTree\", PARAMETER_TYPE.BOOLEAN));\n    }\n\n    initDefaultValues() {\n        this.values = {\n            id: Utils.guid(),\n            failOnInvalidTree: true\n        }\n    }\n}\n","import {SimpleJob} from \"../../../engine/simple-job\";\nimport {PrepareVariablesStep} from \"./steps/prepare-variables-step\";\nimport {CalculateStep} from \"./steps/calculate-step\";\nimport {TornadoDiagramJobParameters} from \"./tornado-diagram-job-parameters\";\n\nexport class TornadoDiagramJob extends SimpleJob {\n\n    constructor(jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(\"tornado-diagram\", jobRepository);\n        this.addStep(new PrepareVariablesStep(jobRepository));\n        this.addStep(new CalculateStep(jobRepository, expressionsEvaluator, objectiveRulesManager));\n    }\n\n    createJobParameters(values) {\n        return new TornadoDiagramJobParameters(values);\n    }\n\n    getJobDataValidator() {\n        return {\n            validate: (data) => data.getRoots().length === 1\n        }\n    }\n\n\n    /*Should return progress object with fields:\n     * current\n     * total */\n    getProgress(execution){\n\n        if (execution.stepExecutions.length <= 1) {\n            return {\n                total: 1,\n                current: 0\n            };\n        }\n\n        return this.steps[1].getProgress(execution.stepExecutions[1]);\n    }\n\n    jobResultToCsvRows(jobResult, jobParameters, withHeaders=true){\n        let result = [];\n        if(withHeaders){\n            result.push(['variable_name', 'default_var_value', \"min_var_value\", \"max_var_value\", 'default_payoff', \"min_payoff\", \"max_payoff\", \"policy_no\"]);\n        }\n\n\n        jobResult.rows.forEach((row, index) => {\n\n            result.push(...row.extents.map((extent, policyIndex)=>[\n                row.variableName,\n                jobResult.defaultValues[row.variableName],\n                row.extentVariableValues[policyIndex][0],\n                row.extentVariableValues[policyIndex][1],\n                jobResult.defaultPayoff,\n                extent[0],\n                extent[1],\n                policyIndex+1\n            ]));\n\n        });\n\n\n        return result;\n    }\n}\n","import {JOB_STATUS} from \"../job-status\";\nimport {log} from 'sd-utils'\nimport {Step} from \"../step\";\nimport {JobInterruptedException} from \"../exceptions/job-interrupted-exception\";\n\n/*job step that process batch of items*/\nexport class BatchStep extends Step {\n\n    chunkSize;\n    static CURRENT_ITEM_COUNT_PROP = 'batch_step_current_item_count';\n    static TOTAL_ITEM_COUNT_PROP = 'batch_step_total_item_count';\n\n    constructor(name, jobRepository, chunkSize) {\n        super(name, jobRepository);\n        this.chunkSize = chunkSize;\n    }\n\n    /**\n     * Extension point for subclasses to perform step initialization. Should return total item count\n     */\n    init(stepExecution, jobResult) {\n        throw \"BatchStep.init function not implemented for step: \" + this.name;\n    }\n\n    /**\n     * Extension point for subclasses to read and return chunk of items to process\n     */\n    readNextChunk(stepExecution, startIndex, chunkSize, jobResult) {\n        throw \"BatchStep.readNextChunk function not implemented for step: \" + this.name;\n    }\n\n    /**\n     * Extension point for subclasses to process single item\n     * Must return processed item which will be passed in a chunk to writeChunk function\n     */\n    processItem(stepExecution, item, currentItemCount, jobResult) {\n        throw \"BatchStep.processItem function not implemented for step: \" + this.name;\n    }\n\n    /**\n     * Extension point for subclasses to write chunk of items. Not required\n     */\n    writeChunk(stepExecution, items, jobResult) {\n    }\n\n    /**\n     * Extension point for subclasses to perform postprocessing after all items have been processed. Not required\n     */\n    postProcess(stepExecution, jobResult) {\n    }\n\n\n    setTotalItemCount(stepExecution, count) {\n        stepExecution.executionContext.put(BatchStep.TOTAL_ITEM_COUNT_PROP, count);\n    }\n\n    getTotalItemCount(stepExecution) {\n        return stepExecution.executionContext.get(BatchStep.TOTAL_ITEM_COUNT_PROP);\n    }\n\n    setCurrentItemCount(stepExecution, count) {\n        stepExecution.executionContext.put(BatchStep.CURRENT_ITEM_COUNT_PROP, count);\n    }\n\n    getCurrentItemCount(stepExecution) {\n        return stepExecution.executionContext.get(BatchStep.CURRENT_ITEM_COUNT_PROP) || 0;\n    }\n\n\n    doExecute(stepExecution, jobResult) {\n        return Promise.resolve().then(()=> {\n            return this.init(stepExecution, jobResult)\n        }).catch(e=> {\n            log.error(\"Failed to initialize batch step: \" + this.name, e);\n            throw e;\n        }).then(totalItemCount=> {\n            return Promise.resolve().then(()=>{\n                this.setCurrentItemCount(stepExecution, this.getCurrentItemCount(stepExecution));\n                this.setTotalItemCount(stepExecution, totalItemCount);\n                return this.handleNextChunk(stepExecution, jobResult)\n            }).catch(e=> {\n                if(!(e instanceof JobInterruptedException)){\n                    log.error(\"Failed to handle batch step: \" + this.name, e);\n                }\n                throw e;\n            })\n        }).then(()=> {\n            return Promise.resolve().then(()=>{\n                return this.postProcess(stepExecution, jobResult)\n            }).catch(e=> {\n                log.error(\"Failed to postProcess batch step: \" + this.name, e);\n                throw e;\n            })\n        }).then(()=> {\n            stepExecution.exitStatus = JOB_STATUS.COMPLETED;\n            return stepExecution;\n        })\n\n    }\n\n    handleNextChunk(stepExecution, jobResult) {\n        var currentItemCount = this.getCurrentItemCount(stepExecution);\n        var totalItemCount = this.getTotalItemCount(stepExecution);\n        var chunkSize = Math.min(this.chunkSize, totalItemCount - currentItemCount);\n        if (currentItemCount >= totalItemCount) {\n            return stepExecution;\n        }\n        return this.checkJobExecutionFlags(stepExecution).then(()=> {\n            // Check if someone is trying to stop us\n            if (stepExecution.terminateOnly) {\n                throw new JobInterruptedException(\"JobExecution interrupted.\");\n            }\n            return stepExecution\n        }).then(()=> {\n            return Promise.resolve().then(()=>{\n                return this.readNextChunk(stepExecution, currentItemCount, chunkSize, jobResult)\n            }).catch(e=> {\n                log.error(\"Failed to read chunk (\" + currentItemCount + \",\" + chunkSize + \") in batch step: \" + this.name, e);\n                throw e;\n            });\n        }).then(chunk=> {\n            return Promise.resolve().then(()=>{\n                return this.processChunk(stepExecution, chunk, currentItemCount, jobResult)\n            }).catch(e=> {\n                log.error(\"Failed to process chunk (\" + currentItemCount + \",\" + chunkSize + \") in batch step: \" + this.name, e);\n                throw e;\n            })\n        }).then(processedChunk=> {\n            return Promise.resolve().then(()=>{\n                return this.writeChunk(stepExecution, processedChunk, jobResult)\n            }).catch(e=> {\n                log.error(\"Failed to write chunk (\" + currentItemCount + \",\" + chunkSize + \") in batch step: \" + this.name, e);\n                throw e;\n            })\n        }).then((res)=> {\n            currentItemCount += chunkSize;\n            this.setCurrentItemCount(stepExecution, currentItemCount);\n            return this.updateJobProgress(stepExecution).then(()=> {\n                return this.handleNextChunk(stepExecution, jobResult);\n            });\n        })\n    }\n\n    processChunk(stepExecution, chunk, currentItemCount, jobResult) { //TODO promisify\n        return chunk.map((item, i)=>this.processItem(stepExecution, item, currentItemCount+i, jobResult));\n    }\n\n    /*Should return progress object with fields:\n     * current\n     * total */\n    getProgress(stepExecution){\n        return {\n            total: this.getTotalItemCount(stepExecution),\n            current: this.getCurrentItemCount(stepExecution)\n        }\n    }\n\n    updateJobProgress(stepExecution) {\n        var progress = this.jobRepository.getJobByName(stepExecution.jobExecution.jobInstance.jobName).getProgress(stepExecution.jobExecution);\n        return this.jobRepository.updateJobExecutionProgress(stepExecution.jobExecution.id, progress);\n    }\n\n    checkJobExecutionFlags(stepExecution){\n        return this.jobRepository.getJobByName(stepExecution.jobExecution.jobInstance.jobName).checkExecutionFlags(stepExecution.jobExecution);\n    }\n}\n","export class ExtendableError {\n    data;\n    constructor(message, data) {\n        this.message = message;\n        this.data = data;\n        this.name = this.constructor.name;\n    }\n}\n","export * from './extendable-error'\nexport * from './job-data-invalid-exception'\nexport * from './job-execution-already-running-exception'\nexport * from './job-instance-already-complete-exception'\nexport * from './job-interrupted-exception'\nexport * from './job-parameters-invalid-exception'\nexport * from './job-restart-exception'\n\n\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobComputationException extends ExtendableError {\n}\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobDataInvalidException extends ExtendableError {\n}\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobExecutionAlreadyRunningException extends ExtendableError {\n}\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobInstanceAlreadyCompleteException extends ExtendableError {\n}\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobInterruptedException extends ExtendableError {\n}\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobParametersInvalidException extends ExtendableError {\n}\n","import {ExtendableError} from \"./extendable-error\";\nexport class JobRestartException extends ExtendableError {\n}\n","import {Utils} from \"sd-utils\";\nimport {DataModel} from \"sd-model\";\nimport {StepExecution} from \"./step-execution\";\n\nexport class ExecutionContext {\n\n    dirty = false;\n    context = {};\n\n    constructor(context) {\n        if (context) {\n            this.context = Utils.clone(context)\n        }\n    }\n\n    put(key, value) {\n        var prevValue = this.context[key];\n        if (value != null) {\n            var result = this.context[key] = value;\n            this.dirty = prevValue == null || prevValue != null && prevValue != value;\n        }\n        else {\n            delete this.context[key];\n            this.dirty = prevValue != null;\n        }\n    }\n\n    get(key) {\n        return this.context[key];\n    }\n\n    containsKey(key) {\n        return this.context.hasOwnProperty(key);\n    }\n\n    remove(key) {\n        delete this.context[key];\n    }\n\n    setData(data) { //set data model\n        return this.put(\"data\", data);\n    }\n\n    getData() { // get data model\n        return this.get(\"data\");\n    }\n\n\n    getDTO(filteredProperties = [], deepClone = true) {\n        var cloneMethod = Utils.cloneDeepWith;\n        if (!deepClone) {\n            cloneMethod = Utils.cloneWith;\n        }\n\n\n        let dto = Utils.assign({}, cloneMethod(this, (value, key, object, stack)=> {\n            if (filteredProperties.indexOf(key) > -1) {\n                return null;\n            }\n\n            if (value instanceof DataModel) {\n                return value.getDTO()\n            }\n\n            if(value && value.$ObjectWithIdAndEditableFields && value.id && this.getData().findById(value.id)){\n                return {\n                    '$ObjectWithIdAndEditableFields': true,\n                    id: value.id\n                }\n            }\n\n            if (value instanceof Error) {\n                return Utils.getErrorDTO(value);\n            }\n\n        }));\n\n        return dto\n    }\n\n}\n","import * as exceptions from './exceptions'\n\nexport {exceptions}\nexport * from './execution-context'\nexport * from './job'\nexport * from './job-execution'\nexport * from './job-execution-flag'\nexport * from './job-execution-listener'\nexport * from './job-instance'\nexport * from './job-key-generator'\nexport * from './job-launcher'\nexport * from './job-parameter-definition'\nexport * from './job-parameters'\nexport * from './job-status'\nexport * from './simple-job'\nexport * from './step'\nexport * from './step-execution'\nexport * from './step-execution-listener'\n\n\n\n\n","export const JOB_EXECUTION_FLAG = {\n    STOP: 'STOP'\n};\n","export class JobExecutionListener {\n    /*Called before a job executes*/\n    beforeJob(jobExecution) {\n\n    }\n\n    /*Called after completion of a job. Called after both successful and failed executions*/\n    afterJob(jobExecution) {\n\n    }\n}\n","import {JOB_STATUS} from \"./job-status\";\nimport {StepExecution} from \"./step-execution\";\nimport {Utils} from \"sd-utils\";\nimport {ExecutionContext} from \"./execution-context\";\n\n/*domain object representing the execution of a job.*/\nexport class JobExecution {\n    id;\n    jobInstance;\n    jobParameters;\n    stepExecutions = [];\n    status = JOB_STATUS.STARTING;\n    exitStatus = JOB_STATUS.UNKNOWN;\n    executionContext = new ExecutionContext();\n\n    startTime = null;\n    createTime = new Date();\n    endTime = null;\n    lastUpdated = null;\n\n    failureExceptions = [];\n\n    constructor(jobInstance, jobParameters, id) {\n        if(id===null || id === undefined){\n            this.id = Utils.guid();\n        }else{\n            this.id = id;\n        }\n\n        this.jobInstance = jobInstance;\n        this.jobParameters = jobParameters;\n    }\n\n    /**\n     * Register a step execution with the current job execution.\n     * @param stepName the name of the step the new execution is associated with\n     */\n    createStepExecution(stepName) {\n        var stepExecution = new StepExecution(stepName, this);\n        this.stepExecutions.push(stepExecution);\n        return stepExecution;\n    }\n\n    isRunning() {\n        return !this.endTime;\n    }\n\n    /**\n     * Test if this JobExecution has been signalled to\n     * stop.\n     */\n    isStopping() {\n        return this.status === JOB_STATUS.STOPPING;\n    }\n\n    /**\n     * Signal the JobExecution to stop.\n     */\n    stop() {\n        this.stepExecutions.forEach(se=> {\n            se.terminateOnly = true;\n        });\n        this.status = JOB_STATUS.STOPPING;\n    }\n\n    getData() {\n        return this.executionContext.getData();\n    }\n\n    getDTO(filteredProperties = [], deepClone = true) {\n        var cloneMethod = Utils.cloneDeepWith;\n        if (!deepClone) {\n            cloneMethod = Utils.cloneWith;\n        }\n\n        return Utils.assign({}, cloneMethod(this, (value, key, object, stack)=> {\n            if (filteredProperties.indexOf(key) > -1) {\n                return null;\n            }\n\n            if ([\"jobParameters\", \"executionContext\"].indexOf(key) > -1) {\n                return value.getDTO()\n            }\n            if (value instanceof Error) {\n                return Utils.getErrorDTO(value);\n            }\n\n            if (value instanceof StepExecution) {\n                return value.getDTO([\"jobExecution\"], deepClone)\n            }\n        }))\n    }\n}\n","/* object representing a uniquely identifiable job run. JobInstance can be restarted multiple times in case of execution failure and it's lifecycle ends with first successful execution*/\nexport class JobInstance{\n\n    id;\n    jobName;\n    constructor(id, jobName){\n        this.id = id;\n        this.jobName = jobName;\n    }\n\n}\n","\nexport class JobKeyGenerator {\n    /*Method to generate the unique key used to identify a job instance.*/\n    static generateKey(jobParameters) {\n        var result = \"\";\n        jobParameters.definitions.forEach((d, i)=> {\n            if(d.identifying){\n                result += d.name + \"=\" + jobParameters.values[d.name] + \";\";\n            }\n        });\n        return result;\n    }\n}\n","import {JobRestartException} from \"./exceptions/job-restart-exception\";\nimport {JOB_STATUS} from \"./job-status\";\nimport {Utils, log} from \"sd-utils\";\nimport {JobParametersInvalidException} from \"./exceptions/job-parameters-invalid-exception\";\nimport {JobDataInvalidException} from \"./exceptions/job-data-invalid-exception\";\n\nexport class JobLauncher {\n\n    jobRepository;\n    jobWorker;\n\n    constructor(jobRepository, jobWorker, dataModelSerializer) {\n        this.jobRepository = jobRepository;\n        this.jobWorker = jobWorker;\n        this.dataModelSerializer = dataModelSerializer;\n    }\n\n\n    run(jobOrName, jobParametersValues, data, resolvePromiseAfterJobIsLaunched = true) {\n        var job;\n        var jobParameters;\n\n        return Promise.resolve().then(()=> {\n            if (Utils.isString(jobOrName)) {\n                job = this.jobRepository.getJobByName(jobOrName)\n            } else {\n                job = jobOrName;\n            }\n            if (!job) {\n                throw new JobRestartException(\"No such job: \" + jobOrName);\n            }\n\n            jobParameters = job.createJobParameters(jobParametersValues);\n\n            return this.validate(job, jobParameters, data);\n        }).then(valid=>{\n            return this.jobRepository.createJobExecution(job.name, jobParameters, data).then(jobExecution=>{\n\n\n                if(this.jobWorker){\n                    log.debug(\"Job: [\" + job.name + \"] execution [\"+jobExecution.id+\"] delegated to worker\");\n                    this.jobWorker.executeJob(jobExecution.id);\n                    return jobExecution;\n                }\n\n                var executionPromise = this._execute(job, jobExecution);\n                if(resolvePromiseAfterJobIsLaunched){\n                    return jobExecution;\n                }\n                return executionPromise;\n            })\n        })\n    }\n\n    validate(job, jobParameters, data){\n        return this.jobRepository.getLastJobExecution(job.name, jobParameters).then(lastExecution=>{\n            if (lastExecution != null) {\n                if (!job.isRestartable) {\n                    throw new JobRestartException(\"JobInstance already exists and is not restartable\");\n                }\n\n                lastExecution.stepExecutions.forEach(execution=> {\n                    if (execution.status == JOB_STATUS.UNKNOWN) {\n                        throw new JobRestartException(\"Step [\" + execution.stepName + \"] is of status UNKNOWN\");\n                    }\n                });\n            }\n            if (job.jobParametersValidator && !job.jobParametersValidator.validate(jobParameters)) {\n                throw new JobParametersInvalidException(\"Invalid job parameters in jobLauncher.run for job: \"+job.name)\n            }\n\n            if(job.jobDataValidator && !job.jobDataValidator.validate(data)){\n                throw new JobDataInvalidException(\"Invalid job data in jobLauncher.run for job: \"+job.name)\n            }\n\n            return true;\n        })\n    }\n\n    /**Execute previously created job execution*/\n    execute(jobExecutionOrId){\n\n        return Promise.resolve().then(()=>{\n            if(Utils.isString(jobExecutionOrId)){\n                return this.jobRepository.getJobExecutionById(jobExecutionOrId);\n            }\n            return jobExecutionOrId;\n        }).then(jobExecution=>{\n            if(!jobExecution){\n                throw new JobRestartException(\"JobExecution [\" + jobExecutionOrId + \"] is not found\");\n            }\n\n            if (jobExecution.status !== JOB_STATUS.STARTING) {\n                throw new JobRestartException(\"JobExecution [\" + jobExecution.id + \"] already started\");\n            }\n\n            var jobName = jobExecution.jobInstance.jobName;\n            var job = this.jobRepository.getJobByName(jobName);\n            if(!job){\n                throw new JobRestartException(\"No such job: \" + jobName);\n            }\n\n            return  this._execute(job, jobExecution);\n        })\n    }\n\n    _execute(job, jobExecution){\n        var jobName = job.name;\n        log.info(\"Job: [\" + jobName + \"] launched with the following parameters: [\" + jobExecution.jobParameters + \"]\", jobExecution.getData());\n        return job.execute(jobExecution).then(jobExecution=>{\n            log.info(\"Job: [\" + jobName + \"] completed with the following parameters: [\" + jobExecution.jobParameters + \"] and the following status: [\" + jobExecution.status + \"]\");\n            return jobExecution;\n        }).catch(e =>{\n            log.error(\"Job: [\" + jobName + \"] failed unexpectedly and fatally with the following parameters: [\" + jobExecution.jobParameters + \"]\", e);\n            throw e;\n        })\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\n\nexport const PARAMETER_TYPE = {\n    STRING: 'STRING',\n    DATE: 'DATE',\n    INTEGER: 'INTEGER',\n    NUMBER: 'FLOAT',\n    BOOLEAN: 'BOOLEAN',\n    NUMBER_EXPRESSION: 'NUMBER_EXPRESSION',\n    COMPOSITE: 'COMPOSITE' //composite parameter with nested subparameters\n};\n\nexport class JobParameterDefinition {\n    name;\n    type;\n    nestedParameters = [];\n    minOccurs;\n    maxOccurs;\n    required = true;\n\n    identifying;\n    validator;\n    singleValueValidator;\n\n    constructor(name, typeOrNestedParametersDefinitions, minOccurs = 1, maxOccurs = 1, identifying = false, singleValueValidator = null, validator = null) {\n        this.name = name;\n        if (Utils.isArray(typeOrNestedParametersDefinitions)) {\n            this.type = PARAMETER_TYPE.COMPOSITE;\n            this.nestedParameters = typeOrNestedParametersDefinitions;\n        } else {\n            this.type = typeOrNestedParametersDefinitions;\n        }\n        this.validator = validator;\n        this.singleValueValidator = singleValueValidator;\n        this.identifying = identifying;\n        this.minOccurs = minOccurs;\n        this.maxOccurs = maxOccurs;\n    }\n\n    set(key, val) {\n        this[key] = val;\n        return this;\n    }\n\n    validate(value, allValues) {\n        var isArray = Utils.isArray(value);\n\n        if (this.maxOccurs > 1 && !isArray) {\n            return false;\n        }\n\n        if (!isArray) {\n            return this.validateSingleValue(value, allValues)\n        }\n\n        if (value.length < this.minOccurs || value.length > this.maxOccurs) {\n            return false;\n        }\n\n        if (!value.every(v=>this.validateSingleValue(v, value))) {\n            return false;\n        }\n\n        if (this.validator) {\n            return this.validator(value, allValues);\n        }\n\n        return true;\n    }\n\n    static computeNumberExpression(val){\n        let parsed = parseFloat(val);\n        if(parsed === Infinity || parsed === -Infinity) {\n            return parsed;\n        }\n\n        if(!ExpressionEngine.validate(val, {}, false)){\n            return null\n        }\n\n        return ExpressionEngine.eval(val, true)\n    }\n\n    // allValues - all values on the same level\n    validateSingleValue(value, allValues) {\n\n        if ((!value && value !== 0 && value !== false) && this.minOccurs > 0) {\n            return !this.required\n        }\n\n        if (PARAMETER_TYPE.STRING === this.type && !Utils.isString(value)) {\n            return false;\n        }\n        if (PARAMETER_TYPE.DATE === this.type && !Utils.isDate(value)) {\n            return false;\n        }\n        if (PARAMETER_TYPE.INTEGER === this.type && !Utils.isInt(value)) {\n            return false;\n        }\n        if (PARAMETER_TYPE.NUMBER === this.type && !Utils.isNumber(value)) {\n            return false;\n        }\n\n        if (PARAMETER_TYPE.BOOLEAN === this.type && !Utils.isBoolean(value)) {\n            return false;\n        }\n\n\n        if (PARAMETER_TYPE.NUMBER_EXPRESSION === this.type) {\n            value = JobParameterDefinition.computeNumberExpression(value);\n            if(value === null){\n                return false\n            }\n        }\n\n        if (PARAMETER_TYPE.COMPOSITE === this.type) {\n            if (!Utils.isObject(value)) {\n                return false;\n            }\n            if (!this.nestedParameters.every((nestedDef, i)=>nestedDef.validate(value[nestedDef.name]))) {\n                return false;\n            }\n        }\n\n        if (this.singleValueValidator) {\n            return this.singleValueValidator(value, allValues);\n        }\n\n        return true;\n    }\n\n    value(value){\n        if(PARAMETER_TYPE.NUMBER_EXPRESSION === this.type) {\n            return JobParameterDefinition.computeNumberExpression(value);\n        }\n\n        return value;\n    }\n}\n","import {PARAMETER_TYPE} from \"./job-parameter-definition\";\nimport {Utils} from \"sd-utils\";\n\nexport class JobParameters{\n    definitions = [];\n    values={};\n\n    constructor(values){\n        this.initDefinitions();\n        this.initDefaultValues();\n        if (values) {\n            Utils.deepExtend(this.values, values);\n        }\n    }\n\n    initDefinitions(){\n\n    }\n\n    initDefaultValues(){\n\n    }\n\n    validate(){\n        return this.definitions.every((def, i)=>def.validate(this.values[def.name], this.values));\n    }\n\n    getDefinition(path){\n        var defs =this.definitions;\n        let def = null;\n        if(!path.split().every(name=>{\n                def = Utils.find(defs, d=>d.name == name);\n                if(!def){\n                    return false\n                }\n                defs = def.nestedParameters;\n                return true;\n        })){\n            return null;\n        }\n        return def;\n    }\n\n    /*get or set value by path*/\n    value(path, value){\n        if (arguments.length === 1) {\n            let def = this.getDefinition(path);\n            let val = Utils.get(this.values, path, null);\n            if(def){\n                return def.value(val);\n            }\n            return  val;\n        }\n        Utils.set(this.values, path, value);\n        return value;\n    }\n\n    toString(){\n        var result = \"JobParameters[\";\n\n        this.definitions.forEach((d, i)=> {\n\n            var val = this.values[d.name];\n            // if(Utils.isArray(val)){\n            //     var values = val;\n            //\n            //\n            // }\n            // if(PARAMETER_TYPE.COMPOSITE == d.type){\n            //\n            // }\n\n            result += d.name + \"=\"+val + \";\";\n        });\n        result+=\"]\";\n        return result;\n    }\n\n    getDTO(){\n        return {\n            values: this.values\n        }\n    }\n}\n","import {JobRepository} from \"./job-repository\";\nimport { openDB, deleteDB } from 'idb';\nimport {Utils} from \"sd-utils\";\nimport {JobExecution} from \"../job-execution\";\nimport {JobInstance} from \"../job-instance\";\nimport {StepExecution} from \"../step-execution\";\nimport {ExecutionContext} from \"../execution-context\";\nimport {DataModel} from \"sd-model\";\nimport {log} from \"sd-utils\";\nimport {JobResult} from \"../job-result\";\n\n/* IndexedDB job repository*/\nexport class IdbJobRepository extends JobRepository {\n\n    dbPromise;\n    jobInstanceDao;\n    jobExecutionDao;\n    stepExecutionDao;\n    jobResultDao;\n    jobExecutionProgressDao;\n    jobExecutionFlagDao;\n\n    constructor(expressionsReviver, dbName = 'sd-job-repository', deleteDB = false) {\n        super();\n        this.dbName = dbName;\n        this.expressionsReviver = expressionsReviver;\n        if (deleteDB) {\n            this.deleteDB().then(()=> {\n                this.initDB()\n            }).catch(e=> {\n                log.error(e);\n                this.initDB();\n            })\n        } else {\n            this.initDB()\n        }\n    }\n\n    initDB() {\n        this.dbPromise = openDB(this.dbName, 2, {\n            upgrade(db, oldVersion, newVersion, transaction) {\n                // Note: we don't use 'break' in this switch statement,\n                // the fall-through behaviour is what we want.\n                switch (oldVersion) {\n                    case 0:\n                        db.createObjectStore('job-instances');\n                        var jobExecutionsOS = db.createObjectStore('job-executions');\n                        jobExecutionsOS.createIndex(\"jobInstanceId\", \"jobInstance.id\", {unique: false});\n                        jobExecutionsOS.createIndex(\"createTime\", \"createTime\", {unique: false});\n                        jobExecutionsOS.createIndex(\"status\", \"status\", {unique: false});\n                        db.createObjectStore('job-execution-progress');\n                        db.createObjectStore('job-execution-flags');\n                        var stepExecutionsOS = db.createObjectStore('step-executions');\n                        stepExecutionsOS.createIndex(\"jobExecutionId\", \"jobExecutionId\", {unique: false});\n\n                        var jobResultOS = db.createObjectStore('job-results');\n                        jobResultOS.createIndex(\"jobInstanceId\", \"jobInstance.id\", {unique: true});\n                    case 1:\n                        transaction.objectStore('job-instances').createIndex(\"id\", \"id\", {unique: true});\n                }\n\n            }\n        });\n\n        this.jobInstanceDao = new ObjectStoreDao('job-instances', this.dbPromise);\n        this.jobExecutionDao = new ObjectStoreDao('job-executions', this.dbPromise);\n        this.jobExecutionProgressDao = new ObjectStoreDao('job-execution-progress', this.dbPromise);\n        this.jobExecutionFlagDao = new ObjectStoreDao('job-execution-flags', this.dbPromise);\n        this.stepExecutionDao = new ObjectStoreDao('step-executions', this.dbPromise);\n        this.jobResultDao = new ObjectStoreDao('job-results', this.dbPromise);\n    }\n\n    deleteDB() {\n        return Promise.resolve().then(_=>deleteDB(this.dbName));\n    }\n\n\n    removeJobInstance(jobInstance, jobParameters){\n        var key = this.generateJobInstanceKey(jobInstance.jobName, jobParameters);\n        return this.jobInstanceDao.remove(key).then(()=>{\n            this.findJobExecutions(jobInstance, false).then(jobExecutions=>{  //  Not waiting for promise resolves\n                jobExecutions.forEach(this.removeJobExecution, this);\n            });\n\n            this.getJobResultByInstance(jobInstance).then(jobResult=>{\n                return this.removeJobResult(jobResult)\n            })\n        });\n    }\n\n    removeJobExecution(jobExecution){\n        return this.jobExecutionDao.remove(jobExecution.id).then(()=>{\n            return this.findStepExecutions(jobExecution.id, false).then(stepExecutions=>{  // Not waiting for promise resolves\n                stepExecutions.forEach(this.removeStepExecution, this);\n            });\n        });\n    }\n\n    removeStepExecution(stepExecution){\n        return this.stepExecutionDao.remove(stepExecution.id)\n    }\n\n    removeJobResult(jobResult){\n        return this.jobResultDao.remove(jobResult.id);\n    }\n\n\n\n\n    getJobResult(jobResultId, revive = true) {\n        return this.jobResultDao.get(jobResultId).then(dto => dto && revive ? this.reviveJobResult(dto) : dto);\n    }\n\n    getJobResultByInstance(jobInstance, revive = true) {\n        return this.jobResultDao.getByIndex(\"jobInstanceId\", jobInstance.id).then(dto => dto && revive ? this.reviveJobResult(dto) : dto);\n    }\n\n    getJobResultByExecution(jobExecution, revive = true) {\n        return this.getJobResultByInstance(jobExecution.jobInstance, false).then(dto => dto && revive ? this.reviveJobResult(dto, jobExecution) : dto);\n    }\n\n    saveJobResult(jobResult) {\n        let dto = jobResult.getDTO();\n        return this.jobResultDao.set(jobResult.id, dto).then(r=>jobResult);\n    }\n\n    /*returns promise*/\n    getJobInstance(jobName, jobParameters) {\n        var key = this.generateJobInstanceKey(jobName, jobParameters);\n        return this.jobInstanceDao.get(key).then(dto=>dto ? this.reviveJobInstance(dto) : dto);\n    }\n\n    /*should return promise that resolves to saved instance*/\n    saveJobInstance(jobInstance, jobParameters) {\n        var key = this.generateJobInstanceKey(jobInstance.jobName, jobParameters);\n        return this.jobInstanceDao.set(key, jobInstance).then(r=>jobInstance);\n    }\n\n    /*should return promise that resolves to saved jobExecution*/\n    saveJobExecution(jobExecution) {\n        var dto = jobExecution.getDTO();\n        var stepExecutionsDTOs = dto.stepExecutions;\n        dto.stepExecutions = null;\n        return this.jobExecutionDao.set(jobExecution.id, dto).then(r=>this.saveStepExecutionsDTOS(stepExecutionsDTOs)).then(r=>jobExecution);\n    }\n\n    updateJobExecutionProgress(jobExecutionId, progress) {\n        return this.jobExecutionProgressDao.set(jobExecutionId, progress)\n    }\n\n    getJobExecutionProgress(jobExecutionId) {\n        return this.jobExecutionProgressDao.get(jobExecutionId)\n    }\n\n    saveJobExecutionFlag(jobExecutionId, flag) {\n        return this.jobExecutionFlagDao.set(jobExecutionId, flag)\n    }\n\n    getJobExecutionFlag(jobExecutionId) {\n        return this.jobExecutionFlagDao.get(jobExecutionId)\n    }\n\n    /*should return promise which resolves to saved stepExecution*/\n    saveStepExecution(stepExecution) {\n        var dto = stepExecution.getDTO([\"jobExecution\"]);\n        return this.stepExecutionDao.set(stepExecution.id, dto).then(r=>stepExecution);\n    }\n\n    saveStepExecutionsDTOS(stepExecutions, savedExecutions = []) {\n        if (stepExecutions.length <= savedExecutions.length) {\n            return Promise.resolve(savedExecutions);\n        }\n        var stepExecutionDTO = stepExecutions[savedExecutions.length];\n        return this.stepExecutionDao.set(stepExecutionDTO.id, stepExecutionDTO).then(()=> {\n            savedExecutions.push(stepExecutionDTO);\n            return this.saveStepExecutionsDTOS(stepExecutions, savedExecutions);\n        });\n    }\n\n    getJobExecutionById(id) {\n        return this.jobExecutionDao.get(id).then(dto=> {\n            return this.fetchJobExecutionRelations(dto);\n        });\n    }\n\n    fetchJobExecutionRelations(jobExecutionDTO, revive = true) {\n        if (!jobExecutionDTO) {\n            return Promise.resolve(null)\n        }\n        return this.findStepExecutions(jobExecutionDTO.id, false).then(steps=> {\n            jobExecutionDTO.stepExecutions = steps;\n            if (!revive) {\n                return jobExecutionDTO;\n            }\n            return this.reviveJobExecution(jobExecutionDTO);\n        })\n    }\n\n    fetchJobExecutionsRelations(jobExecutionDtoList, revive = true, fetched = []) {\n        if (jobExecutionDtoList.length <= fetched.length) {\n            return Promise.resolve(fetched);\n        }\n        return this.fetchJobExecutionRelations(jobExecutionDtoList[fetched.length], revive).then((jobExecution)=> {\n            fetched.push(jobExecution);\n\n            return this.fetchJobExecutionsRelations(jobExecutionDtoList, revive, fetched);\n        });\n    }\n\n    findStepExecutions(jobExecutionId, revive = true) {\n        return this.stepExecutionDao.getAllByIndex(\"jobExecutionId\", jobExecutionId).then(dtos=> {\n            if (!revive) {\n                return dtos;\n            }\n            return dtos.map(dto=>this.reviveStepExecution(dto));\n        })\n    }\n\n\n    /*find job executions sorted by createTime, returns promise*/\n    findJobExecutions(jobInstance, fetchRelationsAndRevive = true) {\n        return this.jobExecutionDao.getAllByIndex(\"jobInstanceId\", jobInstance.id).then(values=> {\n            var sorted = values.sort(function (a, b) {\n                return a.createTime.getTime() - b.createTime.getTime()\n            });\n\n            if (!fetchRelationsAndRevive) {\n                return sorted;\n            }\n\n            return this.fetchJobExecutionsRelations(sorted, true)\n        });\n    }\n\n    getLastJobExecutionByInstance(jobInstance, fetchRelationsAndRevive = true) {\n        return this.findJobExecutions(jobInstance, false).then(executions=>{\n            let execution = executions[executions.length - 1];\n            if (!fetchRelationsAndRevive) {\n                return execution;\n            }\n            this.fetchJobExecutionRelations(execution);\n        });\n    }\n\n    getLastStepExecution(jobInstance, stepName) {\n        return this.findJobExecutions(jobInstance).then(jobExecutions=> {\n            var stepExecutions = [];\n            jobExecutions.forEach(jobExecution=>jobExecution.stepExecutions.filter(s=>s.stepName === stepName).forEach((s)=>stepExecutions.push(s)));\n            var latest = null;\n            stepExecutions.forEach(s=> {\n                if (latest == null || latest.startTime.getTime() < s.startTime.getTime()) {\n                    latest = s;\n                }\n            });\n            return latest;\n        })\n    }\n\n    reviveJobInstance(dto) {\n        return new JobInstance(dto.id, dto.jobName);\n    }\n\n    reviveExecutionContext(dto) {\n        let executionContext = new ExecutionContext();\n        executionContext.context = dto.context;\n        let data = executionContext.getData();\n        if (data) {\n            let dataModel = new DataModel();\n            dataModel.loadFromDTO(data, this.expressionsReviver);\n\n            executionContext.setData(null);\n            this.reviveFromDTO(executionContext.context, dto.context, dataModel);\n\n            executionContext.setData(dataModel);\n\n        }\n        return executionContext\n    }\n\n    reviveFromDTO(target, dto, dataModel) {\n        return Utils.mergeWith(target, dto, (value, dtoValue, key)=> {\n            if(dtoValue && dtoValue.$ObjectWithIdAndEditableFields && dtoValue.id){\n                return dataModel.findById(dtoValue.id) || value;\n            }\n        })\n    }\n\n    reviveJobExecution(dto) {\n\n        var job = this.getJobByName(dto.jobInstance.jobName);\n        var jobInstance = this.reviveJobInstance(dto.jobInstance);\n        var jobParameters = job.createJobParameters(dto.jobParameters.values);\n        var jobExecution = new JobExecution(jobInstance, jobParameters, dto.id);\n        var executionContext = this.reviveExecutionContext(dto.executionContext);\n        return Utils.mergeWith(jobExecution, dto, (objValue, srcValue, key, object, source, stack)=> {\n            if (key === \"jobInstance\") {\n                return jobInstance;\n            }\n            if (key === \"executionContext\") {\n                return executionContext;\n            }\n            if (key === \"jobParameters\") {\n                return jobParameters;\n            }\n            if (key === \"jobExecution\") {\n                return jobExecution;\n            }\n\n            if (key === \"stepExecutions\") {\n                return srcValue.map(stepDTO => this.reviveStepExecution(stepDTO, jobExecution));\n            }\n        })\n    }\n\n    reviveStepExecution(dto, jobExecution) {\n        var stepExecution = new StepExecution(dto.stepName, jobExecution, dto.id);\n        var executionContext = this.reviveExecutionContext(dto.executionContext);\n        return Utils.mergeWith(stepExecution, dto, (objValue, srcValue, key, object, source, stack)=> {\n            if (key === \"jobExecution\") {\n                return jobExecution;\n            }\n            if (key === \"executionContext\") {\n                return executionContext;\n            }\n        })\n    }\n\n    reviveJobResult(dto, jobExecution = null) {\n        let job = this.getJobByName(dto.jobInstance.jobName);\n        let jobInstance = this.reviveJobInstance(dto.jobInstance);\n\n        let contextPromise;\n        if (jobExecution != null) {\n            contextPromise = Promise.resolve(jobExecution.executionContext);\n        }else{\n            contextPromise = this.getLastJobExecutionByInstance(jobInstance, false).then(jobExecutionDto => this.reviveExecutionContext(jobExecutionDto.executionContext));\n        }\n\n        return contextPromise.then(executionContext => job.reviveResultData( this.reviveFromDTO({}, dto.data, executionContext.getData()), executionContext)).then(d=>new JobResult(jobInstance, dto.id, d));\n    }\n}\n\n\nclass ObjectStoreDao {\n\n    name;\n    dbPromise;\n\n    constructor(name, dbPromise) {\n        this.name = name;\n        this.dbPromise = dbPromise;\n    }\n\n    get(key) {\n        return this.dbPromise.then(db => {\n            return db.transaction(this.name)\n                .objectStore(this.name).get(key);\n        });\n    }\n\n    getAllByIndex(indexName, key) {\n        return this.dbPromise.then(db => {\n            return db.transaction(this.name)\n                .objectStore(this.name).index(indexName).getAll(key)\n        });\n    }\n\n    getByIndex(indexName, key) {\n        return this.dbPromise.then(db => {\n            return db.transaction(this.name)\n                .objectStore(this.name).index(indexName).get(key)\n        });\n    }\n\n    set(key, val) {\n        return this.dbPromise.then(db => {\n            const tx = db.transaction(this.name, 'readwrite');\n            tx.objectStore(this.name).put(val, key);\n            return tx.done;\n        });\n    }\n\n    remove(key) {\n        return this.dbPromise.then(db => {\n            const tx = db.transaction(this.name, 'readwrite');\n            tx.objectStore(this.name).delete(key);\n            return tx.done;\n        });\n    }\n\n    clear() {\n        return this.dbPromise.then(db => {\n            const tx = db.transaction(this.name, 'readwrite');\n            tx.objectStore(this.name).clear();\n            return tx.done;\n        });\n    }\n\n    keys() {\n        return this.dbPromise.then(db => {\n            const tx = db.transaction(this.name);\n            const store = tx.objectStore(this.name);\n            return store.getAllKeys();\n        });\n    }\n}\n","import {JobKeyGenerator} from \"../job-key-generator\";\nimport {JobInstance} from \"../job-instance\";\nimport {Utils} from \"sd-utils\";\nimport {JobExecution} from \"../job-execution\";\nimport {JobExecutionAlreadyRunningException} from \"../exceptions/job-execution-already-running-exception\";\nimport {JOB_STATUS} from \"../job-status\";\nimport {JobInstanceAlreadyCompleteException} from \"../exceptions/job-instance-already-complete-exception\";\nimport {ExecutionContext} from \"../execution-context\";\nimport {StepExecution} from \"../step-execution\";\nimport {DataModel} from \"sd-model\";\nimport {JobResult} from \"../job-result\";\n\nexport class JobRepository {\n\n    jobByName = {};\n\n    registerJob(job) {\n        this.jobByName[job.name] = job;\n    }\n\n    getJobByName(name) {\n        return this.jobByName[name];\n    }\n\n\n    /*returns promise*/\n    getJobInstance(jobName, jobParameters) {\n       throw \"JobRepository getJobInstance function not implemented!\"\n    }\n\n    /*should return promise that resolves to saved instance*/\n    saveJobInstance(key, jobInstance){\n        throw \"JobRepository.saveJobInstance function not implemented!\"\n    }\n\n    getJobExecutionById(id){\n        throw \"JobRepository.getJobExecutionById function not implemented!\"\n    }\n\n    /*should return promise that resolves to saved jobExecution*/\n    saveJobExecution(jobExecution){\n        throw \"JobRepository.saveJobInstance function not implemented!\"\n    }\n\n    updateJobExecutionProgress(jobExecutionId, progress){\n        throw \"JobRepository.saveJobInstance function not implemented!\"\n    }\n\n    getJobExecutionProgress(jobExecutionId){\n        throw \"JobRepository.getJobExecutionProgress function not implemented!\"\n    }\n\n    saveJobExecutionFlag(jobExecutionId, flag){\n        throw \"JobRepository.saveJobExecutionFlag function not implemented!\"\n    }\n\n    getJobExecutionFlag(jobExecutionId){\n        throw \"JobRepository.getJobExecutionFlag function not implemented!\"\n    }\n\n\n    /*should return promise which resolves to saved stepExecution*/\n    saveStepExecution(stepExecution){\n        throw \"JobRepository.saveStepExecution function not implemented!\"\n    }\n\n    /*find job executions sorted by createTime, returns promise*/\n    findJobExecutions(jobInstance) {\n        throw \"JobRepository.findJobExecutions function not implemented!\"\n    }\n\n    getJobResult(jobResultId){\n        throw \"JobRepository.getJobResult function not implemented!\"\n    }\n\n    getJobResultByInstance(jobInstance){\n        throw \"JobRepository.getJobResultByInstance function not implemented!\"\n    }\n\n    getJobResultByExecution(jobInstance){\n        throw \"JobRepository.getJobResultByExecution function not implemented!\"\n    }\n\n    saveJobResult(jobResult) {\n        throw \"JobRepository.setJobResult function not implemented!\"\n    }\n\n\n    removeJobInstance(jobInstance, jobParameters){\n        throw \"JobRepository.removeJobInstance function not implemented!\"\n    }\n\n    removeJobExecution(jobExecution){\n        throw \"JobRepository.removeJobExecution function not implemented!\"\n    }\n\n    removeStepExecution(stepExecution){\n        throw \"JobRepository.removeStepExecution function not implemented!\"\n    }\n\n    removeJobResult(jobResult){\n        throw \"JobRepository.removeJobResult function not implemented!\"\n    }\n\n    /*Create a new JobInstance with the name and job parameters provided. return promise*/\n    createJobInstance(jobName, jobParameters) {\n        var jobInstance = new JobInstance(Utils.guid(), jobName);\n        return this.saveJobInstance(jobInstance, jobParameters);\n    }\n\n    /*Check if an instance of this job already exists with the parameters provided.*/\n    isJobInstanceExists(jobName, jobParameters) {\n        return this.getJobInstance(jobName, jobParameters).then(result => !!result).catch(error=>false);\n    }\n\n    generateJobInstanceKey(jobName, jobParameters) {\n        return jobName + \"|\" + JobKeyGenerator.generateKey(jobParameters);\n    }\n\n    /*Create a JobExecution for a given  Job and JobParameters. If matching JobInstance already exists,\n     * the job must be restartable and it's last JobExecution must *not* be\n     * completed. If matching JobInstance does not exist yet it will be  created.*/\n\n    createJobExecution(jobName, jobParameters, data) {\n        return this.getJobInstance(jobName, jobParameters).then(jobInstance=>{\n            if (jobInstance != null) {\n                return this.findJobExecutions(jobInstance).then(executions=>{\n                    executions.forEach(execution=> {\n                        if (execution.isRunning()) {\n                            throw new JobExecutionAlreadyRunningException(\"A job execution for this job is already running: \" + jobInstance.jobName);\n                        }\n                        if (execution.status == JOB_STATUS.COMPLETED || execution.status == JOB_STATUS.ABANDONED) {\n                            throw new JobInstanceAlreadyCompleteException(\n                                \"A job instance already exists and is complete for parameters=\" + jobParameters\n                                + \".  If you want to run this job again, change the parameters.\");\n                        }\n                    });\n\n                    var executionContext = executions[executions.length - 1].executionContext;\n\n                    return [jobInstance, executionContext];\n                })\n            }\n\n            // no job found, create one\n            jobInstance = this.createJobInstance(jobName, jobParameters);\n            var executionContext = new ExecutionContext();\n            var dataModel = new DataModel();\n            dataModel._setNewState(data.createStateSnapshot());\n            executionContext.setData(dataModel);\n            return Promise.all([jobInstance, executionContext]);\n        }).then(instanceAndExecutionContext=>{\n            var jobExecution = new JobExecution(instanceAndExecutionContext[0], jobParameters);\n            jobExecution.executionContext = instanceAndExecutionContext[1];\n            jobExecution.lastUpdated = new Date();\n            return this.saveJobExecution(jobExecution);\n        }).catch(e=>{\n            throw e;\n        })\n    }\n\n    getLastJobExecution(jobName, jobParameters) {\n        return this.getJobInstance(jobName, jobParameters).then((jobInstance)=>{\n            if(!jobInstance){\n                return null;\n            }\n            return this.getLastJobExecutionByInstance(jobInstance);\n        })\n    }\n\n    getLastJobExecutionByInstance(jobInstance){\n        return this.findJobExecutions(jobInstance).then(executions=>executions[executions.length -1]);\n    }\n\n    getLastStepExecution(jobInstance, stepName) {\n        return this.findJobExecutions(jobInstance).then(jobExecutions=>{\n            var stepExecutions=[];\n            jobExecutions.forEach(jobExecution=>jobExecution.stepExecutions.filter(s=>s.stepName === stepName).forEach((s)=>stepExecutions.push(s)));\n            var latest = null;\n            stepExecutions.forEach(s=>{\n                if (latest == null || latest.startTime.getTime() < s.startTime.getTime()) {\n                    latest = s;\n                }\n            });\n            return latest;\n        })\n    }\n\n    addStepExecution(stepExecution) {\n        stepExecution.lastUpdated = new Date();\n        return this.saveStepExecution(stepExecution);\n    }\n\n    update(o){\n        o.lastUpdated = new Date();\n\n        if(o instanceof JobExecution){\n            return this.saveJobExecution(o);\n        }\n\n        if(o instanceof StepExecution){\n            return this.saveStepExecution(o);\n        }\n\n        throw \"Object not updatable: \"+o\n    }\n\n    remove(o){\n\n        if(o instanceof JobExecution){\n            return this.removeJobExecution(o);\n        }\n\n        if(o instanceof StepExecution){\n            return this.removeStepExecution(o);\n        }\n\n        if(o instanceof JobResult){\n            return this.removeJobResult();\n        }\n\n        return Promise.reject(\"Object not removable: \"+o);\n    }\n\n\n    reviveJobInstance(dto) {\n        return dto;\n    }\n\n    reviveExecutionContext(dto) {\n        return dto;\n    }\n\n    reviveJobExecution(dto) {\n        return dto;\n    }\n\n    reviveStepExecution(dto, jobExecution) {\n        return dto;\n    }\n}\n","import {JobRepository} from \"./job-repository\";\nimport {Utils} from \"sd-utils\";\n\nexport class SimpleJobRepository extends JobRepository{\n    jobInstancesByKey = {};\n    jobExecutions = [];\n    stepExecutions = [];\n    executionProgress = {};\n    executionFlags = {};\n    jobResults = [];\n\n    removeJobInstance(jobInstance){\n        Utils.forOwn(this.jobInstancesByKey,  (ji, key)=>{\n            if(ji===jobInstance){\n                delete this.jobInstancesByKey[key]\n            }\n        });\n\n        this.jobExecutions.filter(jobExecution=>jobExecution.jobInstance.id == jobInstance.id).reverse().forEach(this.removeJobExecution, this);\n        this.jobResults.filter(jobResult=>jobResult.jobInstance.id == jobInstance.id).reverse().forEach(this.removeJobResult, this);\n\n        return Promise.resolve();\n    }\n\n    removeJobExecution(jobExecution){\n        let index = this.jobExecutions.indexOf(jobExecution);\n        if(index>-1) {\n            this.jobExecutions.splice(index, 1)\n        }\n\n        this.stepExecutions.filter(stepExecution=>stepExecution.jobExecution.id === jobExecution.id).reverse().forEach(this.removeStepExecution, this);\n        return Promise.resolve();\n    }\n\n    removeStepExecution(stepExecution){\n        let index = this.stepExecutions.indexOf(stepExecution);\n        if(index>-1) {\n            this.stepExecutions.splice(index, 1)\n        }\n        return Promise.resolve();\n    }\n\n    removeJobResult(jobResult){\n        let index = this.jobResults.indexOf(jobResult);\n        if(index>-1) {\n            this.jobResults.splice(index, 1)\n        }\n        return Promise.resolve();\n    }\n\n\n    /*returns promise*/\n    getJobInstance(jobName, jobParameters) {\n        var key = this.generateJobInstanceKey(jobName, jobParameters);\n        return Promise.resolve(this.jobInstancesByKey[key]);\n    }\n\n    /*should return promise that resolves to saved instance*/\n    saveJobInstance(jobInstance, jobParameters){\n        var key = this.generateJobInstanceKey(jobInstance.jobName, jobParameters);\n        this.jobInstancesByKey[key] = jobInstance;\n        return Promise.resolve(jobInstance)\n    }\n\n    getJobResult(jobResultId){\n        return Promise.resolve(Utils.find(this.jobResults, r=>r.id===jobResultId))\n    }\n\n    getJobResultByInstance(jobInstance){\n        return Promise.resolve(Utils.find(this.jobResults, r=>r.jobInstance.id===jobInstance.id))\n    }\n\n    getJobResultByExecution(jobExecution){\n        return this.getJobResultByInstance(jobExecution.jobInstance);\n    }\n\n    saveJobResult(jobResult) {\n        this.jobResults.push(jobResult);\n        return Promise.resolve(jobResult);\n    }\n\n    getJobExecutionById(id){\n        return Promise.resolve(Utils.find(this.jobExecutions, ex=>ex.id===id))\n    }\n\n    /*should return promise that resolves to saved jobExecution*/\n    saveJobExecution(jobExecution){\n        this.jobExecutions.push(jobExecution);\n        return Promise.resolve(jobExecution);\n    }\n\n    updateJobExecutionProgress(jobExecutionId, progress){\n        this.executionProgress[jobExecutionId] = progress;\n        return Promise.resolve(progress)\n    }\n\n    getJobExecutionProgress(jobExecutionId){\n        return Promise.resolve(this.executionProgress[jobExecutionId])\n    }\n\n    saveJobExecutionFlag(jobExecutionId, flag){\n        this.executionFlags[jobExecutionId] = flag;\n        return Promise.resolve(flag)\n    }\n\n    getJobExecutionFlag(jobExecutionId){\n        return Promise.resolve(this.executionFlags[jobExecutionId])\n    }\n\n    /*should return promise which resolves to saved stepExecution*/\n    saveStepExecution(stepExecution){\n        this.stepExecutions.push(stepExecution);\n        return Promise.resolve(stepExecution);\n    }\n\n    /*find job executions sorted by createTime, returns promise*/\n    findJobExecutions(jobInstance) {\n        return Promise.resolve(this.jobExecutions.filter(e=>e.jobInstance.id == jobInstance.id).sort(function (a, b) {\n            return a.createTime.getTime() - b.createTime.getTime()\n        }));\n    }\n\n\n}\n","import {JobRepository} from \"./job-repository\";\nimport {Utils} from \"sd-utils\";\nimport {SimpleJobRepository} from \"./simple-job-repository\";\n\n\n\nexport class TimeoutJobRepository extends SimpleJobRepository{\n\n    createTimeoutPromise(valueToResolve, delay=1){\n        return new Promise(resolve=>{\n            setTimeout(function(){\n                resolve(valueToResolve);\n            }, delay)\n        });\n    }\n\n    /*returns promise*/\n    getJobInstance(jobName, jobParameters) {\n        var key = this.generateJobInstanceKey(jobName, jobParameters);\n        return this.createTimeoutPromise(this.jobInstancesByKey[key]);\n    }\n\n    /*should return promise that resolves to saved instance*/\n    saveJobInstance(jobInstance, jobParameters){\n        var key = this.generateJobInstanceKey(jobInstance.jobName, jobParameters);\n        this.jobInstancesByKey[key] = jobInstance;\n        return this.createTimeoutPromise(jobInstance);\n    }\n\n    getJobResult(jobResultId){\n        return this.createTimeoutPromise(Utils.find(this.jobResults, r=>r.id===jobResultId));\n    }\n\n    getJobResultByInstance(jobInstance){\n        return this.createTimeoutPromise(Utils.find(this.jobResults, r=>r.jobInstance.id===jobInstance.id));\n    }\n\n    getJobResultByExecution(jobExecution){\n        return this.getJobResultByInstance(jobExecution.jobInstance);\n    }\n\n    saveJobResult(jobResult) {\n        this.jobResults.push(jobResult);\n        return this.createTimeoutPromise(jobResult);\n    }\n\n    getJobExecutionById(id){\n        return this.createTimeoutPromise(Utils.find(this.jobExecutions, ex=>ex.id===id));\n    }\n\n    /*should return promise that resolves to saved jobExecution*/\n    saveJobExecution(jobExecution){\n        this.jobExecutions.push(jobExecution);\n        return this.createTimeoutPromise(jobExecution);\n    }\n\n    updateJobExecutionProgress(jobExecutionId, progress){\n        this.executionProgress[jobExecutionId] = progress;\n        return this.createTimeoutPromise(progress);\n    }\n\n    getJobExecutionProgress(jobExecutionId){\n        return this.createTimeoutPromise(this.executionProgress[jobExecutionId]);\n    }\n\n    saveJobExecutionFlag(jobExecutionId, flag){\n        this.executionFlags[jobExecutionId] = flag;\n        return this.createTimeoutPromise(flag);\n    }\n\n    getJobExecutionFlag(jobExecutionId){\n        return this.createTimeoutPromise(this.executionFlags[jobExecutionId]);\n    }\n\n    /*should return promise which resolves to saved stepExecution*/\n    saveStepExecution(stepExecution){\n        this.stepExecutions.push(stepExecution);\n        return this.createTimeoutPromise(stepExecution);\n    }\n\n    /*find job executions sorted by createTime, returns promise*/\n    findJobExecutions(jobInstance) {\n        return this.createTimeoutPromise(this.jobExecutions.filter(e=>e.jobInstance.id == jobInstance.id).sort(function (a, b) {\n            return a.createTime.getTime() - b.createTime.getTime()\n        }));\n    }\n\n    remove(object){ //TODO\n\n    }\n}\n","import {JOB_STATUS} from \"./job-status\";\nimport {StepExecution} from \"./step-execution\";\nimport {Utils} from \"sd-utils\";\nimport {ExecutionContext} from \"./execution-context\";\nimport {JobExecution} from \"./job-execution\";\n\n/*domain object representing the result of a job instance.*/\nexport class JobResult {\n    id;\n    jobInstance;\n    lastUpdated = null;\n\n    data; // job result data - this is not a data model!\n\n    constructor(jobInstance, id, data) {\n        if(id===null || id === undefined){\n            this.id = Utils.guid();\n        }else{\n            this.id = id;\n        }\n\n        this.jobInstance = jobInstance;\n        this.data = data;\n    }\n\n    getDTO(filteredProperties=[], deepClone = true){\n\n        var cloneMethod = Utils.cloneDeepWith;\n        if(!deepClone) {\n            cloneMethod = Utils.cloneWith;\n        }\n\n        let dto = Utils.assign({}, cloneMethod(this, (value, key, object, stack)=> {\n            if(filteredProperties.indexOf(key)>-1){\n                return null;\n            }\n\n            if(value && value.$ObjectWithIdAndEditableFields && value.id){\n                return {\n                    '$ObjectWithIdAndEditableFields': true,\n                    id: value.id\n                }\n            }\n\n            if(value instanceof Error){\n                return Utils.getErrorDTO(value);\n            }\n        }));\n\n        return dto\n    }\n}\n","export const JOB_STATUS = {\n    COMPLETED: 'COMPLETED',\n    STARTING: 'STARTING',\n    STARTED: 'STARTED',\n    STOPPING: 'STOPPING',\n    STOPPED: 'STOPPED',\n    FAILED: 'FAILED',\n    UNKNOWN: 'UNKNOWN',\n    ABANDONED: 'ABANDONED',\n    EXECUTING: 'EXECUTING' //for exit status only\n};\n","import {log} from 'sd-utils'\nimport {JOB_STATUS} from \"./job-status\";\nimport {JobInterruptedException} from \"./exceptions/job-interrupted-exception\";\nimport {JobParametersInvalidException} from \"./exceptions/job-parameters-invalid-exception\";\nimport {JobDataInvalidException} from \"./exceptions/job-data-invalid-exception\";\nimport {JOB_EXECUTION_FLAG} from \"./job-execution-flag\";\nimport {JobResult} from \"./job-result\";\n\n/**\n * Base class for jobs\n * A Job is an entity that encapsulates an entire job process ( an abstraction representing the configuration of a job)\n * */\n\nexport class Job {\n\n    id;\n    name;\n    steps = [];\n\n    isRestartable=true;\n    executionListeners = [];\n    jobParametersValidator;\n\n    jobRepository;\n\n    constructor(name, jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        this.name = name;\n        this.jobParametersValidator = this.getJobParametersValidator();\n        this.jobDataValidator = this.getJobDataValidator();\n        this.jobRepository = jobRepository;\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n    }\n\n    setJobRepository(jobRepository) {\n        this.jobRepository = jobRepository;\n    }\n\n    execute(execution) {\n        log.debug(\"Job execution starting: \", execution);\n        var jobResult;\n        return this.checkExecutionFlags(execution).then(execution=>{\n\n            if (execution.status === JOB_STATUS.STOPPING) {\n                // The job was already stopped\n                execution.status = JOB_STATUS.STOPPED;\n                execution.exitStatus = JOB_STATUS.COMPLETED;\n                log.debug(\"Job execution was stopped: \" + execution);\n                return execution;\n            }\n\n            if (this.jobParametersValidator && !this.jobParametersValidator.validate(execution.jobParameters)) {\n                throw new JobParametersInvalidException(\"Invalid job parameters in job execute\")\n            }\n\n            if(this.jobDataValidator && !this.jobDataValidator.validate(execution.getData())){\n                throw new JobDataInvalidException(\"Invalid job data in job execute\")\n            }\n\n\n            execution.startTime = new Date();\n            return Promise.all([this.updateStatus(execution, JOB_STATUS.STARTED), this.getResult(execution), this.updateProgress(execution)]).then(res=>{\n                execution=res[0];\n                jobResult = res[1];\n                if(!jobResult) {\n                    jobResult = new JobResult(execution.jobInstance)\n                }\n                this.executionListeners.forEach(listener=>listener.beforeJob(execution));\n\n                return this.doExecute(execution, jobResult);\n            });\n\n        }).then(execution=>{\n            log.debug(\"Job execution complete: \",execution);\n            return execution\n        }).catch(e=>{\n            if (e instanceof JobInterruptedException) {\n                log.info(\"Encountered interruption executing job\", e);\n                execution.status = JOB_STATUS.STOPPED;\n                execution.exitStatus = JOB_STATUS.STOPPED;\n            } else {\n                log.error(\"Encountered fatal error executing job\", e);\n                execution.status = JOB_STATUS.FAILED;\n                execution.exitStatus = JOB_STATUS.FAILED;\n            }\n            execution.failureExceptions.push(e);\n            return execution;\n        }).then(execution=>{\n            if(jobResult){\n                return this.jobRepository.saveJobResult(jobResult).then(()=>execution)\n            }\n            return execution\n        }).catch(e=>{\n            log.error(\"Encountered fatal error saving job results\", e);\n            if(e){\n                execution.failureExceptions.push(e);\n            }\n            execution.status = JOB_STATUS.FAILED;\n            execution.exitStatus = JOB_STATUS.FAILED;\n            return execution;\n        }).then(execution=>{\n            execution.endTime = new Date();\n            return Promise.all([this.jobRepository.update(execution), this.updateProgress(execution)]).then(res=>res[0])\n        }).then(execution=>{\n            try {\n                this.executionListeners.forEach(listener=>listener.afterJob(execution));\n            } catch (e) {\n                log.error(\"Exception encountered in afterStep callback\", e);\n            }\n            return execution;\n        })\n    }\n\n\n    updateStatus(jobExecution, status) {\n        jobExecution.status=status;\n        return this.jobRepository.update(jobExecution)\n    }\n\n    updateProgress(jobExecution){\n        return this.jobRepository.updateJobExecutionProgress(jobExecution.id, this.getProgress(jobExecution));\n    }\n\n    /* Extension point for subclasses allowing them to concentrate on processing logic and ignore listeners, returns promise*/\n    doExecute(execution, jobResult) {\n        throw 'doExecute function not implemented for job: ' + this.name\n    }\n\n    getJobParametersValidator() {\n        return {\n            validate: (params) => params.validate()\n        }\n    }\n\n    getJobDataValidator() {\n        return {\n            validate: (data) => true\n        }\n    }\n\n    addStep(step){\n        this.steps.push(step);\n    }\n\n\n    createJobParameters(values){\n        throw 'createJobParameters function not implemented for job: ' + this.name\n    }\n\n    /*Should return progress object with fields:\n    * current\n    * total */\n    getProgress(execution){\n        return {\n            total: 1,\n            current: execution.status === JOB_STATUS.COMPLETED ? 1 : 0\n        }\n    }\n\n    registerExecutionListener(listener){\n        this.executionListeners.push(listener);\n    }\n\n    checkExecutionFlags(execution){\n        return this.jobRepository.getJobExecutionFlag(execution.id).then(flag=>{\n            if(JOB_EXECUTION_FLAG.STOP === flag){\n                execution.stop();\n            }\n            return execution\n        })\n    }\n\n    getResult(execution) {\n        return this.jobRepository.getJobResultByExecution(execution);\n    }\n\n    /* revive job result data (after conversion to dto) if needed*/\n    reviveResultData(data, executionContext) {\n        return data;\n    }\n\n    jobResultToCsvRows(jobResult, jobParameters){\n        throw 'jobResultToCsvRows function not implemented for job: ' + this.name\n    }\n}\n","import {log} from 'sd-utils'\nimport {JOB_STATUS} from \"./job-status\";\nimport {Job} from \"./job\";\nimport {Utils} from \"sd-utils\";\nimport {ExecutionContext} from \"./execution-context\";\nimport {Step} from \"./step\";\nimport {JobInterruptedException} from \"./exceptions/job-interrupted-exception\";\nimport {JobRestartException} from \"./exceptions/job-restart-exception\";\nimport {JOB_EXECUTION_FLAG} from \"./job-execution-flag\";\n\n/* Simple Job that sequentially executes a job by iterating through its list of steps.  Any Step that fails will fail the job.  The job is\n considered complete when all steps have been executed.*/\n\nexport class SimpleJob extends Job {\n\n    constructor(name, jobRepository, expressionsEvaluator, objectiveRulesManager) {\n        super(name, jobRepository, expressionsEvaluator, objectiveRulesManager)\n    }\n\n    getStep(stepName) {\n        return Utils.find(this.steps, s=>s.name == stepName);\n    }\n\n    doExecute(execution, jobResult) {\n\n        return this.handleNextStep(execution, jobResult).then(lastExecutedStepExecution=>{\n            if (lastExecutedStepExecution != null) {\n                log.debug(\"Updating JobExecution status: \", lastExecutedStepExecution);\n                execution.status = lastExecutedStepExecution.status;\n                execution.exitStatus = lastExecutedStepExecution.exitStatus;\n                execution.failureExceptions.push(...lastExecutedStepExecution.failureExceptions)\n            }\n            return execution;\n        });\n    }\n\n    handleNextStep(jobExecution, jobResult, prevStep=null, prevStepExecution=null){\n        var stepIndex = 0;\n        if(prevStep){\n            stepIndex = this.steps.indexOf(prevStep)+1;\n        }\n        if(stepIndex>=this.steps.length){\n            return Promise.resolve(prevStepExecution)\n        }\n        var step = this.steps[stepIndex];\n        return this.handleStep(step, jobExecution, jobResult).then(stepExecution=>{\n            if(stepExecution.status !== JOB_STATUS.COMPLETED){ // Terminate the job if a step fails\n                return stepExecution;\n            }\n            return this.handleNextStep(jobExecution, jobResult, step, stepExecution);\n        })\n    }\n\n    handleStep(step, jobExecution, jobResult) {\n        var jobInstance = jobExecution.jobInstance;\n        return this.checkExecutionFlags(jobExecution).then(jobExecution=>{\n            if (jobExecution.isStopping()) {\n                throw new JobInterruptedException(\"JobExecution interrupted.\");\n            }\n            return this.jobRepository.getLastStepExecution(jobInstance, step.name)\n\n        }).then(lastStepExecution=>{\n            if (this.stepExecutionPartOfExistingJobExecution(jobExecution, lastStepExecution)) {\n                // If the last execution of this step was in the same job, it's probably intentional so we want to run it again.\n                log.info(\"Duplicate step detected in execution of job. step: \" + step.name + \" jobName: \", jobInstance.jobName);\n                lastStepExecution = null;\n            }\n\n            var currentStepExecution = lastStepExecution;\n\n            if (!this.shouldStart(currentStepExecution, jobExecution, step)) {\n                return currentStepExecution;\n            }\n\n            currentStepExecution = jobExecution.createStepExecution(step.name);\n\n            var isCompleted = lastStepExecution != null && lastStepExecution.status === JOB_STATUS.COMPLETED;\n            var isRestart = lastStepExecution != null && !isCompleted;\n            var skipExecution = isCompleted && step.skipOnRestartIfCompleted;\n\n            if (isRestart) {\n                currentStepExecution.executionContext = lastStepExecution.executionContext;\n                if (lastStepExecution.executionContext.containsKey(\"executed\")) {\n                    currentStepExecution.executionContext.remove(\"executed\");\n                }\n            }\n            else {\n\n                currentStepExecution.executionContext = new ExecutionContext();\n            }\n            if(skipExecution){\n                currentStepExecution.exitStatus = JOB_STATUS.COMPLETED;\n                currentStepExecution.status = JOB_STATUS.COMPLETED;\n                currentStepExecution.executionContext.put(\"skipped\", true);\n            }\n\n            return this.jobRepository.addStepExecution(currentStepExecution).then((_currentStepExecution)=>{\n                currentStepExecution=_currentStepExecution;\n                if(skipExecution){\n                    log.info(\"Skipping completed step execution: [\" + step.name + \"]\");\n                    return currentStepExecution;\n                }\n                log.info(\"Executing step: [\" + step.name + \"]\");\n                return step.execute(currentStepExecution, jobResult)\n            }).then(()=>{\n                currentStepExecution.executionContext.put(\"executed\", true);\n                return currentStepExecution;\n            }).catch (e => {\n                jobExecution.status = JOB_STATUS.FAILED;\n                return this.jobRepository.update(jobExecution).then(jobExecution=>{throw e})\n            });\n\n        }).then((currentStepExecution)=>{\n            if (currentStepExecution.status == JOB_STATUS.STOPPING\n                || currentStepExecution.status == JOB_STATUS.STOPPED) {\n                // Ensure that the job gets the message that it is stopping\n                jobExecution.status = JOB_STATUS.STOPPING;\n                // throw new Error(\"Job interrupted by step execution\");\n            }\n            return this.updateProgress(jobExecution).then(()=>currentStepExecution);\n        })\n\n    }\n\n    stepExecutionPartOfExistingJobExecution(jobExecution, stepExecution) {\n        return stepExecution != null && stepExecution.jobExecution.id == jobExecution.id\n    }\n\n    shouldStart(lastStepExecution, execution, step) {\n        var stepStatus;\n        if (lastStepExecution == null) {\n            stepStatus = JOB_STATUS.STARTING;\n        }\n        else {\n            stepStatus = lastStepExecution.status;\n        }\n\n        if (stepStatus == JOB_STATUS.UNKNOWN) {\n            throw new JobRestartException(\"Cannot restart step from UNKNOWN status\")\n        }\n\n        return stepStatus != JOB_STATUS.COMPLETED || step.isRestartable;\n    }\n\n    getProgress(execution){\n        var completedSteps = execution.stepExecutions.length;\n        let progress = {\n            total: this.steps.length,\n            current: completedSteps\n        };\n        if(!completedSteps){\n            return progress\n        }\n        if(JOB_STATUS.COMPLETED !== execution.stepExecutions[execution.stepExecutions.length-1].status){\n            progress.current--;\n        }\n\n        return progress;\n    }\n\n    addStep(){\n        if(arguments.length===1){\n            return super.addStep(arguments[0])\n        }\n        var step = new Step(arguments[0], this.jobRepository);\n        step.doExecute = arguments[1];\n        return super.addStep(step);\n    }\n\n}\n","export class StepExecutionListener {\n    /*Called before a step executes*/\n    beforeStep(jobExecution) {\n\n    }\n\n    /*Called after completion of a step. Called after both successful and failed executions*/\n    afterStep(jobExecution) {\n\n    }\n}\n","import {Utils} from \"sd-utils\";\nimport {ExecutionContext} from \"./execution-context\";\nimport {JOB_STATUS} from \"./job-status\";\nimport {JobExecution} from \"./job-execution\";\n\n/*\n representation of the execution of a step\n */\nexport class StepExecution {\n    id;\n    stepName;\n    jobExecution;\n\n    status = JOB_STATUS.STARTING;\n    exitStatus = JOB_STATUS.EXECUTING;\n    executionContext = new ExecutionContext(); //execution context for single step level,\n\n    startTime = new Date();\n    endTime = null;\n    lastUpdated = null;\n\n    terminateOnly = false; //flag to indicate that an execution should halt\n    failureExceptions = [];\n\n    constructor(stepName, jobExecution, id) {\n        if(id===null || id === undefined){\n            this.id = Utils.guid();\n        }else{\n            this.id = id;\n        }\n\n        this.stepName = stepName;\n        this.jobExecution = jobExecution;\n        this.jobExecutionId = jobExecution.id;\n    }\n\n    getJobParameters(){\n        return this.jobExecution.jobParameters;\n    }\n\n    getJobExecutionContext(){\n        return this.jobExecution.executionContext;\n    }\n\n    getData(){\n        return this.jobExecution.getData();\n    }\n\n    getDTO(filteredProperties=[], deepClone = true){\n\n        var cloneMethod = Utils.cloneDeepWith;\n        if(!deepClone) {\n            cloneMethod = Utils.cloneWith;\n        }\n\n        return Utils.assign({}, cloneMethod(this, (value, key, object, stack)=> {\n            if(filteredProperties.indexOf(key)>-1){\n                return null;\n            }\n            if([\"executionContext\"].indexOf(key)>-1){\n                return value.getDTO()\n            }\n            if(value instanceof Error){\n                return Utils.getErrorDTO(value);\n            }\n\n            if (value instanceof JobExecution) {\n                return value.getDTO([\"stepExecutions\"], deepClone)\n            }\n        }))\n    }\n}\n","import {JOB_STATUS} from \"./job-status\";\nimport {log} from 'sd-utils'\n\nimport {JobInterruptedException} from \"./exceptions/job-interrupted-exception\";\n/*domain object representing the configuration of a job step*/\nexport class Step {\n\n    id;\n    name;\n    isRestartable = true;\n    skipOnRestartIfCompleted=true;\n    steps = [];\n    executionListeners = [];\n\n    jobRepository;\n\n    constructor(name, jobRepository) {\n        this.name = name;\n        this.jobRepository = jobRepository;\n    }\n\n    setJobRepository(jobRepository) {\n        this.jobRepository = jobRepository;\n    }\n\n    /*Process the step and assign progress and status meta information to the StepExecution provided*/\n    execute(stepExecution, jobResult) {\n        log.debug(\"Executing step: name=\" + this.name);\n        stepExecution.startTime = new Date();\n        stepExecution.status = JOB_STATUS.STARTED;\n        var exitStatus;\n        return this.jobRepository.update(stepExecution).then(stepExecution=>{\n            exitStatus = JOB_STATUS.EXECUTING;\n\n            this.executionListeners.forEach(listener=>listener.beforeStep(stepExecution));\n            this.open(stepExecution.executionContext);\n\n            return this.doExecute(stepExecution, jobResult)\n        }).then(_stepExecution=>{\n            stepExecution = _stepExecution;\n            exitStatus = stepExecution.exitStatus;\n\n            // Check if someone is trying to stop us\n            if (stepExecution.terminateOnly) {\n                throw new JobInterruptedException(\"JobExecution interrupted.\");\n            }\n            // Need to upgrade here not set, in case the execution was stopped\n            stepExecution.status = JOB_STATUS.COMPLETED;\n            log.debug(\"Step execution success: name=\" + this.name);\n            return stepExecution\n        }).catch(e=>{\n            stepExecution.status = this.determineJobStatus(e);\n            exitStatus = stepExecution.status;\n            stepExecution.failureExceptions.push(e);\n\n            if (stepExecution.status == JOB_STATUS.STOPPED) {\n                log.info(\"Encountered interruption executing step: \" + this.name + \" in job: \" + stepExecution.jobExecution.jobInstance.jobName, e);\n            }\n            else {\n                log.error(\"Encountered an error executing step: \" + this.name + \" in job: \" + stepExecution.jobExecution.jobInstance.jobName, e);\n            }\n            return stepExecution;\n        }).then(stepExecution=>{\n            try {\n                stepExecution.exitStatus = exitStatus;\n                this.executionListeners.forEach(listener=>listener.afterStep(stepExecution));\n            }\n            catch (e) {\n                log.error(\"Exception in afterStep callback in step \" + this.name + \" in job: \" + stepExecution.jobExecution.jobInstance.jobName, e);\n            }\n\n            stepExecution.endTime = new Date();\n            stepExecution.exitStatus = exitStatus;\n\n\n            return this.jobRepository.update(stepExecution)\n        }).then(stepExecution=>{\n            try {\n                this.close(stepExecution.executionContext);\n            }\n            catch (e) {\n                log.error(\"Exception while closing step execution resources in step: \" + this.name + \" in job: \" + stepExecution.jobExecution.jobInstance.jobName, e);\n                stepExecution.failureExceptions.push(e);\n            }\n\n            try {\n                this.close(stepExecution.executionContext);\n            }\n            catch (e) {\n                log.error(\"Exception while closing step execution resources in step: \" + this.name + \" in job: \" + stepExecution.jobExecution.jobInstance.jobName, e);\n                stepExecution.failureExceptions.push(e);\n            }\n\n            // doExecutionRelease();\n\n            log.debug(\"Step execution complete: \" + stepExecution.id);\n            return stepExecution;\n        });\n\n    }\n\n    determineJobStatus(e) {\n        if (e instanceof JobInterruptedException) {\n            return JOB_STATUS.STOPPED;\n        }\n        else {\n            return JOB_STATUS.FAILED;\n        }\n    }\n\n    /**\n     * Extension point for subclasses to execute business logic. Subclasses should set the exitStatus on the\n     * StepExecution before returning. Must return stepExecution\n     */\n    doExecute(stepExecution, jobResult) {\n    }\n\n    /**\n     * Extension point for subclasses to provide callbacks to their collaborators at the beginning of a step, to open or\n     * acquire resources. Does nothing by default.\n     */\n    open(executionContext) {\n    }\n\n    /**\n     * Extension point for subclasses to provide callbacks to their collaborators at the end of a step (right at the end\n     * of the finally block), to close or release resources. Does nothing by default.\n     */\n    close(executionContext) {\n    }\n\n\n    /*Should return progress object with fields:\n     * current\n     * total */\n    getProgress(stepExecution){\n        return {\n            total: 1,\n            current: stepExecution.status === JOB_STATUS.COMPLETED ? 1 : 0\n        }\n    }\n}\n","import * as engine from './engine/index'\n\nexport {engine}\nexport * from './jobs-manager'\nexport * from './job-worker'\n\n\n\n","import {JobExecutionListener} from \"./engine/job-execution-listener\";\nimport {JOB_STATUS} from \"./engine/job-status\";\nimport {JobInstance} from \"./engine/job-instance\";\nimport {Utils, log} from \"sd-utils\";\n\n\nexport class JobInstanceManagerConfig {\n    onJobStarted = () => {};\n    onJobCompleted = result => {};\n    onJobFailed = errors => {};\n    onJobStopped = () => {};\n    onJobTerminated = () => {};\n    onProgress = (progress) => {};\n    callbacksThisArg;\n    updateInterval = 100;\n\n    constructor(custom) {\n        if (custom) {\n            Utils.deepExtend(this, custom);\n        }\n    }\n}\n\n/*convenience class for managing and tracking job instance progress*/\nexport class JobInstanceManager extends JobExecutionListener {\n\n    jobsManger;\n    jobInstance;\n    config;\n\n    lastJobExecution;\n    lastUpdateTime;\n    progress = null;\n\n    constructor(jobsManger, jobInstanceOrExecution, config) {\n        super();\n        this.config = new JobInstanceManagerConfig(config);\n        this.jobsManger = jobsManger;\n        if (jobInstanceOrExecution instanceof JobInstance) {\n            this.jobInstance = jobInstanceOrExecution;\n            this.getLastJobExecution().then(je=> {\n                this.checkProgress();\n            })\n        } else {\n            this.lastJobExecution = jobInstanceOrExecution;\n            this.jobInstance = this.lastJobExecution.jobInstance;\n            this.checkProgress();\n        }\n        if (this.lastJobExecution && !this.lastJobExecution.isRunning()) {\n            this.afterJob(this.lastJobExecution);\n            return;\n        }\n        jobsManger.registerJobExecutionListener(this);\n    }\n\n    checkProgress() {\n\n        var self = this;\n        if (this.terminated || !this.lastJobExecution.isRunning() || this.getProgressPercents(this.progress) === 100) {\n            return;\n        }\n        this.jobsManger.getProgress(this.lastJobExecution).then(progress=> {\n            this.lastUpdateTime = new Date();\n            if (progress) {\n                this.progress = progress;\n                this.config.onProgress.call(this.config.callbacksThisArg || this, progress);\n            }\n\n            setTimeout(function () {\n                self.checkProgress();\n            }, this.config.updateInterval)\n        })\n    }\n\n    beforeJob(jobExecution) {\n        if (jobExecution.jobInstance.id !== this.jobInstance.id) {\n            return;\n        }\n\n        this.lastJobExecution = jobExecution;\n        this.config.onJobStarted.call(this.config.callbacksThisArg || this);\n    }\n\n    getProgressPercents(progress) {\n        if (!progress) {\n            return 0;\n        }\n        return progress.current * 100 / progress.total;\n    }\n\n    getProgressFromExecution(jobExecution) {\n        var job = this.jobsManger.getJobByName(jobExecution.jobInstance.jobName);\n        return job.getProgress(jobExecution);\n    }\n\n    afterJob(jobExecution) {\n        if (jobExecution.jobInstance.id !== this.jobInstance.id) {\n            return;\n        }\n        this.lastJobExecution = jobExecution;\n        if (JOB_STATUS.COMPLETED === jobExecution.status) {\n            this.jobsManger.deregisterJobExecutionListener(this);\n            this.progress = this.getProgressFromExecution(jobExecution);\n            this.config.onProgress.call(this.config.callbacksThisArg || this, this.progress);\n            this.jobsManger.getResult(jobExecution).then(result=> {\n                this.config.onJobCompleted.call(this.config.callbacksThisArg || this, result.data);\n            }).catch(e=> {\n                log.error(e);\n            })\n\n\n        } else if (JOB_STATUS.FAILED === jobExecution.status) {\n            this.config.onJobFailed.call(this.config.callbacksThisArg || this, jobExecution.failureExceptions);\n\n        } else if (JOB_STATUS.STOPPED === jobExecution.status) {\n            this.config.onJobStopped.call(this.config.callbacksThisArg || this);\n        }\n    }\n\n    getLastJobExecution(forceUpdate = false) {\n        if (!this.lastJobExecution || forceUpdate) {\n            return this.jobsManger.jobRepository.getLastJobExecutionByInstance(this.jobInstance).then(je=> {\n                this.lastJobExecution = je;\n                return je;\n            });\n        }\n        return Promise.resolve(this.lastJobExecution);\n    }\n\n    stop() {\n        return this.getLastJobExecution().then(()=> {\n            return this.jobsManger.stop(this.lastJobExecution)\n        })\n    }\n\n    resume() {\n        return this.getLastJobExecution().then(()=> {\n            return this.jobsManger.run(this.jobInstance.jobName, this.lastJobExecution.jobParameters.values, this.lastJobExecution.getData()).then(je=> {\n                this.lastJobExecution = je;\n                this.checkProgress();\n                return true;\n            }).catch(e=> {\n                log.error(e);\n                return false;\n            })\n        })\n    }\n\n    terminate() {\n        return this.getLastJobExecution().then(()=> {\n            return this.jobsManger.terminate(this.jobInstance).then(()=> {\n                this.terminated = true;\n                this.config.onJobTerminated.call(this.config.callbacksThisArg || this, this.lastJobExecution);\n                this.jobsManger.deregisterJobExecutionListener(this);\n\n                return this.lastJobExecution;\n            })\n        }).catch(e=> {\n            log.error(e);\n            return false;\n        })\n    }\n\n}\n","export class JobWorker{\n\n    worker;\n    listeners = {};\n    defaultListener;\n\n    constructor(url, defaultListener, onError){\n        var instance = this;\n        this.worker = new Worker(url);\n        this.defaultListener = defaultListener || function() {};\n        if (onError) {this.worker.onerror = onError;}\n\n        this.worker.onmessage = function(event) {\n            if (event.data instanceof Object &&\n                event.data.hasOwnProperty('queryMethodListener') && event.data.hasOwnProperty('queryMethodArguments')) {\n                var listener = instance.listeners[event.data.queryMethodListener];\n                var args = event.data.queryMethodArguments;\n                if(listener.deserializer){\n                    args = listener.deserializer(args);\n                }\n                listener.fn.apply(listener.thisArg, args);\n            } else {\n                this.defaultListener.call(instance, event.data);\n            }\n        }\n\n    }\n\n    sendQuery() {\n        if (arguments.length < 1) {\n            throw new TypeError('JobWorker.sendQuery takes at least one argument');\n        }\n        this.worker.postMessage({\n            'queryMethod': arguments[0],\n            'queryArguments': Array.prototype.slice.call(arguments, 1)\n        });\n    }\n\n    runJob(jobName, jobParametersValues, dataDTO){\n        this.sendQuery('runJob', jobName, jobParametersValues, dataDTO)\n    }\n\n    executeJob(jobExecutionId){\n        this.sendQuery('executeJob', jobExecutionId)\n    }\n\n    recompute(dataDTO, ruleNames, evalCode, evalNumeric){\n        this.sendQuery('recompute', dataDTO, ruleNames, evalCode, evalNumeric)\n    }\n\n    postMessage(message) {\n        this.worker.postMessage(message);\n    }\n\n    terminate() {\n        this.worker.terminate();\n    }\n\n    addListener(name, listener, thisArg, deserializer) {\n        this.listeners[name] = {\n            fn: listener,\n            thisArg: thisArg || this,\n            deserializer: deserializer\n        };\n    }\n\n    removeListener(name) {\n        delete this.listeners[name];\n    }\n}\n","import {Utils, log} from \"sd-utils\";\nimport {SensitivityAnalysisJob} from \"./configurations/sensitivity-analysis/n-way/sensitivity-analysis-job\";\nimport {JobLauncher} from \"./engine/job-launcher\";\nimport {JobWorker} from \"./job-worker\";\nimport {JobExecutionListener} from \"./engine/job-execution-listener\";\nimport {JobParameters} from \"./engine/job-parameters\";\nimport {IdbJobRepository} from \"./engine/job-repository/idb-job-repository\";\nimport {JOB_EXECUTION_FLAG} from \"./engine/job-execution-flag\";\nimport {RecomputeJob} from \"./configurations/recompute/recompute-job\";\nimport {ProbabilisticSensitivityAnalysisJob} from \"./configurations/sensitivity-analysis/probabilistic/probabilistic-sensitivity-analysis-job\";\nimport {TimeoutJobRepository} from \"./engine/job-repository/timeout-job-repository\";\nimport {TornadoDiagramJob} from \"./configurations/sensitivity-analysis/tornado-diagram/tornado-diagram-job\";\nimport {JOB_STATUS} from \"./engine/job-status\";\nimport {SimpleJobRepository} from \"./engine/job-repository/simple-job-repository\";\nimport {LeagueTableJob} from \"./configurations/league-table/league-table-job\";\nimport {SpiderPlotJob} from \"./configurations/sensitivity-analysis/spider-plot/spider-plot-job\";\nimport {PayoffsTransformationJob} from \"./configurations/payoffs-transformation/payoffs-transformation-job\";\n\n\nexport class JobsManagerConfig {\n\n    workerUrl = null;\n    repositoryType = 'idb';\n    clearRepository = false;\n\n    constructor(custom) {\n        if (custom) {\n            Utils.deepExtend(this, custom);\n        }\n    }\n}\n\nexport class JobsManager extends JobExecutionListener {\n\n\n    useWorker;\n    expressionsEvaluator;\n    objectiveRulesManager;\n    jobWorker;\n\n    jobRepository;\n    jobLauncher;\n\n    jobExecutionListeners = [];\n\n    afterJobExecutionPromiseResolves = {};\n    jobInstancesToTerminate = {};\n\n    constructor(expressionsEvaluator, objectiveRulesManager, config) {\n        super();\n        this.setConfig(config);\n        this.expressionEngine = expressionsEvaluator.expressionEngine;\n        this.expressionsEvaluator = expressionsEvaluator;\n        this.objectiveRulesManager = objectiveRulesManager;\n\n\n        this.useWorker = !!this.config.workerUrl;\n        if (this.useWorker) {\n            this.initWorker(this.config.workerUrl);\n        }\n\n        this.initRepository();\n\n        this.registerJobs();\n\n\n\n        this.jobLauncher = new JobLauncher(this.jobRepository, this.jobWorker, (data)=>this.serializeData(data));\n    }\n\n    setConfig(config) {\n        this.config = new JobsManagerConfig(config);\n        return this;\n    }\n\n    initRepository() {\n        switch (this.config.repositoryType){\n            case 'idb':\n                this.jobRepository = new IdbJobRepository(this.expressionEngine.getJsonReviver(), 'sd-job-repository', this.config.clearRepository);\n                break;\n            case 'timeout':\n                this.jobRepository = new TimeoutJobRepository(this.expressionEngine.getJsonReviver());\n                break;\n            case 'simple':\n                this.jobRepository = new SimpleJobRepository(this.expressionEngine.getJsonReviver());\n                break;\n            default:\n                log.error('JobsManager configuration error! Unknown repository type: '+this.config.repositoryType+'. Using default: idb');\n                this.config.repositoryType = 'idb';\n                this.initRepository()\n        }\n    }\n\n    serializeData(data) {\n        return data.serialize(true, false, false, this.expressionEngine.getJsonReplacer());\n    }\n\n    getProgress(jobExecutionOrId) {\n        var id = jobExecutionOrId;\n        if (!Utils.isString(jobExecutionOrId)) {\n            id = jobExecutionOrId.id\n        }\n        return this.jobRepository.getJobExecutionProgress(id);\n    }\n\n    getResult(jobInstanceOrExecution) {\n        let jobInstance = jobInstanceOrExecution;\n        let jobExecution = null;\n        if(jobInstanceOrExecution.jobInstance){\n            jobExecution = jobInstanceOrExecution;\n            jobInstance = jobExecution.jobInstance;\n        }\n\n        return this.jobRepository.getJobResultByInstance(jobInstance);\n    }\n\n    run(jobName, jobParametersValues, data, resolvePromiseAfterJobIsLaunched = true) {\n        return this.jobLauncher.run(jobName, jobParametersValues, data, resolvePromiseAfterJobIsLaunched).then(jobExecution=> {\n            if (resolvePromiseAfterJobIsLaunched || !jobExecution.isRunning()) {\n                return jobExecution;\n            }\n            //job was delegated to worker and is still running\n\n            return new Promise((resolve, reject)=> {\n                this.afterJobExecutionPromiseResolves[jobExecution.id] = resolve;\n            });\n        });\n    }\n\n    execute(jobExecutionOrId) {\n        return this.jobLauncher.execute(jobExecutionOrId);\n    }\n\n    stop(jobExecutionOrId) {\n        var id = jobExecutionOrId;\n        if (!Utils.isString(jobExecutionOrId)) {\n            id = jobExecutionOrId.id\n        }\n\n        return this.jobRepository.getJobExecutionById(id).then(jobExecution=> {\n            if (!jobExecution) {\n                log.error(\"Job Execution not found: \" + jobExecutionOrId);\n                return null;\n            }\n            if (!jobExecution.isRunning()) {\n                log.warn(\"Job Execution not running, status: \" + jobExecution.status + \", endTime: \" + jobExecution.endTime);\n                return jobExecution;\n            }\n\n            return this.jobRepository.saveJobExecutionFlag(jobExecution.id, JOB_EXECUTION_FLAG.STOP).then(()=>jobExecution);\n        });\n    }\n\n    /*stop job execution if running and delete job instance from repository*/\n    terminate(jobInstance) {\n        return this.jobRepository.getLastJobExecutionByInstance(jobInstance).then(jobExecution=> {\n            if (jobExecution) {\n                if(jobExecution.isRunning()){\n                    return this.jobRepository.saveJobExecutionFlag(jobExecution.id, JOB_EXECUTION_FLAG.STOP).then(()=>jobExecution);\n                }else{\n                    return this.jobRepository.removeJobInstance(jobInstance, jobExecution.jobParameters);\n                }\n            }\n        }).then(()=>{\n            this.jobInstancesToTerminate[jobInstance.id]=jobInstance;\n        })\n    }\n\n    getJobByName(jobName) {\n        return this.jobRepository.getJobByName(jobName);\n    }\n\n\n    createJobParameters(jobName, jobParametersValues) {\n        var job = this.jobRepository.getJobByName(jobName);\n        return job.createJobParameters(jobParametersValues);\n    }\n\n\n    /*Returns a promise*/\n    getLastJobExecution(jobName, jobParameters) {\n        if (this.useWorker) {\n            return this.jobWorker;\n        }\n        if (!(jobParameters instanceof JobParameters)) {\n            jobParameters = this.createJobParameters(jobParameters)\n        }\n        return this.jobRepository.getLastJobExecution(jobName, jobParameters);\n    }\n\n    initWorker(workerUrl) {\n        this.jobWorker = new JobWorker(workerUrl, ()=>{\n            log.error('error in worker', arguments);\n        });\n        var argsDeserializer = (args)=> {\n            return [this.jobRepository.reviveJobExecution(args[0])]\n        };\n\n        this.jobWorker.addListener(\"beforeJob\", this.beforeJob, this, argsDeserializer);\n        this.jobWorker.addListener(\"afterJob\", this.afterJob, this, argsDeserializer);\n        this.jobWorker.addListener(\"jobFatalError\", this.onJobFatalError, this);\n    }\n\n    registerJobs() {\n\n        let sensitivityAnalysisJob = new SensitivityAnalysisJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager);\n        let probabilisticSensitivityAnalysisJob = new ProbabilisticSensitivityAnalysisJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager);\n        if(!Utils.isWorker()){\n            sensitivityAnalysisJob.setBatchSize(1);\n            probabilisticSensitivityAnalysisJob.setBatchSize(1);\n        }\n\n        this.registerJob(sensitivityAnalysisJob);\n        this.registerJob(new TornadoDiagramJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager));\n        this.registerJob(probabilisticSensitivityAnalysisJob);\n        this.registerJob(new RecomputeJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager));\n        this.registerJob(new LeagueTableJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager));\n        this.registerJob(new SpiderPlotJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager));\n        this.registerJob(new PayoffsTransformationJob(this.jobRepository, this.expressionsEvaluator, this.objectiveRulesManager));\n    }\n\n    registerJob(job) {\n        this.jobRepository.registerJob(job);\n        job.registerExecutionListener(this)\n    }\n\n    registerJobExecutionListener(listener) {\n        this.jobExecutionListeners.push(listener);\n    }\n\n    deregisterJobExecutionListener(listener) {\n        var index = this.jobExecutionListeners.indexOf(listener);\n        if (index > -1) {\n            this.jobExecutionListeners.splice(index, 1)\n        }\n    }\n\n    beforeJob(jobExecution) {\n        log.debug(\"beforeJob\", this.useWorker, jobExecution);\n        this.jobExecutionListeners.forEach(l=>l.beforeJob(jobExecution));\n    }\n\n    afterJob(jobExecution) {\n        log.debug(\"afterJob\", this.useWorker, jobExecution);\n        this.jobExecutionListeners.forEach(l=>l.afterJob(jobExecution));\n        var promiseResolve = this.afterJobExecutionPromiseResolves[jobExecution.id];\n        if (promiseResolve) {\n            promiseResolve(jobExecution)\n        }\n\n        if(this.jobInstancesToTerminate[jobExecution.jobInstance.id]){\n            this.jobRepository.removeJobInstance(jobExecution.jobInstance, jobExecution.jobParameters);\n        }\n    }\n\n    onJobFatalError(jobExecutionId, error){\n        var promiseResolve = this.afterJobExecutionPromiseResolves[jobExecutionId];\n        if (promiseResolve) {\n            this.jobRepository.getJobExecutionById(jobExecutionId).then(jobExecution=>{\n                jobExecution.status = JOB_STATUS.FAILED;\n                if(error){\n                    jobExecution.failureExceptions.push(error);\n                }\n\n                return this.jobRepository.saveJobExecution(jobExecution).then(()=>{\n                    promiseResolve(jobExecution);\n                })\n            }).catch(e=>{\n                log.error(e);\n            })\n\n        }\n        log.debug('onJobFatalError', jobExecutionId, error);\n    }\n\n\n}\n","import {\n    ExpectedValueMaximizationRule,\n    ExpectedValueMinimizationRule,\n    MaxiMinRule,\n    MaxiMaxRule,\n    MiniMinRule,\n    MiniMaxRule\n} from \"./rules\";\nimport {log} from \"sd-utils\";\nimport * as model from \"sd-model\";\nimport {MinMaxRule} from \"./rules/min-max-rule\";\nimport {MaxMinRule} from \"./rules/max-min-rule\";\nimport {MinMinRule} from \"./rules/min-min-rule\";\nimport {MaxMaxRule} from \"./rules/max-max-rule\";\n\nexport class ObjectiveRulesManager{\n\n    expressionEngine;\n    currentRule;\n    ruleByName = {};\n    rules = [];\n\n\n    flipPair = {};\n    payoffIndex = 0;\n\n    constructor(expressionEngine, currentRuleName) {\n        this.expressionEngine = expressionEngine;\n        this.addRule(new ExpectedValueMaximizationRule(expressionEngine));\n        this.addRule(new ExpectedValueMinimizationRule(expressionEngine));\n        this.addRule(new MaxiMinRule(expressionEngine));\n        this.addRule(new MaxiMaxRule(expressionEngine));\n        this.addRule(new MiniMinRule(expressionEngine));\n        this.addRule(new MiniMaxRule(expressionEngine));\n\n        let minMax = new MinMaxRule(expressionEngine);\n        this.addRule(minMax);\n        let maxMin = new MaxMinRule(expressionEngine);\n        this.addRule(maxMin);\n        this.addFlipPair(minMax, maxMin);\n\n        let minMin = new MinMinRule(expressionEngine);\n        this.addRule(minMin);\n        let maxMax = new MaxMaxRule(expressionEngine);\n        this.addRule(maxMax);\n\n\n        if (currentRuleName) {\n            this.currentRule = this.ruleByName[currentRuleName];\n        } else {\n            this.currentRule = this.rules[0];\n        }\n\n    }\n\n\n    setPayoffIndex(payoffIndex){\n        this.payoffIndex = payoffIndex || 0;\n    }\n\n    addRule(rule){\n        this.ruleByName[rule.name]=rule;\n        this.rules.push(rule);\n    }\n\n    isRuleName(ruleName){\n         return !!this.ruleByName[ruleName]\n    }\n\n    setCurrentRuleByName(ruleName){\n        this.currentRule = this.ruleByName[ruleName];\n    }\n\n    getObjectiveRuleByName(ruleName){\n        return this.ruleByName[ruleName];\n    }\n\n    flipRule(){\n        var flipped = this.flipPair[this.currentRule.name];\n        if(flipped){\n            this.currentRule = flipped;\n        }\n    }\n\n    updateDefaultCriterion1Weight(defaultCriterion1Weight){\n        this.rules.filter(r=>r.multiCriteria).forEach(r=>r.setDefaultCriterion1Weight(defaultCriterion1Weight));\n    }\n\n    recompute(dataModel, allRules, decisionPolicy=null){\n\n        var startTime = new Date().getTime();\n        log.trace('recomputing rules, all: '+allRules);\n\n        dataModel.getRoots().forEach(n=>{\n            this.recomputeTree(n, allRules, decisionPolicy);\n        });\n\n        var time  = (new Date().getTime() - startTime/1000);\n        log.trace('recomputation took '+time+'s');\n\n        return this;\n    }\n\n    recomputeTree(root, allRules, decisionPolicy=null){\n        log.trace('recomputing rules for tree ...', root);\n\n        var startTime = new Date().getTime();\n\n        var rules  = [this.currentRule];\n        if(allRules){\n            rules = this.rules;\n        }\n\n        rules.forEach(rule=> {\n            rule.setPayoffIndex(this.payoffIndex);\n            rule.setDecisionPolicy(decisionPolicy);\n            rule.computePayoff(root);\n            rule.computeOptimal(root);\n            rule.clearDecisionPolicy();\n        });\n\n        var time  = (new Date().getTime() - startTime)/1000;\n        log.trace('recomputation took '+time+'s');\n\n        return this;\n    }\n\n\n    getNodeDisplayValue(node, name) {\n        return node.computedValue(this.currentRule.name, name)\n\n    }\n\n    getEdgeDisplayValue(e, name){\n        if(name==='probability'){\n            if(e.parentNode instanceof model.domain.DecisionNode){\n                return e.computedValue(this.currentRule.name, 'probability');\n            }\n            if(e.parentNode instanceof model.domain.ChanceNode){\n                return e.computedBaseProbability();\n            }\n            return null;\n        }\n        if(name==='payoff'){\n            if(this.currentRule.multiCriteria){\n                return e.computedValue(null, 'payoff');\n            }else{\n                return e.computedValue(null, 'payoff[' +this.payoffIndex + ']');\n            }\n\n        }\n        if(name==='optimal'){\n            return e.computedValue(this.currentRule.name, 'optimal')\n        }\n    }\n\n    addFlipPair(rule1, rule2) {\n        this.flipPair[rule1.name] = rule2;\n        this.flipPair[rule2.name] = rule1;\n    }\n\n\n}\n","import {domain as model} from 'sd-model'\nimport {ObjectiveRule} from './objective-rule'\nimport {Utils} from 'sd-utils'\n\n/*expected value maximization rule*/\nexport class ExpectedValueMaximizationRule extends ObjectiveRule{\n\n    static NAME = 'expected-value-maximization';\n\n    constructor(expressionEngine){\n        super(ExpectedValueMaximizationRule.NAME, true, expressionEngine);\n    }\n\n    //  payoff - parent edge payoff\n    computeOptimal(node, payoff=0, probabilityToEnter=1){\n        this.cValue(node, 'optimal', true);\n        if(node instanceof model.TerminalNode){\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        node.childEdges.forEach(e=>{\n            if ( this.subtract(this.computedPayoff(node),payoff).equals(this.computedPayoff(e.childNode)) || !(node instanceof model.DecisionNode) ) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.basePayoff(e), this.multiply(probabilityToEnter, this.cValue(e,'probability')));\n            }else{\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n\n}\n","import {domain as model} from 'sd-model'\nimport {ObjectiveRule} from './objective-rule'\nimport {Utils} from \"sd-utils\";\n\n/*expected value minimization rule*/\nexport class ExpectedValueMinimizationRule extends ObjectiveRule{\n\n    static NAME = 'expected-value-minimization';\n\n    constructor(expressionEngine){\n        super(ExpectedValueMinimizationRule.NAME, false, expressionEngine);\n    }\n\n    //  payoff - parent edge payoff\n    computeOptimal(node, payoff=0, probabilityToEnter=1){\n        this.cValue(node, 'optimal', true);\n        if(node instanceof model.TerminalNode){\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        node.childEdges.forEach(e=>{\n            if ( this.subtract(this.computedPayoff(node),payoff).equals(this.computedPayoff(e.childNode)) || !(node instanceof model.DecisionNode) ) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.basePayoff(e), this.multiply(probabilityToEnter, this.cValue(e,'probability')));\n            }else{\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n\n}\n","export * from './objective-rule'\nexport * from './expected-value-maximization-rule'\nexport * from './expected-value-minimization-rule'\nexport * from './maxi-max-rule'\nexport * from './maxi-min-rule'\nexport * from './mini-max-rule'\nexport * from './mini-min-rule'\n\n\n","import {MultiCriteriaRule} from \"./multi-criteria-rule\";\n\n\nexport class MaxMaxRule extends MultiCriteriaRule{\n\n    static NAME = 'max-max';\n\n    constructor(expressionEngine){\n        super(MaxMaxRule.NAME, [1, 1], expressionEngine);\n    }\n}\n","import {MultiCriteriaRule} from \"./multi-criteria-rule\";\n\n\nexport class MaxMinRule extends MultiCriteriaRule{\n\n    static NAME = 'max-min';\n\n    constructor(expressionEngine){\n        super(MaxMinRule.NAME, [1, -1], expressionEngine);\n    }\n}\n","import {domain as model} from 'sd-model'\nimport {ObjectiveRule} from './objective-rule'\nimport {Utils} from \"sd-utils\";\n\n/*maxi-max rule*/\nexport class MaxiMaxRule extends ObjectiveRule{\n\n    static NAME = 'maxi-max';\n\n    constructor(expressionEngine){\n        super(MaxiMaxRule.NAME, true, expressionEngine);\n    }\n\n\n    modifyChanceProbability(edges, bestChildPayoff, bestCount, worstChildPayoff, worstCount){\n        edges.forEach(e=>{\n            this.clearComputedValues(e);\n            this.cValue(e, 'probability', this.computedPayoff(e.childNode)<bestChildPayoff ? 0.0 : (1.0/bestCount));\n        });\n    }\n\n    //  payoff - parent edge payoff\n    computeOptimal(node, payoff = 0, probabilityToEnter = 1) {\n        this.cValue(node, 'optimal', true);\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        var optimalEdge = null;\n        if (node instanceof model.ChanceNode) {\n            optimalEdge = Utils.maxBy(node.childEdges, e=>this.computedPayoff(e.childNode));\n        }\n\n        node.childEdges.forEach(e=> {\n            var isOptimal = false;\n            if (optimalEdge) {\n                isOptimal = this.computedPayoff(optimalEdge.childNode).equals(this.computedPayoff(e.childNode));\n            } else isOptimal = !!(this.subtract(this.computedPayoff(node), payoff).equals(this.computedPayoff(e.childNode)) || !(node instanceof model.DecisionNode));\n\n            if (isOptimal) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.basePayoff(e), this.multiply(probabilityToEnter, this.cValue(e, 'probability')));\n            } else {\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n\n}\n","import {domain as model} from 'sd-model'\nimport {ObjectiveRule} from './objective-rule'\nimport {Utils} from \"sd-utils\";\n\n/*maxi-min rule*/\nexport class MaxiMinRule extends ObjectiveRule{\n\n    static NAME = 'maxi-min';\n\n    constructor(expressionEngine){\n        super(MaxiMinRule.NAME, true, expressionEngine);\n    }\n\n    modifyChanceProbability(edges, bestChildPayoff, bestCount, worstChildPayoff, worstCount){\n        edges.forEach(e=>{\n            this.clearComputedValues(e);\n            this.cValue(e, 'probability', this.computedPayoff(e.childNode)>worstChildPayoff ? 0.0 : (1.0/worstCount));\n        });\n    }\n\n    //  payoff - parent edge payoff\n    computeOptimal(node, payoff = 0, probabilityToEnter = 1) {\n        this.cValue(node, 'optimal', true);\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        var optimalEdge = null;\n        if (node instanceof model.ChanceNode) {\n            optimalEdge = Utils.minBy(node.childEdges, e=>this.computedPayoff(e.childNode));\n        }\n\n        node.childEdges.forEach(e=> {\n            var isOptimal = false;\n            if (optimalEdge) {\n                isOptimal = this.computedPayoff(optimalEdge.childNode).equals(this.computedPayoff(e.childNode));\n            } else isOptimal = !!(this.subtract(this.computedPayoff(node), payoff).equals(this.computedPayoff(e.childNode)) || !(node instanceof model.DecisionNode));\n\n            if (isOptimal) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.basePayoff(e), this.multiply(probabilityToEnter, this.cValue(e, 'probability')));\n            } else {\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n\n}\n","import {MultiCriteriaRule} from \"./multi-criteria-rule\";\n\n\nexport class MinMaxRule extends MultiCriteriaRule{\n\n    static NAME = 'min-max';\n\n    constructor(expressionEngine){\n        super(MinMaxRule.NAME, [-1, 1], expressionEngine);\n    }\n}\n","import {MultiCriteriaRule} from \"./multi-criteria-rule\";\n\n\nexport class MinMinRule extends MultiCriteriaRule{\n\n    static NAME = 'min-min';\n\n    constructor(expressionEngine){\n        super(MinMinRule.NAME, [-1, -1], expressionEngine);\n    }\n}\n","import {domain as model} from 'sd-model'\nimport {ObjectiveRule} from './objective-rule'\nimport {Utils} from \"sd-utils\";\n\n/*mini-max rule*/\nexport class MiniMaxRule extends ObjectiveRule{\n\n    static NAME = 'mini-max';\n\n    constructor(expressionEngine){\n        super(MiniMaxRule.NAME, false, expressionEngine);\n    }\n\n    modifyChanceProbability(edges, bestChildPayoff, bestCount, worstChildPayoff, worstCount){\n        edges.forEach(e=>{\n            this.clearComputedValues(e);\n            this.cValue(e, 'probability', this.computedPayoff(e.childNode)<bestChildPayoff ? 0.0 : (1.0/bestCount));\n        });\n    }\n\n    //  payoff - parent edge payoff\n    computeOptimal(node, payoff = 0, probabilityToEnter = 1) {\n        this.cValue(node, 'optimal', true);\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        var optimalEdge = null;\n        if (node instanceof model.ChanceNode) {\n            optimalEdge = Utils.maxBy(node.childEdges, e=>this.computedPayoff(e.childNode));\n        }\n\n        node.childEdges.forEach(e=> {\n            var isOptimal = false;\n            if (optimalEdge) {\n                isOptimal = this.computedPayoff(optimalEdge.childNode).equals(this.computedPayoff(e.childNode));\n            } else isOptimal = !!(this.subtract(this.computedPayoff(node), payoff).equals(this.computedPayoff(e.childNode)) || !(node instanceof model.DecisionNode));\n\n            if (isOptimal) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.basePayoff(e), this.multiply(probabilityToEnter, this.cValue(e, 'probability')));\n            } else {\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n}\n","import {domain as model} from 'sd-model'\nimport {ObjectiveRule} from './objective-rule'\nimport {Utils} from \"sd-utils\";\n\n/*mini-min rule*/\nexport class MiniMinRule extends ObjectiveRule{\n\n    static NAME = 'mini-min';\n\n    constructor(expressionEngine){\n        super(MiniMinRule.NAME, false, expressionEngine);\n    }\n\n    modifyChanceProbability(edges, bestChildPayoff, bestCount, worstChildPayoff, worstCount){\n        edges.forEach(e=>{\n            this.clearComputedValues(e);\n            this.cValue(e, 'probability', this.computedPayoff(e.childNode)>worstChildPayoff ? 0.0 : (1.0/worstCount));\n        });\n    }\n\n    //  payoff - parent edge payoff\n    computeOptimal(node, payoff = 0, probabilityToEnter = 1) {\n        this.cValue(node, 'optimal', true);\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        var optimalEdge = null;\n        if (node instanceof model.ChanceNode) {\n            optimalEdge = Utils.minBy(node.childEdges, e=>this.computedPayoff(e.childNode));\n        }\n\n        node.childEdges.forEach(e=> {\n            var isOptimal = false;\n            if (optimalEdge) {\n                isOptimal = this.computedPayoff(optimalEdge.childNode).equals(this.computedPayoff(e.childNode));\n            } else isOptimal = !!(this.subtract(this.computedPayoff(node), payoff).equals(this.computedPayoff(e.childNode)) || !(node instanceof model.DecisionNode));\n\n            if (isOptimal) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.basePayoff(e), this.multiply(probabilityToEnter, this.cValue(e, 'probability')));\n            } else {\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n\n}\n","import {domain as model} from \"sd-model\";\nimport {ObjectiveRule} from \"./objective-rule\";\nimport {Policy} from \"../../policies/policy\";\n\n\nexport class MultiCriteriaRule extends ObjectiveRule {\n\n    criterion1Weight = 1;\n    payoffCoeffs = [1, -1];\n\n    constructor(name, payoffCoeffs, expressionEngine) {\n        super(name, true, expressionEngine, true);\n        this.payoffCoeffs = payoffCoeffs;\n\n    }\n\n    setDefaultCriterion1Weight(criterion1Weight) {\n        this.criterion1Weight = criterion1Weight;\n    }\n\n    // payoff - parent edge payoff, aggregatedPayoff - aggregated payoff along path\n    computePayoff(node, payoff = [0, 0], aggregatedPayoff = [0, 0]) {\n        var childrenPayoff = [0, 0];\n        if (node.childEdges.length) {\n            if (node instanceof model.DecisionNode) {\n\n                var selectedIndexes = [];\n                var bestChild = -Infinity;\n\n                node.childEdges.forEach((e, i)=> {\n                    let basePayoffs = [this.basePayoff(e, 0), this.basePayoff(e, 1)];\n                    var childPayoff = this.computePayoff(e.childNode, basePayoffs, [this.add(basePayoffs[0], aggregatedPayoff[0]), this.add(basePayoffs[1], aggregatedPayoff[1])]);\n                    var childCombinedPayoff = this.cValue(e.childNode, 'combinedPayoff');\n                    if (childCombinedPayoff > bestChild) {\n                        bestChild = childCombinedPayoff;\n                        selectedIndexes = [i];\n                    } else if (bestChild.equals(childCombinedPayoff)) {\n                        selectedIndexes.push(i);\n                    }\n                });\n\n                if (this.decisionPolicy) {\n                    selectedIndexes = [];\n                    var decision = Policy.getDecision(this.decisionPolicy, node);\n                    if (decision) {\n                        selectedIndexes = [decision.decisionValue];\n                    }\n\n                }\n\n                node.childEdges.forEach((e, i)=> {\n                    this.clearComputedValues(e);\n                    this.cValue(e, 'probability', selectedIndexes.indexOf(i) < 0 ? 0.0 : 1.0);\n                });\n            } else {\n                node.childEdges.forEach(e=> {\n                    let basePayoffs = [this.basePayoff(e, 0), this.basePayoff(e, 1)];\n                    this.computePayoff(e.childNode, basePayoffs, [this.add(basePayoffs[0], aggregatedPayoff[0]), this.add(basePayoffs[1], aggregatedPayoff[1])]);\n                    this.clearComputedValues(e);\n                    this.cValue(e, 'probability', this.baseProbability(e));\n                });\n            }\n\n            var sumweight = 0;\n            node.childEdges.forEach(e=> {\n                sumweight = this.add(sumweight, this.cValue(e, 'probability'));\n            });\n\n            if (sumweight > 0) {\n                node.childEdges.forEach(e=> {\n                    childrenPayoff.forEach((p, i)=> {\n                        let ep = this.cValue(e.childNode, 'payoff[' + i + ']');\n                        childrenPayoff[i] = this.add(p, this.multiply(this.cValue(e, 'probability'), ep).div(sumweight))\n                    });\n                });\n            }\n\n\n        }\n        payoff.forEach((p, i)=> {\n            payoff[i] = this.add(p, childrenPayoff[i]);\n        });\n\n        this.clearComputedValues(node);\n\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'aggregatedPayoff', aggregatedPayoff);\n            this.cValue(node, 'probabilityToEnter', 0); //initial value\n        } else {\n            this.cValue(node, 'childrenPayoff', childrenPayoff);\n        }\n\n        this.cValue(node, 'combinedPayoff', this.computeCombinedPayoff(payoff));\n\n        return this.cValue(node, 'payoff', payoff);\n    }\n\n    computeCombinedPayoff(payoff){\n        // [criterion 1 coeff]*[criterion 1]*[weight]+[criterion 2 coeff]*[criterion 2]\n        if (this.criterion1Weight === Infinity) {\n            return this.multiply(this.payoffCoeffs[0], payoff[0]);\n        }\n        return this.add(this.multiply(this.payoffCoeffs[0], this.multiply(this.criterion1Weight, payoff[0])), this.multiply(this.payoffCoeffs[1], payoff[1]));\n    }\n\n    //  combinedPayoff - parent edge combinedPayoff\n    computeOptimal(node, combinedPayoff = 0, probabilityToEnter = 1) {\n        this.cValue(node, 'optimal', true);\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'probabilityToEnter', probabilityToEnter);\n        }\n\n        node.childEdges.forEach(e=> {\n            if (this.subtract(this.cValue(node, 'combinedPayoff'), combinedPayoff).equals(this.cValue(e.childNode, 'combinedPayoff')) || !(node instanceof model.DecisionNode)) {\n                this.cValue(e, 'optimal', true);\n                this.computeOptimal(e.childNode, this.computeCombinedPayoff([this.basePayoff(e, 0), this.basePayoff(e, 1)]), this.multiply(probabilityToEnter, this.cValue(e, 'probability')));\n            } else {\n                this.cValue(e, 'optimal', false);\n            }\n        })\n    }\n}\n","import {ExpressionEngine} from \"sd-expression-engine\";\nimport {domain as model} from \"sd-model\";\nimport {Policy} from \"../../policies/policy\";\n\n/*Base class for objective rules*/\nexport class ObjectiveRule {\n    name;\n    expressionEngine;\n\n    decisionPolicy;\n    maximization;\n\n    payoffIndex = 0;\n    multiCriteria = false;\n\n    constructor(name, maximization, expressionEngine, multiCriteria=false) {\n        this.name = name;\n        this.maximization = maximization;\n        this.expressionEngine = expressionEngine;\n        this.multiCriteria = multiCriteria;\n    }\n\n    setDecisionPolicy(decisionPolicy) {\n        this.decisionPolicy = decisionPolicy;\n    }\n\n    setPayoffIndex(payoffIndex) {\n        this.payoffIndex = payoffIndex;\n    }\n\n    clearDecisionPolicy() {\n        this.decisionPolicy = null;\n    }\n\n    // should return array of selected children indexes\n    makeDecision(decisionNode, childrenPayoffs) {\n        var best;\n        if (this.maximization) {\n            best = this.max(...childrenPayoffs);\n        } else {\n            best = this.min(...childrenPayoffs);\n        }\n        var selectedIndexes = [];\n        childrenPayoffs.forEach((p, i)=> {\n            if (ExpressionEngine.compare(best, p) == 0) {\n                selectedIndexes.push(i);\n            }\n        });\n        return selectedIndexes;\n    }\n\n    _makeDecision(decisionNode, childrenPayoffs) {\n        if (this.decisionPolicy) {\n            var decision = Policy.getDecision(this.decisionPolicy, decisionNode);\n            if (decision) {\n                return [decision.decisionValue];\n            }\n            return [];\n        }\n        return this.makeDecision(decisionNode, childrenPayoffs);\n    }\n\n    // extension point for changing computed probability of edges in a chance node\n    modifyChanceProbability(edges, bestChildPayoff, bestCount, worstChildPayoff, worstCount) {\n\n    }\n\n    // payoff - parent edge payoff, aggregatedPayoff - aggregated payoff along path\n    computePayoff(node, payoff = 0, aggregatedPayoff = 0) {\n        var childrenPayoff = 0;\n        if (node.childEdges.length) {\n            if (node instanceof model.DecisionNode) {\n\n                var selectedIndexes = this._makeDecision(node, node.childEdges.map(e=>this.computePayoff(e.childNode, this.basePayoff(e), this.add(this.basePayoff(e), aggregatedPayoff))));\n                node.childEdges.forEach((e, i)=> {\n                    this.clearComputedValues(e);\n                    this.cValue(e, 'probability', selectedIndexes.indexOf(i) < 0 ? 0.0 : 1.0);\n                });\n\n            } else {\n                var bestChild = -Infinity;\n                var bestCount = 1;\n                var worstChild = Infinity;\n                var worstCount = 1;\n\n                node.childEdges.forEach(e=> {\n                    var childPayoff = this.computePayoff(e.childNode, this.basePayoff(e), this.add(this.basePayoff(e), aggregatedPayoff));\n                    if (childPayoff < worstChild) {\n                        worstChild = childPayoff;\n                        worstCount = 1;\n                    } else if (childPayoff.equals(worstChild)) {\n                        worstCount++\n                    }\n                    if (childPayoff > bestChild) {\n                        bestChild = childPayoff;\n                        bestCount = 1;\n                    } else if (childPayoff.equals(bestChild)) {\n                        bestCount++\n                    }\n\n                    this.clearComputedValues(e);\n                    this.cValue(e, 'probability', this.baseProbability(e));\n                });\n                this.modifyChanceProbability(node.childEdges, bestChild, bestCount, worstChild, worstCount);\n            }\n\n            var sumweight = 0;\n            node.childEdges.forEach(e=> {\n                sumweight = this.add(sumweight, this.cValue(e, 'probability'));\n            });\n\n            // console.log(payoff,node.childEdges,'sumweight',sumweight);\n            if (sumweight > 0) {\n                node.childEdges.forEach(e=> {\n                    childrenPayoff = this.add(childrenPayoff, this.multiply(this.cValue(e, 'probability'), this.computedPayoff(e.childNode)).div(sumweight));\n                });\n            }\n\n\n        }\n\n        payoff = this.add(payoff, childrenPayoff);\n        this.clearComputedValues(node);\n\n        if (node instanceof model.TerminalNode) {\n            this.cValue(node, 'aggregatedPayoff'+ '[' + this.payoffIndex + ']', aggregatedPayoff);\n            this.cValue(node, 'probabilityToEnter', 0); //initial value\n        } else {\n            this.cValue(node, 'childrenPayoff' + '[' + this.payoffIndex + ']', childrenPayoff);\n        }\n\n        return this.computedPayoff(node, payoff);\n    }\n\n    // koloruje optymalne ścieżki\n    computeOptimal(node) {\n        throw 'computeOptimal function not implemented for rule: ' + this.name\n    }\n\n    /* get or set computed payoff*/\n    computedPayoff(node, value){\n        return this.cValue(node, 'payoff[' + this.payoffIndex + ']', value)\n    }\n\n    /*Get or set object's computed value for current rule*/\n    cValue(object, fieldPath, value) {\n        // if(fieldPath.trim() === 'payoff'){\n        //     fieldPath += '[' + this.payoffIndex + ']';\n        // }\n\n        return object.computedValue(this.name, fieldPath, value);\n    }\n\n    baseProbability(edge) {\n        return edge.computedBaseProbability();\n    }\n\n    basePayoff(edge, payoffIndex) {\n        return edge.computedBasePayoff(undefined, payoffIndex || this.payoffIndex);\n    }\n\n    clearComputedValues(object) {\n        object.clearComputedValues(this.name);\n    }\n\n    add(a, b) {\n        return ExpressionEngine.add(a, b)\n    }\n\n    subtract(a, b) {\n        return ExpressionEngine.subtract(a, b)\n    }\n\n    divide(a, b) {\n        return ExpressionEngine.divide(a, b)\n    }\n\n    multiply(a, b) {\n        return ExpressionEngine.multiply(a, b)\n    }\n\n    max() {\n        return ExpressionEngine.max(...arguments)\n    }\n\n    min() {\n        return ExpressionEngine.min(...arguments)\n    }\n\n}\n","import {domain as model} from 'sd-model'\nimport {ExpressionEngine} from 'sd-expression-engine'\nimport {log} from 'sd-utils'\nimport {Operation} from \"./operation\";\nimport {TreeValidator} from \"../validation/tree-validator\";\n\n/*Subtree flipping operation*/\nexport class FlipSubtree extends Operation{\n\n    static $NAME = 'flipSubtree';\n    data;\n    expressionEngine;\n\n    constructor(data, expressionEngine) {\n        super(FlipSubtree.$NAME);\n        this.data = data;\n        this.expressionEngine = expressionEngine;\n        this.treeValidator = new TreeValidator(expressionEngine);\n    }\n\n    isApplicable(object){\n        return object instanceof model.ChanceNode\n    }\n\n    canPerform(node) {\n        if (!this.isApplicable(node)) {\n            return false;\n        }\n\n        if (!this.treeValidator.validate(this.data.getAllNodesInSubtree(node)).isValid()) { //check if the whole subtree is proper\n            return false;\n        }\n\n        if (node.childEdges.length < 1) {\n            return false;\n        }\n\n\n        var grandchildrenNumber = null;\n        var grandchildrenEdgeLabels = [];\n        var childrenEdgeLabelsSet = new Set();\n        var grandchildrenEdgeLabelsSet;\n        if (!node.childEdges.every(e=> {\n\n                var child = e.childNode;\n                if (!(child instanceof model.ChanceNode)) {\n                    return false;\n                }\n\n                if (childrenEdgeLabelsSet.has(e.name.trim())) { // edge labels should be unique\n                    return false;\n                }\n                childrenEdgeLabelsSet.add(e.name.trim());\n\n                if (grandchildrenNumber === null) {\n                    grandchildrenNumber = child.childEdges.length;\n                    if (grandchildrenNumber < 1) {\n                        return false;\n                    }\n                    child.childEdges.forEach(ge=> {\n                        grandchildrenEdgeLabels.push(ge.name.trim());\n                    });\n\n                    grandchildrenEdgeLabelsSet = new Set(grandchildrenEdgeLabels);\n\n                    if (grandchildrenEdgeLabelsSet.size !== grandchildrenEdgeLabels.length) { //grandchildren edge labels should be unique\n                        return false;\n                    }\n\n                    return true;\n                }\n\n                if (child.childEdges.length != grandchildrenNumber) {\n                    return false;\n                }\n\n                if (!child.childEdges.every((ge, i)=>grandchildrenEdgeLabels[i] === ge.name.trim())) {\n                    return false;\n                }\n\n                return true;\n\n            })) {\n\n            return false;\n        }\n\n        return true;\n    }\n\n    perform(root) {\n\n        var rootClone = this.data.cloneSubtree(root, true);\n        var oldChildrenNumber = root.childEdges.length;\n        var oldGrandChildrenNumber = root.childEdges[0].childNode.childEdges.length;\n\n        var childrenNumber = oldGrandChildrenNumber;\n        var grandChildrenNumber = oldChildrenNumber;\n\n        var callbacksDisabled = this.data.callbacksDisabled;\n        this.data.callbacksDisabled = true;\n\n\n        var childX = root.childEdges[0].childNode.location.x;\n        var topY = root.childEdges[0].childNode.childEdges[0].childNode.location.y;\n        var bottomY = root.childEdges[oldChildrenNumber - 1].childNode.childEdges[oldGrandChildrenNumber - 1].childNode.location.y;\n\n        var extentY = bottomY - topY;\n        var stepY = extentY / (childrenNumber + 1);\n\n        root.childEdges.slice().forEach(e=> this.data.removeNode(e.childNode));\n\n\n        for (var i = 0; i < childrenNumber; i++) {\n            var child = new model.ChanceNode(new model.Point(childX, topY + (i + 1) * stepY));\n            var edge = this.data.addNode(child, root);\n            edge.name = rootClone.childEdges[0].childNode.childEdges[i].name;\n\n            edge.probability = 0;\n\n            for (var j = 0; j < grandChildrenNumber; j++) {\n                var grandChild = rootClone.childEdges[j].childNode.childEdges[i].childNode;\n\n\n                var grandChildEdge = this.data.attachSubtree(grandChild, child);\n                grandChildEdge.name = rootClone.childEdges[j].name;\n                grandChildEdge.payoff = [\n                    ExpressionEngine.add(rootClone.childEdges[j].computedBasePayoff(undefined, 0), rootClone.childEdges[j].childNode.childEdges[i].computedBasePayoff(undefined, 0)),\n                    ExpressionEngine.add(rootClone.childEdges[j].computedBasePayoff(undefined, 1), rootClone.childEdges[j].childNode.childEdges[i].computedBasePayoff(undefined, 1)),\n                ];\n\n                grandChildEdge.probability = ExpressionEngine.multiply(rootClone.childEdges[j].computedBaseProbability(), rootClone.childEdges[j].childNode.childEdges[i].computedBaseProbability());\n                edge.probability = ExpressionEngine.add(edge.probability, grandChildEdge.probability);\n            }\n\n            var divideGrandChildEdgeProbability = p => ExpressionEngine.divide(p, edge.probability);\n            if (edge.probability.equals(0)) {\n                var prob = ExpressionEngine.divide(1, grandChildrenNumber);\n                divideGrandChildEdgeProbability = p => prob;\n            }\n\n            var probabilitySum = 0.0;\n            child.childEdges.forEach(grandChildEdge=> {\n                grandChildEdge.probability = divideGrandChildEdgeProbability(grandChildEdge.probability);\n                probabilitySum = ExpressionEngine.add(probabilitySum, grandChildEdge.probability);\n                grandChildEdge.probability = this.expressionEngine.serialize(grandChildEdge.probability)\n            });\n\n            this._normalizeProbabilitiesAfterFlip(child.childEdges, probabilitySum);\n            edge.probability = this.expressionEngine.serialize(edge.probability)\n        }\n        this._normalizeProbabilitiesAfterFlip(root.childEdges);\n\n\n        this.data.callbacksDisabled = callbacksDisabled;\n        this.data._fireNodeAddedCallback();\n    }\n\n    _normalizeProbabilitiesAfterFlip(childEdges, probabilitySum){\n        if(!probabilitySum){\n            probabilitySum = 0.0;\n            childEdges.forEach(e=> {\n                probabilitySum = ExpressionEngine.add(probabilitySum, e.probability);\n            });\n        }\n        if (!probabilitySum.equals(1)) {\n            log.info('Sum of the probabilities in child nodes is not equal to 1 : ', probabilitySum);\n            var newProbabilitySum = 0.0;\n            var cf = 1000000000000; //10^12\n            var prec = 12;\n            childEdges.forEach(e=> {\n                e.probability = parseInt(ExpressionEngine.round(e.probability, prec) * cf);\n                newProbabilitySum = newProbabilitySum + e.probability;\n            });\n            var rest = cf - newProbabilitySum;\n            log.info('Normalizing with rounding to precision: ' + prec, rest);\n            childEdges[0].probability = ExpressionEngine.add(rest, childEdges[0].probability);\n            newProbabilitySum = 0.0;\n            childEdges.forEach(e=> {\n                e.probability = this.expressionEngine.serialize(ExpressionEngine.divide(parseInt(e.probability), cf))\n            })\n        }\n    }\n}\n","\n\n\n/*Base class for complex operations executing a job*/\nimport {Operation} from \"./operation\";\n\nexport class JobExecutingOperation extends Operation{\n\n\n    jobName; //Job name if this operation executes a job\n\n    constructor(name, jobName = null){\n        super(name);\n\n        this.name = name;\n        this.jobName = jobName;\n    }\n\n\n    //check if can perform operation for applicable object\n    canPerform(object, params){\n\n        throw 'canPerform function not implemented for operation: '+this.name\n    }\n\n    //Performed in job by operations manager\n    perform(object, params, ){\n\n    }\n\n\n    postProcess(object, params){\n\n    }\n\n\n}\n","\n\n\n/*Base class for complex operations on tree structure*/\nexport class Operation{\n\n    name;\n\n    constructor(name){\n        this.name = name;\n    }\n\n    //check if operation is potentially applicable for object\n    isApplicable(object){\n        throw 'isApplicable function not implemented for operation: '+this.name\n    }\n\n    //check if can perform operation for applicable object\n    canPerform(object){\n        throw 'canPerform function not implemented for operation: '+this.name\n    }\n\n    perform(object, params){\n        throw 'perform function not implemented for operation: '+this.name\n    }\n\n\n}\n","import {FlipSubtree} from \"./flip-subtree\";\nimport {PayoffsTransformation} from \"./payoffs-transformation.js\";\n\n\nexport class OperationsManager {\n\n    operations = [];\n    operationByName = {};\n\n    constructor(data, expressionEngine, jobsManger){\n        this.data = data;\n        this.expressionEngine = expressionEngine;\n        this.jobsManger = jobsManger;\n        this.registerOperation(new FlipSubtree(data, expressionEngine));\n        this.registerOperation(new PayoffsTransformation(data, expressionEngine));\n    }\n\n    registerOperation(operation){\n        this.operations.push(operation);\n        this.operationByName[operation.name] = operation;\n    }\n\n\n    getOperationByName(name){\n        return this.operationByName[name];\n    }\n\n    operationsForObject(object){\n        return this.operations.filter(op=>op.isApplicable(object))\n    }\n\n    setData(data){\n        this.data = data;\n        this.operations.forEach(o => o.data = data)\n    }\n\n    performOperation(object, operationName, jobParamsValues){\n\n        let operation = this.getOperationByName(operationName);\n\n        if(!operation.jobName){\n            return Promise.resolve(operation.perform(object, jobParamsValues))\n        }\n\n        jobParamsValues['objectId'] = object.id;\n\n        return this.jobsManger.run(operation.jobName, jobParamsValues, this.data, false).then((jobExecution)=> {\n\n            const d = jobExecution.getData();\n            this.data.nodes = d.nodes;\n            this.data.edges = d.edges;\n            this.data.code = d.code;\n\n            operation.postProcess(object, jobParamsValues);\n\n            return true;\n        })\n    }\n}\n","import {domain as model} from 'sd-model'\nimport {TreeValidator} from \"../validation/tree-validator\";\nimport {JobExecutingOperation} from \"./job-executing-operation\";\nimport {PayoffsTransformationJob} from \"../jobs/configurations/payoffs-transformation/payoffs-transformation-job\";\n\n\nexport class PayoffsTransformation extends JobExecutingOperation {\n\n    static $NAME = 'payoffsTransformation';\n\n    data;\n    expressionEngine;\n\n    constructor(data, expressionEngine) {\n        super(PayoffsTransformation.$NAME, PayoffsTransformationJob.$NAME);\n        this.data = data;\n        this.expressionEngine = expressionEngine;\n        this.treeValidator = new TreeValidator(expressionEngine);\n    }\n\n    isApplicable(object){\n        return object instanceof model.ChanceNode || object instanceof model.DecisionNode\n    }\n\n    canPerform(node) {\n        if (!this.isApplicable(node)) {\n            return false;\n        }\n\n        if (!this.treeValidator.validate(this.data.getAllNodesInSubtree(node)).isValid()) { //check if the whole subtree is proper\n            return false;\n        }\n\n        return !node.$parent && node.childEdges.length > 0;\n    }\n\n}\n","\nexport class Decision{\n    node;\n    decisionValue; //index of  selected edge\n    children = [];\n    key;\n\n    constructor(node, decisionValue) {\n        this.node = node;\n        this.decisionValue = decisionValue;\n        this.key = Decision.generateKey(this);\n    }\n\n    static generateKey(decision, keyProperty='id'){\n        var e = decision.node.childEdges[decision.decisionValue];\n        var key = decision.node[keyProperty]+\":\"+(e[keyProperty]? e[keyProperty] : decision.decisionValue+1);\n        return key.replace(/\\n/g, ' ');\n    }\n\n    addDecision(node, decisionValue){\n        var decision = new Decision(node, decisionValue);\n        this.children.push(decision);\n        this.key = Decision.generateKey(this);\n        return decision;\n    }\n\n    getDecision(decisionNode){\n        return Decision.getDecision(this, decisionNode)\n    }\n\n    static getDecision(decision, decisionNode){\n        if(decision.node===decisionNode || decision.node.id === decisionNode.id){\n            return decision;\n        }\n        for(var i=0; i<decision.children.length; i++){\n            var d = Decision.getDecision(decision.children[i], decisionNode);\n            if(d){\n                return d;\n            }\n        }\n    }\n\n    static toDecisionString(decision, extended=false, keyProperty='name', indent = ''){\n\n        var res = Decision.generateKey(decision, keyProperty);\n        var childrenRes = \"\";\n\n        decision.children.forEach(d=>{\n            if(childrenRes){\n                if(extended){\n                    childrenRes += '\\n'+indent;\n                }else{\n                    childrenRes += \", \"\n                }\n\n            }\n            childrenRes += Decision.toDecisionString(d,extended,keyProperty, indent+'\\t')\n        });\n        if(decision.children.length){\n            if(extended){\n                childrenRes =  '\\n'+indent +childrenRes;\n            }else{\n                childrenRes = \" - (\" + childrenRes + \")\";\n            }\n\n\n\n        }\n\n        return res+childrenRes;\n    }\n\n    toDecisionString(indent=false){\n        return Decision.toDecisionString(this, indent)\n    }\n}\n","import {Policy} from \"./policy\";\nimport {domain as model} from 'sd-model'\nimport {Utils} from 'sd-utils'\nimport {Decision} from \"./decision\";\n\nexport class PoliciesCollector{\n    policies = [];\n    ruleName=false;\n\n    constructor(root, optimalForRuleName){\n        this.ruleName = optimalForRuleName;\n        this.collect(root).forEach((decisions,i)=>{\n            this.policies.push(new Policy(\"#\"+(i+1), decisions));\n        });\n        if(this.policies.length===1){\n            this.policies[0].id = \"default\"\n        }\n    }\n\n    collect(root){\n        var nodeQueue = [root];\n        var node;\n        var decisionNodes = [];\n        while(nodeQueue.length){\n            node = nodeQueue.shift();\n\n            if(this.ruleName && !node.computedValue(this.ruleName, 'optimal')){\n                continue;\n            }\n\n            if(node instanceof model.DecisionNode){\n                decisionNodes.push(node);\n                continue;\n            }\n\n            node.childEdges.forEach((edge, i)=>{\n                nodeQueue.push(edge.childNode)\n            })\n        }\n\n        return Utils.cartesianProductOf(decisionNodes.map((decisionNode)=>{\n            var decisions= [];\n            decisionNode.childEdges.forEach((edge, i)=>{\n\n                if(this.ruleName && !edge.computedValue(this.ruleName, 'optimal')){\n                    return;\n                }\n\n                var childDecisions = this.collect(edge.childNode); //all possible child decisions (cartesian)\n                childDecisions.forEach(cd=>{\n                    var decision = new Decision(decisionNode, i);\n                    decisions.push(decision);\n                    decision.children = cd;\n                })\n\n            });\n            return decisions;\n        }));\n    }\n\n}\n","import {Decision} from \"./decision\";\n\nexport class Policy{\n    id;\n    decisions = [];\n\n    constructor(id, decisions){\n        this.id = id;\n        this.decisions = decisions || [];\n        this.key = Policy.generateKey(this);\n    }\n\n    addDecision(node, decisionValue){\n        var decision = new Decision(node, decisionValue);\n        this.decisions .push(decision);\n        this.key = Policy.generateKey(this);\n        return decision;\n    }\n\n    static generateKey(policy){\n        var key = \"\";\n        policy.decisions.forEach(d=>key+=(key? \"&\": \"\")+d.key);\n        return key;\n    }\n\n    equals(policy, ignoreId=true){\n        if(this.key != policy.key){\n            return false;\n        }\n\n        return ignoreId || this.id === policy.id;\n    }\n\n    getDecision(decisionNode){\n        return Policy.getDecision(this, decisionNode);\n    }\n\n    static getDecision(policy, decisionNode){\n        for(var i=0; i<policy.decisions.length; i++){\n            var decision = Decision.getDecision(policy.decisions[i], decisionNode);\n            if(decision){\n                return decision;\n            }\n        }\n        return null;\n    }\n\n    static toPolicyString(policy, extended=false, prependId=false){\n\n        var res = \"\";\n        policy.decisions.forEach(d=>{\n            if(res){\n                if(extended){\n                    res += \"\\n\"\n                }else{\n                    res += \", \"\n                }\n\n\n            }\n            res += Decision.toDecisionString(d, extended, 'name', '\\t');\n        });\n        if(prependId && policy.id!==undefined){\n            return policy.id+\" \"+res;\n        }\n        return res;\n    }\n\n\n    toPolicyString(indent=false){\n        return Policy.toPolicyString(this, indent)\n    }\n\n\n}\n","import {ExpressionEngine} from 'sd-expression-engine'\nimport {Utils} from \"sd-utils\";\n\n\nexport class McdmWeightValueValidator{\n\n    additionalValidator = null;\n\n    constructor(additionalValidator){\n        this.additionalValidator = additionalValidator;\n    }\n\n    validate(value){\n        if(value===null || value === undefined){\n            return false;\n        }\n\n        let parsed = parseFloat(value);\n        if(parsed !== Infinity && !ExpressionEngine.validate(value, {}, false)){\n            return false\n        }\n\n        value = ExpressionEngine.toNumber(value);\n        var maxSafeInteger = Number.MAX_SAFE_INTEGER || 9007199254740991; // Number.MAX_SAFE_INTEGER is undefined in IE\n        if(ExpressionEngine.compare(value, 0) < 0 || (value !== Infinity && ExpressionEngine.compare(value, maxSafeInteger)> 0)){\n            return false;\n        }\n\n        if(this.additionalValidator) {\n            return this.additionalValidator(ExpressionEngine.toNumber(value))\n        }\n\n        return true;\n    }\n\n}\n","import {ExpressionEngine} from 'sd-expression-engine'\nimport {Utils} from \"sd-utils\";\n\n/*Computed base value validator*/\nexport class PayoffValueValidator{\n    expressionEngine;\n    constructor(expressionEngine){\n        this.expressionEngine=expressionEngine;\n    }\n\n    validate(value){\n\n\n        if(value===null || value === undefined){\n            return false;\n        }\n\n        value = ExpressionEngine.toNumber(value);\n        var maxSafeInteger = Number.MAX_SAFE_INTEGER || 9007199254740991; // Number.MAX_SAFE_INTEGER in undefined in IE\n        return ExpressionEngine.compare(value, -maxSafeInteger) >= 0 && ExpressionEngine.compare(value, maxSafeInteger) <= 0;\n    }\n\n}\n","import {ExpressionEngine} from 'sd-expression-engine'\nimport {Utils} from \"sd-utils\";\n\n/*Computed base value validator*/\nexport class ProbabilityValueValidator{\n    expressionEngine;\n    constructor(expressionEngine){\n        this.expressionEngine=expressionEngine;\n    }\n\n    validate(value, edge){\n        if(value===null || value === undefined){\n            return false;\n        }\n\n        var value = ExpressionEngine.toNumber(value);\n        return value.compare(0) >= 0 && value.compare(1) <= 0;\n    }\n\n}\n","import {domain as model, ValidationResult} from \"sd-model\";\nimport {ExpressionEngine} from \"sd-expression-engine\";\nimport {ProbabilityValueValidator} from \"./probability-value-validator\";\nimport {PayoffValueValidator} from \"./payoff-value-validator\";\n\nexport class TreeValidator {\n\n    expressionEngine;\n\n    constructor(expressionEngine) {\n        this.expressionEngine = expressionEngine;\n        this.probabilityValueValidator = new ProbabilityValueValidator(expressionEngine);\n        this.payoffValueValidator = new PayoffValueValidator(expressionEngine);\n    }\n\n    validate(nodes) {\n\n        var validationResult = new ValidationResult();\n\n        nodes.forEach(n=> {\n            this.validateNode(n, validationResult);\n        });\n\n        return validationResult;\n    }\n\n    validateNode(node, validationResult = new ValidationResult()) {\n\n        if (node instanceof model.TerminalNode) {\n            return;\n        }\n        if (!node.childEdges.length) {\n            validationResult.addError('incompletePath', node)\n        }\n\n        var probabilitySum = ExpressionEngine.toNumber(0);\n        var withHash = false;\n        node.childEdges.forEach((e, i)=> {\n            e.setValueValidity('probability', true);\n\n            if (node instanceof model.ChanceNode) {\n                var probability = e.computedBaseProbability();\n                if (!this.probabilityValueValidator.validate(probability)) {\n                    if (!ExpressionEngine.isHash(e.probability)) {\n                        validationResult.addError({name: 'invalidProbability', data: {'number': i + 1}}, node);\n                        e.setValueValidity('probability', false);\n                    }\n\n                } else {\n                    probabilitySum = ExpressionEngine.add(probabilitySum, probability);\n                }\n            }\n\n            e.payoff.forEach((rawPayoff, payoffIndex)=> {\n                var path = 'payoff[' + payoffIndex + ']';\n                e.setValueValidity(path, true);\n                var payoff = e.computedBasePayoff(undefined, payoffIndex);\n                if (!this.payoffValueValidator.validate(payoff)) {\n                    validationResult.addError({name: 'invalidPayoff', data: {'number': i + 1}}, node);\n                    e.setValueValidity(path, false);\n                }\n            })\n\n\n        });\n        if (node instanceof model.ChanceNode) {\n            if (isNaN(probabilitySum) || !probabilitySum.equals(1)) {\n                validationResult.addError('probabilityDoNotSumUpTo1', node);\n            }\n        }\n\n\n        return validationResult;\n    }\n}\n","export * from './src/index'\n"]}
require=function e(t,n,o){function i(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";!function(){function e(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function o(e,t,o){var i,r=new Promise(function(r,a){i=e[t].apply(e,o),n(i).then(r,a)});return r.request=i,r}function i(e,t,n){var i=o(e,t,n);return i.then(function(e){if(e)return new l(e,i.request)})}function r(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function a(e,t,n,i){i.forEach(function(i){i in n.prototype&&(e.prototype[i]=function(){return o(this[t],i,arguments)})})}function u(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function s(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return i(this[t],o,arguments)})})}function c(e){this._index=e}function l(e,t){this._cursor=e,this._request=t}function f(e){this._store=e}function p(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function b(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new p(n)}function d(e){this._db=e}r(c,"_index",["name","keyPath","multiEntry","unique"]),a(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(l,"_cursor",["direction","key","primaryKey","value"]),a(l,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(l.prototype[e]=function(){var t=this,o=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,o),n(t._request).then(function(e){if(e)return new l(e,t._request)})})})}),f.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},f.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},r(f,"_store",["name","keyPath","indexNames","autoIncrement"]),a(f,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(f,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),u(f,"_store",IDBObjectStore,["deleteIndex"]),p.prototype.objectStore=function(){return new f(this._tx.objectStore.apply(this._tx,arguments))},r(p,"_tx",["objectStoreNames","mode"]),u(p,"_tx",IDBTransaction,["abort"]),b.prototype.createObjectStore=function(){return new f(this._db.createObjectStore.apply(this._db,arguments))},r(b,"_db",["name","version","objectStoreNames"]),u(b,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new p(this._db.transaction.apply(this._db,arguments))},r(d,"_db",["name","version","objectStoreNames"]),u(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[f,c].forEach(function(n){n.prototype[t.replace("open","iterate")]=function(){var n=e(arguments),o=n[n.length-1],i=this._store||this._index,r=i[t].apply(i,n.slice(0,-1));r.onsuccess=function(){o(r.result)}}})}),[c,f].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(i){n.iterateCursor(e,function(e){return e?(o.push(e.value),void 0!==t&&o.length==t?void i(o):void e["continue"]()):void i(o)})})})});var y={open:function(e,t,n){var i=o(indexedDB,"open",[e,t]),r=i.request;return r.onupgradeneeded=function(e){n&&n(new b(r.result,e.oldVersion,r.transaction))},i.then(function(e){return new d(e)})},"delete":function(e){return o(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof t?t.exports=y:self.idb=y}()},{}],2:[function(e,t,n){(function(t){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.ComputationsEngine=n.ComputationsEngineConfig=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function p(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:p(i,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},c=e("sd-utils"),l=e("sd-model"),f=e("./computations-manager");n.ComputationsEngineConfig=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.logLevel="warn",e&&c.Utils.deepExtend(n,e),n}return r(t,e),t}(f.ComputationsManagerConfig),n.ComputationsEngine=function(e){function n(e,r){o(this,n);var a=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,r));if(a.global=c.Utils.getGlobalObject(),a.isWorker=c.Utils.isWorker(),a.isWorker){a.jobsManger.registerJobExecutionListener({beforeJob:function(e){a.reply("beforeJob",e.getDTO())},afterJob:function(e){a.reply("afterJob",e.getDTO())}});var u=a;a.queryableFunctions={runJob:function(e,t,n){var o=new l.DataModel(n);u.runJob(e,t,o)},executeJob:function(e){u.jobsManger.execute(e)["catch"](function(t){u.reply("jobFatalError",e,c.Utils.getErrorDTO(t))})},recompute:function(e,t,n,o){t&&u.objectiveRulesManager.setCurrentRuleByName(t);var i=!t,r=new l.DataModel(e);u._checkValidityAndRecomputeObjective(r,i,n,o),this.reply("recomputed",r.getDTO())}},t.onmessage=function(e){e.data instanceof Object&&e.data.hasOwnProperty("queryMethod")&&e.data.hasOwnProperty("queryArguments")?u.queryableFunctions[e.data.queryMethod].apply(self,e.data.queryArguments):u.defaultReply(e.data)}}return a}return r(n,e),u(n,[{key:"setConfig",value:function(e){return s(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setConfig",this).call(this,e),this.setLogLevel(this.config.logLevel),this}},{key:"setLogLevel",value:function(e){c.log.setLevel(e)}},{key:"defaultReply",value:function(e){this.reply("test",e)}},{key:"reply",value:function(){if(arguments.length<1)throw new TypeError("reply - not enough arguments");this.global.postMessage({queryMethodListener:arguments[0],queryMethodArguments:Array.prototype.slice.call(arguments,1)})}}]),n}(f.ComputationsManager)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./computations-manager":3,"sd-model":"sd-model","sd-utils":"sd-utils"}],3:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ComputationsManager=n.ComputationsManagerConfig=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-expression-engine"),a=e("sd-utils"),u=e("./objective/objective-rules-manager"),s=e("./validation/tree-validator"),c=e("./operations/operations-manager"),l=e("./jobs/jobs-manager"),f=e("./expressions-evaluator"),p=(e("./jobs/engine/exceptions/job-data-invalid-exception"),e("./jobs/engine/exceptions/job-parameters-invalid-exception"),e("./jobs/job-instance-manager")),b=e("sd-model"),d=e("./policies/policy"),y=n.ComputationsManagerConfig=function h(e){o(this,h),this.logLevel=null,this.ruleName=null,this.worker={delegateRecomputation:!1,url:null},e&&a.Utils.deepExtend(this,e)};n.ComputationsManager=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,e),this.data=n,this.setConfig(t),this.expressionEngine=new r.ExpressionEngine,this.expressionsEvaluator=new f.ExpressionsEvaluator(this.expressionEngine),this.objectiveRulesManager=new u.ObjectiveRulesManager(this.data,this.expressionEngine,this.config.ruleName),this.operationsManager=new c.OperationsManager(this.data,this.expressionEngine),this.jobsManger=new l.JobsManager(this.expressionsEvaluator,this.objectiveRulesManager,this.config.worker.url),this.treeValidator=new s.TreeValidator(this.expressionEngine)}return i(e,[{key:"setConfig",value:function(e){return this.config=new y(e),this}},{key:"getCurrentRule",value:function(){return this.objectiveRulesManager.currentRule}},{key:"getJobByName",value:function(e){return this.jobsManger.getJobByName(e)}},{key:"runJob",value:function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.jobsManger.run(e,t,n||this.data,o)}},{key:"runJobWithInstanceManager",value:function(e,t,n){var o=this;return this.runJob(e,t).then(function(e){return new p.JobInstanceManager(o.jobsManger,e,n)})}},{key:"getObjectiveRules",value:function(){return this.objectiveRulesManager.rules}},{key:"isRuleName",value:function(e){return this.objectiveRulesManager.isRuleName(e)}},{key:"setCurrentRuleByName",value:function(e){return this.config.ruleName=e,this.objectiveRulesManager.setCurrentRuleByName(e)}},{key:"operationsForObject",value:function(e){return this.operationsManager.operationsForObject(e)}},{key:"checkValidityAndRecomputeObjective",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Promise.resolve().then(function(){if(t.config.worker.delegateRecomputation){var i={evalCode:n,evalNumeric:o};return e||(i.ruleName=t.getCurrentRule().name),t.runJob("recompute",i,t.data,!1).then(function(e){var n=e.getData();t.data.updateFrom(n)})}return t._checkValidityAndRecomputeObjective(t.data,e,n,o)}).then(function(){t.updateDisplayValues(t.data)})}},{key:"_checkValidityAndRecomputeObjective",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.validationResults=[],(o||i)&&this.expressionsEvaluator.evalExpressions(e,o,i),e.getRoots().forEach(function(o){var i=n.treeValidator.validate(e.getAllNodesInSubtree(o));e.validationResults.push(i),i.isValid()&&n.objectiveRulesManager.recomputeTree(o,t)})}},{key:"isValid",value:function(e){var e=e||this.data;return e.validationResults.every(function(e){return e.isValid()})}},{key:"updateDisplayValues",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e=e||this.data,n?this.displayPolicy(e,n):(e.nodes.forEach(function(e){t.updateNodeDisplayValues(e)}),void e.edges.forEach(function(e){t.updateEdgeDisplayValues(e)}))}},{key:"updateNodeDisplayValues",value:function(e){var t=this;e.$DISPLAY_VALUE_NAMES.forEach(function(n){return e.displayValue(n,t.objectiveRulesManager.getNodeDisplayValue(e,n))})}},{key:"updateEdgeDisplayValues",value:function(e){var t=this;e.$DISPLAY_VALUE_NAMES.forEach(function(n){return e.displayValue(n,t.objectiveRulesManager.getEdgeDisplayValue(e,n))})}},{key:"displayPolicy",value:function(e,t){var n=this;t=t||this.data,t.nodes.forEach(function(e){e.clearDisplayValues()}),t.edges.forEach(function(e){e.clearDisplayValues()}),t.getRoots().forEach(function(t){return n.displayPolicyForNode(t,e)})}},{key:"displayPolicyForNode",value:function(e,t){var n=this;if(e instanceof b.domain.DecisionNode){var o=d.Policy.getDecision(t,e);if(o){e.displayValue("optimal",!0);var i=e.childEdges[o.decisionValue];return i.displayValue("optimal",!0),this.displayPolicyForNode(i.childNode,t)}}else e.childEdges.forEach(function(e){return n.displayPolicyForNode(e.childNode,t)})}}]),e}()},{"./expressions-evaluator":5,"./jobs/engine/exceptions/job-data-invalid-exception":25,"./jobs/engine/exceptions/job-parameters-invalid-exception":29,"./jobs/job-instance-manager":52,"./jobs/jobs-manager":54,"./objective/objective-rules-manager":55,"./operations/operations-manager":66,"./policies/policy":69,"./validation/tree-validator":72,"sd-expression-engine":"sd-expression-engine","sd-model":"sd-model","sd-utils":"sd-utils"}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ComputationsUtils=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-expression-engine");n.ComputationsUtils=function(){function e(){o(this,e)}return i(e,null,[{key:"sequence",value:function(e,t,n){var o=r.ExpressionEngine.subtract(t,e),i=[e],a=n-1;if(!a)return i;for(var u=r.ExpressionEngine.divide(o,n-1),s=e,c=0;c<n-2;c++)s=r.ExpressionEngine.add(s,u),i.push(r.ExpressionEngine.toFloat(s));return i.push(t),i}}]),e}()},{"sd-expression-engine":"sd-expression-engine"}],5:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ExpressionsEvaluator=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-expression-engine"),a=e("sd-model"),u=e("sd-utils");n.ExpressionsEvaluator=function(){function e(t){o(this,e),this.expressionEngine=t}return i(e,[{key:"clear",value:function(e){e.nodes.forEach(function(e){e.clearComputedValues()}),e.edges.forEach(function(e){e.clearComputedValues()})}},{key:"clearTree",value:function(e,t){e.getAllNodesInSubtree(t).forEach(function(e){e.clearComputedValues(),e.childEdges.forEach(function(e){e.clearComputedValues()})})}},{key:"evalExpressions",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];u.log.debug("evalExpressions evalCode:"+t+" evalNumeric:"+o),t&&this.evalGlobalCode(e),e.getRoots().forEach(function(r){n.clearTree(e,r),n.evalExpressionsForNode(e,r,t,o,i)})}},{key:"evalGlobalCode",value:function(e){e.clearExpressionScope(),e.$codeDirty=!1;try{e.$codeError=null,this.expressionEngine.eval(e.code,!1,e.expressionScope)}catch(t){e.$codeError=t}}},{key:"evalExpressionsForNode",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((!t.expressionScope||s||n)&&this.initScopeForNode(e,t),n&&(t.$codeDirty=!1,t.code))try{t.$codeError=null,this.expressionEngine.eval(t.code,!1,t.expressionScope)}catch(c){t.$codeError=c,u.log.debug(c)}if(i){var l=t.expressionScope,f=r.ExpressionEngine.toNumber(0),p=[],b=!1;if(t.childEdges.forEach(function(e){if(e.isFieldValid("payoff",!0,!1))try{e.computedValue(null,"payoff",o.expressionEngine.evalPayoff(e))}catch(n){}if(t instanceof a.domain.ChanceNode){if(r.ExpressionEngine.isHash(e.probability))return void p.push(e);if(r.ExpressionEngine.hasAssignmentExpression(e.probability))return u.log.warn("evalExpressionsForNode hasAssignmentExpression!",e),null;if(e.isFieldValid("probability",!0,!1))try{var i=o.expressionEngine.eval(e.probability,!0,l);e.computedValue(null,"probability",i),f=r.ExpressionEngine.add(f,i)}catch(n){b=!0}else b=!0}}),t instanceof a.domain.ChanceNode){var d=p.length&&!b&&f.compare(0)>=0&&f.compare(1)<=0;if(d){var y=r.ExpressionEngine.divide(r.ExpressionEngine.subtract(1,f),p.length);p.forEach(function(e){e.computedValue(null,"probability",y)})}}t.childEdges.forEach(function(t){o.evalExpressionsForNode(e,t.childNode,n,i,s)})}}},{key:"initScopeForNode",value:function(e,t){var n=t.$parent,o=n?n.expressionScope:e.expressionScope;t.expressionScope=u.Utils.cloneDeep(o)}}]),e}()},{"sd-expression-engine":"sd-expression-engine","sd-model":"sd-model","sd-utils":"sd-utils"}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./computations-engine");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=e("./computations-manager");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var r=e("./expressions-evaluator");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}})});var a=e("./jobs/index");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})})},{"./computations-engine":2,"./computations-manager":3,"./expressions-evaluator":5,"./jobs/index":51}],7:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.ProbabilisticSensitivityAnalysisJobParameters=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("../../engine/job-parameters"),l=e("../../engine/job-parameter-definition");n.ProbabilisticSensitivityAnalysisJobParameters=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),u(t,[{key:"initDefinitions",value:function(){this.definitions.push(new l.JobParameterDefinition("id",l.PARAMETER_TYPE.STRING,1,1,(!0))),this.definitions.push(new l.JobParameterDefinition("ruleName",l.PARAMETER_TYPE.STRING)),this.definitions.push(new l.JobParameterDefinition("extendedPolicyDescription",l.PARAMETER_TYPE.BOOLEAN)),this.definitions.push(new l.JobParameterDefinition("numberOfRuns",l.PARAMETER_TYPE.INTEGER).set("singleValueValidator",function(e){return e>0})),this.definitions.push(new l.JobParameterDefinition("variables",[new l.JobParameterDefinition("name",l.PARAMETER_TYPE.STRING),new l.JobParameterDefinition("formula",l.PARAMETER_TYPE.NUMBER_EXPRESSION)],1,1/0,(!1),null,function(e){return s.Utils.isUnique(e,function(e){return e.name})}))}},{key:"initDefaultValues",value:function(){this.values={id:s.Utils.guid(),extendedPolicyDescription:!0}}}]),t}(c.JobParameters)},{"../../engine/job-parameter-definition":39,"../../engine/job-parameters":40,"sd-utils":"sd-utils"}],8:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.ProbabilisticSensitivityAnalysisJob=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("../../engine/simple-job"),c=e("./probabilistic-sensitivity-analysis-job-parameters"),l=e("./steps/prepare-variables-step"),f=e("../sensitivity-analysis/steps/init-policies-step"),p=e("../sensitivity-analysis/steps/calculate-step");n.ProbabilisticSensitivityAnalysisJob=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"probabilistic-sensitivity-analysis",e));return a.addStep(new l.PrepareVariablesStep(n.expressionEngine,e)),a.addStep(new f.InitPoliciesStep(e)),a.addStep(new p.CalculateStep(e,n,r)),a}return r(t,e),u(t,[{key:"createJobParameters",value:function(e){return new c.ProbabilisticSensitivityAnalysisJobParameters(e)}},{key:"getJobDataValidator",value:function(){return{validate:function(e){return 1===e.getRoots().length}}}},{key:"getProgress",value:function(e){return e.stepExecutions.length<=2?{total:1,current:0}:this.steps[2].getProgress(e.stepExecutions[2])}}]),t}(s.SimpleJob)},{"../../engine/simple-job":47,"../sensitivity-analysis/steps/calculate-step":14,"../sensitivity-analysis/steps/init-policies-step":15,"./probabilistic-sensitivity-analysis-job-parameters":7,"./steps/prepare-variables-step":9}],9:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.PrepareVariablesStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("../../../engine/step"),l=e("../../../engine/job-status"),f=e("sd-expression-engine");n.PrepareVariablesStep=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"prepare_variables",n));return r.expressionEngine=e,r}return r(t,e),u(t,[{key:"doExecute",value:function(e,t){for(var n=this,o=e.getJobParameters(),i=o.value("numberOfRuns"),r=o.value("variables"),a=[],u=e.getData(),c=0;c<i;c++){var p=[];r.forEach(function(e){var t=n.expressionEngine.eval(e.formula,!0,s.Utils.cloneDeep(u.expressionScope));p.push(f.ExpressionEngine.toFloat(t))}),a.push(p)}return t.data={variableValues:a},e.exitStatus=l.JOB_STATUS.COMPLETED,e}}]),t}(c.Step)},{"../../../engine/job-status":45,"../../../engine/step":50,"sd-expression-engine":"sd-expression-engine","sd-utils":"sd-utils"}],10:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.RecomputeJobParameters=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("../../engine/job-parameters"),l=e("../../engine/job-parameter-definition");n.RecomputeJobParameters=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),u(t,[{key:"initDefinitions",value:function(){this.definitions.push(new l.JobParameterDefinition("id",l.PARAMETER_TYPE.STRING,1,1,(!0))),this.definitions.push(new l.JobParameterDefinition("ruleName",l.PARAMETER_TYPE.STRING,0)),this.definitions.push(new l.JobParameterDefinition("evalCode",l.PARAMETER_TYPE.BOOLEAN)),this.definitions.push(new l.JobParameterDefinition("evalNumeric",l.PARAMETER_TYPE.BOOLEAN))}},{key:"initDefaultValues",value:function(){this.values={id:s.Utils.guid(),ruleName:null,evalCode:!0,evalNumeric:!0}}}]),t}(c.JobParameters)},{"../../engine/job-parameter-definition":39,"../../engine/job-parameters":40,"sd-utils":"sd-utils"}],11:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.RecomputeJob=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=(e("../../engine/simple-job"),e("../../engine/step"),e("../../engine/job-status"),e("../../../validation/tree-validator")),c=(e("../../engine/batch/batch-step"),e("./recompute-job-parameters")),l=e("../../engine/job");n.RecomputeJob=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recompute",e));return a.isRestartable=!1,a.expressionsEvaluator=n,a.objectiveRulesManager=r,a.treeValidator=new s.TreeValidator,a}return r(t,e),u(t,[{key:"doExecute",value:function(e){var t=e.getData(),n=e.jobParameters,o=n.value("ruleName"),i=!o;return o&&this.objectiveRulesManager.setCurrentRuleByName(o),this.checkValidityAndRecomputeObjective(t,i,n.value("evalCode"),n.value("evalNumeric")),e}},{key:"checkValidityAndRecomputeObjective",value:function(e,t,n,o){var i=this;e.validationResults=[],(n||o)&&this.expressionsEvaluator.evalExpressions(e,n,o),e.getRoots().forEach(function(n){var o=i.treeValidator.validate(e.getAllNodesInSubtree(n));e.validationResults.push(o),o.isValid()&&i.objectiveRulesManager.recomputeTree(n,t)})}},{key:"createJobParameters",value:function(e){return new c.RecomputeJobParameters(e)}}]),t}(l.Job)},{"../../../validation/tree-validator":72,"../../engine/batch/batch-step":22,"../../engine/job":46,"../../engine/job-status":45,"../../engine/simple-job":47,"../../engine/step":50,"./recompute-job-parameters":10}],12:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.SensitivityAnalysisJobParameters=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("../../engine/job-parameters"),l=e("../../engine/job-parameter-definition");n.SensitivityAnalysisJobParameters=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),u(t,[{key:"initDefinitions",value:function(){this.definitions.push(new l.JobParameterDefinition("id",l.PARAMETER_TYPE.STRING,1,1,(!0))),this.definitions.push(new l.JobParameterDefinition("ruleName",l.PARAMETER_TYPE.STRING)),this.definitions.push(new l.JobParameterDefinition("extendedPolicyDescription",l.PARAMETER_TYPE.BOOLEAN)),this.definitions.push(new l.JobParameterDefinition("variables",[new l.JobParameterDefinition("name",l.PARAMETER_TYPE.STRING),new l.JobParameterDefinition("min",l.PARAMETER_TYPE.NUMBER),new l.JobParameterDefinition("max",l.PARAMETER_TYPE.NUMBER),new l.JobParameterDefinition("length",l.PARAMETER_TYPE.INTEGER).set("singleValueValidator",function(e){return e>=0})],1,1/0,(!1),function(e){return e.min<=e.max},function(e){return s.Utils.isUnique(e,function(e){
return e.name})}))}},{key:"initDefaultValues",value:function(){this.values={id:s.Utils.guid(),extendedPolicyDescription:!0}}}]),t}(c.JobParameters)},{"../../engine/job-parameter-definition":39,"../../engine/job-parameters":40,"sd-utils":"sd-utils"}],13:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.SensitivityAnalysisJob=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("../../engine/simple-job"),c=e("./sensitivity-analysis-job-parameters"),l=e("./steps/prepare-variables-step"),f=e("./steps/init-policies-step"),p=e("./steps/calculate-step");n.SensitivityAnalysisJob=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"sensitivity-analysis",e));return a.addStep(new l.PrepareVariablesStep(e,n.expressionEngine)),a.addStep(new f.InitPoliciesStep(e)),a.addStep(new p.CalculateStep(e,n,r)),a}return r(t,e),u(t,[{key:"createJobParameters",value:function(e){return new c.SensitivityAnalysisJobParameters(e)}},{key:"getJobDataValidator",value:function(){return{validate:function(e){return 1===e.getRoots().length}}}},{key:"getProgress",value:function(e){return e.stepExecutions.length<=2?{total:1,current:0}:this.steps[2].getProgress(e.stepExecutions[2])}}]),t}(s.SimpleJob)},{"../../engine/simple-job":47,"./sensitivity-analysis-job-parameters":12,"./steps/calculate-step":14,"./steps/init-policies-step":15,"./steps/prepare-variables-step":16}],14:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.CalculateStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("sd-expression-engine"),l=e("../../../engine/batch/batch-step"),f=e("../../../../validation/tree-validator"),p=e("../../../../policies/policy");n.CalculateStep=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"calculate_step",e,5));return a.expressionsEvaluator=n,a.objectiveRulesManager=r,a.treeValidator=new f.TreeValidator,a}return r(t,e),u(t,[{key:"init",value:function(e,t){var n=(e.getJobExecutionContext(),e.getJobParameters()),o=n.value("ruleName");this.objectiveRulesManager.setCurrentRuleByName(o);var i=t.data.variableValues,r=n.value("variables").map(function(e){return e.name});if(e.executionContext.put("variableNames",r),!t.data.headers){var a=["policy"];r.forEach(function(e){return a.push(e)}),a.push("payoff"),t.data.headers=a,t.data.rows=[],t.data.variableNames=r}return i.length}},{key:"readNextChunk",value:function(e,t,n,o){var i=o.data.variableValues;return i.slice(t,t+n)}},{key:"processItem",value:function(e,t){var n=this,o=e.getJobParameters(),i=o.value("ruleName"),r=e.getData(),a=r.getRoots()[0],u=e.executionContext.get("variableNames"),s=e.getJobExecutionContext().get("policies");this.expressionsEvaluator.clear(r),this.expressionsEvaluator.evalGlobalCode(r),u.forEach(function(e,n){r.expressionScope[e]=t[n]}),this.expressionsEvaluator.evalExpressionsForNode(r,a);var c=this.treeValidator.validate(r.getAllNodesInSubtree(a)),l=c.isValid(),f=[],p=[];return s.forEach(function(e){var t="n/a";l&&(n.objectiveRulesManager.recomputeTree(a,!1,e),t=a.computedValue(i,"payoff")),f.push(t)}),{dataList:p,policies:s,variables:t,payoffs:f}}},{key:"writeChunk",value:function(e,t,n){var o=this,i=e.getJobParameters(),r=i.value("extendedPolicyDescription");t.forEach(function(e){e&&e.policies.forEach(function(t,i){var a=[p.Policy.toPolicyString(t,r)];e.variables.forEach(function(e){a.push(o.toFloat(e))});var u=e.payoffs[i];a.push(s.Utils.isString(u)?u:o.toFloat(u));var c={cells:a,policyIndex:i};n.data.rows.push(c)})})}},{key:"postProcess",value:function(e,t){delete t.data.variableValues}},{key:"toFloat",value:function(e){return c.ExpressionEngine.toFloat(e)}}]),t}(l.BatchStep)},{"../../../../policies/policy":69,"../../../../validation/tree-validator":72,"../../../engine/batch/batch-step":22,"sd-expression-engine":"sd-expression-engine","sd-utils":"sd-utils"}],15:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.InitPoliciesStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("../../../engine/step"),c=e("../../../engine/job-status"),l=e("../../../../policies/policies-collector");n.InitPoliciesStep=function(e){function t(e){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"init_policies",e))}return r(t,e),u(t,[{key:"doExecute",value:function(e,t){var n=e.getData(),o=n.getRoots()[0],i=new l.PoliciesCollector(o),r=i.policies;return e.getJobExecutionContext().put("policies",r),t.data.policies=r,e.exitStatus=c.JOB_STATUS.COMPLETED,e}}]),t}(s.Step)},{"../../../../policies/policies-collector":68,"../../../engine/job-status":45,"../../../engine/step":50}],16:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.PrepareVariablesStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("../../../engine/step"),l=e("../../../engine/job-status"),f=e("../../../../computations-utils");n.PrepareVariablesStep=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"prepare_variables",e));return r.expressionEngine=n,r}return r(t,e),u(t,[{key:"doExecute",value:function(e,t){var n=e.getJobParameters(),o=n.value("variables"),i=[];return o.forEach(function(e){i.push(f.ComputationsUtils.sequence(e.min,e.max,e.length))}),i=s.Utils.cartesianProductOf(i),t.data={variableValues:i},e.exitStatus=l.JOB_STATUS.COMPLETED,e}}]),t}(c.Step)},{"../../../../computations-utils":4,"../../../engine/job-status":45,"../../../engine/step":50,"sd-utils":"sd-utils"}],17:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.CalculateStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("sd-expression-engine"),l=e("../../../engine/batch/batch-step"),f=e("../../../../validation/tree-validator"),p=e("../../../../policies/policy"),b=e("../../../../policies/policies-collector");n.CalculateStep=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"calculate_step",e,1));return a.expressionsEvaluator=n,a.objectiveRulesManager=r,a.treeValidator=new f.TreeValidator,a}return r(t,e),u(t,[{key:"init",value:function(e,t){var n=this,o=e.getJobExecutionContext(),i=e.getJobParameters(),r=i.value("ruleName");this.objectiveRulesManager.setCurrentRuleByName(r);var a=o.get("variableValues"),u=i.value("variables").map(function(e){return e.name});e.executionContext.put("variableNames",u);var c=e.getData();this.expressionsEvaluator.clear(c),this.expressionsEvaluator.evalGlobalCode(c);var l={};if(s.Utils.forOwn(c.expressionScope,function(e,t){l[t]=n.toFloat(e)}),!t.data){var f=["policy"];u.forEach(function(e){return f.push(e)}),f.push("payoff"),t.data={headers:f,rows:[],variableNames:u,defaultValues:l,policies:o.get("policies")}}return a.length}},{key:"readNextChunk",value:function(e,t,n){var o=e.getJobExecutionContext().get("variableValues");return o.slice(t,t+n)}},{key:"processItem",value:function(e,t,n){var o=this,i=e.getJobParameters(),r=i.value("ruleName"),a=e.getData(),u=a.getRoots()[0],s=e.executionContext.get("variableNames"),c=s[n],l=[];return t.forEach(function(e){o.expressionsEvaluator.clear(a),o.expressionsEvaluator.evalGlobalCode(a),a.expressionScope[c]=e,o.expressionsEvaluator.evalExpressionsForNode(a,u);var t=o.treeValidator.validate(a.getAllNodesInSubtree(u)),i=t.isValid();if(!i)return null;o.objectiveRulesManager.recomputeTree(u,!1);var s=new b.PoliciesCollector(u,r),f=s.policies,p=u.computedValue(r,"payoff"),d={policies:f,variableName:c,variableIndex:n,variableValue:e,payoff:p};l.push(d)}),l}},{key:"writeChunk",value:function(e,t,n){var o=this,i=(e.getJobParameters(),e.getJobExecutionContext().get("policyByKey")),r=e.getJobExecutionContext().get("policies");t.forEach(function(e){e&&e.forEach(function(e){e.policies.forEach(function(t){var a=[p.Policy.toPolicyString(t)];n.data.variableNames.forEach(function(t){var i="default";t==e.variableName?i=o.toFloat(e.variableValue):n.data.defaultValues.hasOwnProperty(t)&&(i=n.data.defaultValues[t]),a.push(i)});var u=e.payoff;a.push(s.Utils.isString(u)?u:o.toFloat(u));var c={cells:a,policyIndex:r.indexOf(i[t.key])};n.data.rows.push(c)})})})}},{key:"toFloat",value:function(e){return c.ExpressionEngine.toFloat(e)}}]),t}(l.BatchStep)},{"../../../../policies/policies-collector":68,"../../../../policies/policy":69,"../../../../validation/tree-validator":72,"../../../engine/batch/batch-step":22,"sd-expression-engine":"sd-expression-engine","sd-utils":"sd-utils"}],18:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.InitPoliciesStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("../../../engine/step"),c=e("../../../engine/job-status"),l=e("../../../../policies/policies-collector"),f=e("sd-utils");n.InitPoliciesStep=function(e){function t(e){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"init_policies",e))}return r(t,e),u(t,[{key:"doExecute",value:function(e,t){var n=e.getData(),o=e.getJobParameters(),i=(o.value("ruleName"),n.getRoots()[0]),r=new l.PoliciesCollector(i);return e.getJobExecutionContext().put("policies",r.policies),e.getJobExecutionContext().put("policyByKey",f.Utils.getObjectByIdMap(r.policies,null,"key")),e.exitStatus=c.JOB_STATUS.COMPLETED,e}}]),t}(s.Step)},{"../../../../policies/policies-collector":68,"../../../engine/job-status":45,"../../../engine/step":50,"sd-utils":"sd-utils"}],19:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.PrepareVariablesStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=(e("sd-utils"),e("../../../engine/step")),c=e("../../../engine/job-status"),l=e("sd-expression-engine");n.PrepareVariablesStep=function(e){function t(e){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"prepare_variables",e))}return r(t,e),u(t,[{key:"doExecute",value:function(e){var t=this,n=e.getJobParameters(),o=n.value("variables"),i=[];return o.forEach(function(e){i.push(t.sequence(e.min,e.max,e.length))}),e.getJobExecutionContext().put("variableValues",i),e.exitStatus=c.JOB_STATUS.COMPLETED,e}},{key:"sequence",value:function(e,t,n){for(var o=t-e,i=o/(n-1),r=[e],a=e,u=0;u<n-2;u++)a+=i,r.push(l.ExpressionEngine.toFloat(l.ExpressionEngine.round(a,16)));return r.push(t),r}}]),t}(s.Step)},{"../../../engine/job-status":45,"../../../engine/step":50,"sd-expression-engine":"sd-expression-engine","sd-utils":"sd-utils"}],20:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.TornadoDiagramJobParameters=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("../../engine/job-parameters"),l=e("../../engine/job-parameter-definition");n.TornadoDiagramJobParameters=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),u(t,[{key:"initDefinitions",value:function(){this.definitions.push(new l.JobParameterDefinition("id",l.PARAMETER_TYPE.STRING,1,1,(!0))),this.definitions.push(new l.JobParameterDefinition("ruleName",l.PARAMETER_TYPE.STRING)),this.definitions.push(new l.JobParameterDefinition("variables",[new l.JobParameterDefinition("name",l.PARAMETER_TYPE.STRING),new l.JobParameterDefinition("min",l.PARAMETER_TYPE.NUMBER),new l.JobParameterDefinition("max",l.PARAMETER_TYPE.NUMBER),new l.JobParameterDefinition("length",l.PARAMETER_TYPE.INTEGER).set("singleValueValidator",function(e){return e>=0})],1,1/0,(!1),function(e){return e.min<=e.max},function(e){return s.Utils.isUnique(e,function(e){return e.name})}))}},{key:"initDefaultValues",value:function(){this.values={id:s.Utils.guid()}}}]),t}(c.JobParameters)},{"../../engine/job-parameter-definition":39,"../../engine/job-parameters":40,"sd-utils":"sd-utils"}],21:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.TornadoDiagramJob=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("../../engine/simple-job"),c=e("./steps/prepare-variables-step"),l=e("./steps/init-policies-step"),f=e("./steps/calculate-step"),p=e("./tornado-diagram-job-parameters");n.TornadoDiagramJob=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"tornado-diagram",e));return a.addStep(new c.PrepareVariablesStep(e)),a.addStep(new l.InitPoliciesStep(e)),a.addStep(new f.CalculateStep(e,n,r)),a}return r(t,e),u(t,[{key:"createJobParameters",value:function(e){return new p.TornadoDiagramJobParameters(e)}},{key:"getJobDataValidator",value:function(){return{validate:function(e){return 1===e.getRoots().length}}}},{key:"getProgress",value:function(e){return e.stepExecutions.length<=2?{total:1,current:0}:this.steps[2].getProgress(e.stepExecutions[2])}}]),t}(s.SimpleJob)},{"../../engine/simple-job":47,"./steps/calculate-step":17,"./steps/init-policies-step":18,"./steps/prepare-variables-step":19,"./tornado-diagram-job-parameters":20}],22:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.BatchStep=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("../job-status"),c=e("sd-utils"),l=e("../step"),f=e("../exceptions/job-interrupted-exception"),p=n.BatchStep=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.chunkSize=r,a}return r(t,e),u(t,[{key:"init",value:function(e,t){throw"BatchStep.init function not implemented for step: "+this.name}},{key:"readNextChunk",value:function(e,t,n,o){throw"BatchStep.readNextChunk function not implemented for step: "+this.name}},{key:"processItem",value:function(e,t,n){throw"BatchStep.processItem function not implemented for step: "+this.name}},{key:"writeChunk",value:function(e,t,n){}},{key:"postProcess",value:function(e,t){}},{key:"setTotalItemCount",value:function(e,n){e.executionContext.put(t.TOTAL_ITEM_COUNT_PROP,n)}},{key:"getTotalItemCount",value:function(e){return e.executionContext.get(t.TOTAL_ITEM_COUNT_PROP)}},{key:"setCurrentItemCount",value:function(e,n){e.executionContext.put(t.CURRENT_ITEM_COUNT_PROP,n)}},{key:"getCurrentItemCount",value:function(e){return e.executionContext.get(t.CURRENT_ITEM_COUNT_PROP)||0}},{key:"doExecute",value:function(e,t){var n=this;return Promise.resolve().then(function(){return n.init(e,t)})["catch"](function(e){throw c.log.error("Failed to initialize batch step: "+n.name,e),e}).then(function(o){return Promise.resolve().then(function(){return n.setCurrentItemCount(e,n.getCurrentItemCount(e)),n.setTotalItemCount(e,o),n.handleNextChunk(e,t)})["catch"](function(e){throw e instanceof f.JobInterruptedException||c.log.error("Failed to handle batch step: "+n.name,e),e})}).then(function(){return Promise.resolve().then(function(){return n.postProcess(e,t)})["catch"](function(e){throw c.log.error("Failed to postProcess batch step: "+n.name,e),e})}).then(function(){return e.exitStatus=s.JOB_STATUS.COMPLETED,e})}},{key:"handleNextChunk",value:function(e,t){var n=this,o=this.getCurrentItemCount(e),i=this.getTotalItemCount(e),r=Math.min(this.chunkSize,i-o);return o>=i?e:this.checkJobExecutionFlags(e).then(function(){if(e.terminateOnly)throw new f.JobInterruptedException("JobExecution interrupted.");return e}).then(function(){return Promise.resolve().then(function(){return n.readNextChunk(e,o,r,t)})["catch"](function(e){throw c.log.error("Failed to read chunk ("+o+","+r+") in batch step: "+n.name,e),e})}).then(function(i){return Promise.resolve().then(function(){return n.processChunk(e,i,o,t)})["catch"](function(e){throw c.log.error("Failed to process chunk ("+o+","+r+") in batch step: "+n.name,e),e})}).then(function(i){return Promise.resolve().then(function(){return n.writeChunk(e,i,t)})["catch"](function(e){throw c.log.error("Failed to write chunk ("+o+","+r+") in batch step: "+n.name,e),e})}).then(function(i){return o+=r,n.setCurrentItemCount(e,o),n.updateJobProgress(e).then(function(){return n.handleNextChunk(e,t)})})}},{key:"processChunk",value:function(e,t,n,o){var i=this;return t.map(function(t,r){return i.processItem(e,t,n+r,o)})}},{key:"getProgress",value:function(e){return{total:this.getTotalItemCount(e),current:this.getCurrentItemCount(e)}}},{key:"updateJobProgress",value:function(e){var t=this.jobRepository.getJobByName(e.jobExecution.jobInstance.jobName).getProgress(e.jobExecution);return this.jobRepository.updateJobExecutionProgress(e.jobExecution.id,t)}},{key:"checkJobExecutionFlags",value:function(e){return this.jobRepository.getJobByName(e.jobExecution.jobInstance.jobName).checkExecutionFlags(e.jobExecution)}}]),t}(l.Step);p.CURRENT_ITEM_COUNT_PROP="batch_step_current_item_count",p.TOTAL_ITEM_COUNT_PROP="batch_step_total_item_count"},{"../exceptions/job-interrupted-exception":28,"../job-status":45,"../step":50,"sd-utils":"sd-utils"}],23:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});n.ExtendableError=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=n.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(n,n.constructor):n.stack=new Error(e).stack,n}return r(t,e),t}(a(Error))},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./extendable-error");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=e("./job-data-invalid-exception");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var r=e("./job-execution-already-running-exception");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}})});var a=e("./job-instance-already-complete-exception");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});var u=e("./job-interrupted-exception");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}})});var s=e("./job-parameters-invalid-exception");Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}})});var c=e("./job-restart-exception");Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return c[e]}})})},{"./extendable-error":23,"./job-data-invalid-exception":25,"./job-execution-already-running-exception":26,"./job-instance-already-complete-exception":27,"./job-interrupted-exception":28,"./job-parameters-invalid-exception":29,"./job-restart-exception":30}],25:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobDataInvalidException=void 0;var u=e("./extendable-error");n.JobDataInvalidException=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(u.ExtendableError)},{"./extendable-error":23}],26:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));
e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobExecutionAlreadyRunningException=void 0;var u=e("./extendable-error");n.JobExecutionAlreadyRunningException=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(u.ExtendableError)},{"./extendable-error":23}],27:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobInstanceAlreadyCompleteException=void 0;var u=e("./extendable-error");n.JobInstanceAlreadyCompleteException=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(u.ExtendableError)},{"./extendable-error":23}],28:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobInterruptedException=void 0;var u=e("./extendable-error");n.JobInterruptedException=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(u.ExtendableError)},{"./extendable-error":23}],29:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobParametersInvalidException=void 0;var u=e("./extendable-error");n.JobParametersInvalidException=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(u.ExtendableError)},{"./extendable-error":23}],30:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobRestartException=void 0;var u=e("./extendable-error");n.JobRestartException=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(u.ExtendableError)},{"./extendable-error":23}],31:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionContext=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-utils");n.ExecutionContext=function(){function e(t){o(this,e),this.dirty=!1,this.context={},t&&(this.context=r.Utils.clone(t))}return i(e,[{key:"put",value:function(e,t){var n=this.context[e];if(null!=t){this.context[e]=t;this.dirty=null==n||null!=n&&n!=t}else delete this.context[e],this.dirty=null!=n}},{key:"get",value:function(e){return this.context[e]}},{key:"containsKey",value:function(e){return this.context.hasOwnProperty(e)}},{key:"remove",value:function(e){delete this.context[e]}},{key:"setData",value:function(e){return this.put("data",e)}},{key:"getData",value:function(){return this.get("data")}},{key:"getDTO",value:function(){var e=r.Utils.cloneDeep(this),t=this.getData();return t&&(t=t.getDTO(),e.context.data=t),e}}]),e}()},{"sd-utils":"sd-utils"}],32:[function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.exceptions=void 0;var i=e("./execution-context");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var r=e("./job");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}})});var a=e("./job-execution");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});var u=e("./job-execution-flag");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}})});var s=e("./job-execution-listener");Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}})});var c=e("./job-instance");Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return c[e]}})});var l=e("./job-key-generator");Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return l[e]}})});var f=e("./job-launcher");Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return f[e]}})});var p=e("./job-parameter-definition");Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return p[e]}})});var b=e("./job-parameters");Object.keys(b).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return b[e]}})});var d=e("./job-status");Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return d[e]}})});var y=e("./simple-job");Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return y[e]}})});var h=e("./step");Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return h[e]}})});var v=e("./step-execution");Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return v[e]}})});var m=e("./step-execution-listener");Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return m[e]}})});var g=e("./exceptions"),E=o(g);n.exceptions=E},{"./exceptions":24,"./execution-context":31,"./job":46,"./job-execution":35,"./job-execution-flag":33,"./job-execution-listener":34,"./job-instance":36,"./job-key-generator":37,"./job-launcher":38,"./job-parameter-definition":39,"./job-parameters":40,"./job-status":45,"./simple-job":47,"./step":50,"./step-execution":49,"./step-execution-listener":48}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.JOB_EXECUTION_FLAG={STOP:"STOP"}},{}],34:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.JobExecutionListener=function(){function e(){o(this,e)}return i(e,[{key:"beforeJob",value:function(e){}},{key:"afterJob",value:function(e){}}]),e}()},{}],35:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JobExecution=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./job-status"),a=e("./step-execution"),u=e("sd-utils"),s=e("./execution-context");n.JobExecution=function(){function e(t,n,i){o(this,e),this.stepExecutions=[],this.status=r.JOB_STATUS.STARTING,this.exitStatus=r.JOB_STATUS.UNKNOWN,this.executionContext=new s.ExecutionContext,this.startTime=null,this.createTime=new Date,this.endTime=null,this.lastUpdated=null,this.failureExceptions=[],null===i||void 0===i?this.id=u.Utils.guid():this.id=i,this.jobInstance=t,this.jobParameters=n}return i(e,[{key:"createStepExecution",value:function(e){var t=new a.StepExecution(e,this);return this.stepExecutions.push(t),t}},{key:"isRunning",value:function(){return!this.endTime}},{key:"isStopping",value:function(){return this.status===r.JOB_STATUS.STOPPING}},{key:"stop",value:function(){this.stepExecutions.forEach(function(e){e.terminateOnly=!0}),this.status=r.JOB_STATUS.STOPPING}},{key:"getData",value:function(){return this.executionContext.getData()}},{key:"getDTO",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=u.Utils.cloneDeepWith;return t||(n=u.Utils.cloneWith),u.Utils.assign({},n(this,function(n,o,i,r){return e.indexOf(o)>-1?null:["jobParameters","executionContext"].indexOf(o)>-1?n.getDTO():n instanceof Error?u.Utils.getErrorDTO(n):n instanceof a.StepExecution?n.getDTO(["jobExecution"],t):void 0}))}}]),e}()},{"./execution-context":31,"./job-status":45,"./step-execution":49,"sd-utils":"sd-utils"}],36:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});n.JobInstance=function i(e,t){o(this,i),this.id=e,this.jobName=t}},{}],37:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.JobKeyGenerator=function(){function e(){o(this,e)}return i(e,null,[{key:"generateKey",value:function(e){var t="";return e.definitions.forEach(function(n,o){n.identifying&&(t+=n.name+"="+e.values[n.name]+";")}),t}}]),e}()},{}],38:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JobLauncher=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./exceptions/job-restart-exception"),a=e("./job-status"),u=e("sd-utils"),s=e("./exceptions/job-parameters-invalid-exception"),c=e("./exceptions/job-data-invalid-exception");n.JobLauncher=function(){function e(t,n,i){o(this,e),this.jobRepository=t,this.jobWorker=n,this.dataModelSerializer=i}return i(e,[{key:"run",value:function(e,t,n){var o,i,a=this,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Promise.resolve().then(function(){if(o=u.Utils.isString(e)?a.jobRepository.getJobByName(e):e,!o)throw new r.JobRestartException("No such job: "+e);return i=o.createJobParameters(t),a.validate(o,i,n)}).then(function(e){return a.jobRepository.createJobExecution(o.name,i,n).then(function(e){if(a.jobWorker)return u.log.debug("Job: ["+o.name+"] execution ["+e.id+"] delegated to worker"),a.jobWorker.executeJob(e.id),e;var t=a._execute(o,e);return s?e:t})})}},{key:"validate",value:function(e,t,n){return this.jobRepository.getLastJobExecution(e.name,t).then(function(o){if(null!=o){if(!e.isRestartable)throw new r.JobRestartException("JobInstance already exists and is not restartable");o.stepExecutions.forEach(function(e){if(e.status==a.JOB_STATUS.UNKNOWN)throw new r.JobRestartException("Step ["+e.stepName+"] is of status UNKNOWN")})}if(e.jobParametersValidator&&!e.jobParametersValidator.validate(t))throw new s.JobParametersInvalidException("Invalid job parameters in jobLauncher.run for job: "+e.name);if(e.jobDataValidator&&!e.jobDataValidator.validate(n))throw new c.JobDataInvalidException("Invalid job data in jobLauncher.run for job: "+e.name);return!0})}},{key:"execute",value:function(e){var t=this;return Promise.resolve().then(function(){return u.Utils.isString(e)?t.jobRepository.getJobExecutionById(e):e}).then(function(n){if(!n)throw new r.JobRestartException("JobExecution ["+e+"] is not found");if(n.status!==a.JOB_STATUS.STARTING)throw new r.JobRestartException("JobExecution ["+n.id+"] already started");var o=n.jobInstance.jobName,i=t.jobRepository.getJobByName(o);if(!i)throw new r.JobRestartException("No such job: "+o);return t._execute(i,n)})}},{key:"_execute",value:function(e,t){var n=e.name;return u.log.info("Job: ["+n+"] launched with the following parameters: ["+t.jobParameters+"]",t.getData()),e.execute(t).then(function(e){return u.log.info("Job: ["+n+"] completed with the following parameters: ["+e.jobParameters+"] and the following status: ["+e.status+"]"),e})["catch"](function(e){throw u.log.error("Job: ["+n+"] failed unexpectedly and fatally with the following parameters: ["+t.jobParameters+"]",e),e})}}]),e}()},{"./exceptions/job-data-invalid-exception":25,"./exceptions/job-parameters-invalid-exception":29,"./exceptions/job-restart-exception":30,"./job-status":45,"sd-utils":"sd-utils"}],39:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JobParameterDefinition=n.PARAMETER_TYPE=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-utils"),a=n.PARAMETER_TYPE={STRING:"STRING",DATE:"DATE",INTEGER:"INTEGER",NUMBER:"FLOAT",BOOLEAN:"BOOLEAN",NUMBER_EXPRESSION:"NUMBER_EXPRESSION",COMPOSITE:"COMPOSITE"};n.JobParameterDefinition=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;o(this,e),this.nestedParameters=[],this.required=!0,this.name=t,r.Utils.isArray(n)?(this.type=a.COMPOSITE,this.nestedParameters=n):this.type=n,this.validator=l,this.singleValueValidator=c,this.identifying=s,this.minOccurs=i,this.maxOccurs=u}return i(e,[{key:"set",value:function(e,t){return this[e]=t,this}},{key:"validate",value:function(e){var t=r.Utils.isArray(e);return!(this.maxOccurs>1&&!t)&&(t?!(e.length<this.minOccurs||e.length>this.maxOccurs)&&(!!e.every(this.validateSingleValue,this)&&(!this.validator||this.validator(e))):this.validateSingleValue(e))}},{key:"validateSingleValue",value:function(e){if((null===e||void 0===e)&&this.minOccurs>0)return!1;if(this.required&&!e&&0!==e&&e!==!1)return!1;if(a.STRING===this.type&&!r.Utils.isString(e))return!1;if(a.DATE===this.type&&!r.Utils.isDate(e))return!1;if(a.INTEGER===this.type&&!r.Utils.isInt(e))return!1;if(a.NUMBER===this.type&&!r.Utils.isNumber(e))return!1;if(a.COMPOSITE===this.type){if(!r.Utils.isObject(e))return!1;if(!this.nestedParameters.every(function(t,n){return t.validate(e[t.name])}))return!1}return!this.singleValueValidator||this.singleValueValidator(e)}}]),e}()},{"sd-utils":"sd-utils"}],40:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JobParameters=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=(e("./job-parameter-definition"),e("sd-utils")),a=function(){function e(t){o(this,e),this.definitions=[],this.values={},this.initDefinitions(),this.initDefaultValues(),t&&r.Utils.deepExtend(this.values,t)}return i(e,[{key:"initDefinitions",value:function(){}},{key:"initDefaultValues",value:function(){}},{key:"validate",value:function(){var e=this;return this.definitions.every(function(t,n){return t.validate(e.values[t.name])})}},{key:"value",value:function(e,t){return 1===arguments.length?r.Utils.get(this.values,e,null):(r.Utils.set(this.values,e,t),t)}},{key:"toString",value:function(){var e=this,t="JobParameters[";return this.definitions.forEach(function(n,o){var i=e.values[n.name];t+=n.name+"="+i+";"}),t+="]"}},{key:"getDTO",value:function(){return{values:this.values}}}]),e}();n.JobParameters=a},{"./job-parameter-definition":39,"sd-utils":"sd-utils"}],41:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.IdbJobRepository=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("./job-repository"),l=e("idb"),f=o(l),p=e("sd-utils"),b=e("../job-execution"),d=e("../job-instance"),y=e("../step-execution"),h=e("../execution-context"),v=e("sd-model"),m=(n.IdbJobRepository=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sd-job-repository",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.dbName=n,a.expressionsReviver=e,o?a.deleteDB().then(function(){a.initDB()}):a.initDB(),a.jobInstanceDao=new m("job-instances",a.dbPromise),a.jobExecutionDao=new m("job-executions",a.dbPromise),a.jobExecutionProgressDao=new m("job-execution-progress",a.dbPromise),a.jobExecutionFlagDao=new m("job-execution-flags",a.dbPromise),a.stepExecutionDao=new m("step-executions",a.dbPromise),a.jobResultDao=new m("job-results",a.dbPromise),a}return a(t,e),s(t,[{key:"initDB",value:function(){this.dbPromise=f["default"].open(this.dbName,1,function(e){e.createObjectStore("job-instances");var t=e.createObjectStore("job-executions");t.createIndex("jobInstanceId","jobInstance.id",{unique:!1}),t.createIndex("createTime","createTime",{unique:!1}),t.createIndex("status","status",{unique:!1}),e.createObjectStore("job-execution-progress"),e.createObjectStore("job-execution-flags");var n=e.createObjectStore("step-executions");n.createIndex("jobExecutionId","jobExecutionId",{unique:!1});var o=e.createObjectStore("job-results");o.createIndex("jobInstanceId","jobInstance.id",{unique:!0})})}},{key:"deleteDB",value:function(){var e=this;return Promise.resolve().then(function(t){return f["default"]["delete"](e.dbName)})}},{key:"getJobResult",value:function(e){return this.jobResultDao.get(e)}},{key:"getJobResultByInstance",value:function(e){return this.jobResultDao.getByIndex("jobInstanceId",e.id)}},{key:"saveJobResult",value:function(e){return this.jobResultDao.set(e.id,e).then(function(t){return e})}},{key:"getJobInstance",value:function(e,t){var n=this,o=this.generateJobInstanceKey(e,t);return this.jobInstanceDao.get(o).then(function(e){return e?n.reviveJobInstance(e):e})}},{key:"saveJobInstance",value:function(e,t){var n=this.generateJobInstanceKey(e.jobName,t);return this.jobInstanceDao.set(n,e).then(function(t){return e})}},{key:"saveJobExecution",value:function(e){var t=this,n=e.getDTO(),o=n.stepExecutions;return n.stepExecutions=null,this.jobExecutionDao.set(e.id,n).then(function(e){return t.saveStepExecutionsDTOS(o)}).then(function(t){return e})}},{key:"updateJobExecutionProgress",value:function(e,t){return this.jobExecutionProgressDao.set(e,t)}},{key:"getJobExecutionProgress",value:function(e){return this.jobExecutionProgressDao.get(e)}},{key:"saveJobExecutionFlag",value:function(e,t){return this.jobExecutionFlagDao.set(e,t)}},{key:"getJobExecutionFlag",value:function(e){return this.jobExecutionFlagDao.get(e)}},{key:"saveStepExecution",value:function(e){var t=e.getDTO(["jobExecution"]);return this.stepExecutionDao.set(e.id,t).then(function(t){return e})}},{key:"saveStepExecutionsDTOS",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.length<=n.length)return Promise.resolve(n);var o=e[n.length];return this.stepExecutionDao.set(o.id,o).then(function(){return n.push(o),t.saveStepExecutionsDTOS(e,n)})}},{key:"getJobExecutionById",value:function(e){var t=this;return this.jobExecutionDao.get(e).then(function(e){return t.fetchJobExecutionRelations(e)})}},{key:"fetchJobExecutionRelations",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?this.findStepExecutions(e.id,!1).then(function(o){return e.stepExecutions=o,n?t.reviveJobExecution(e):e}):Promise.resolve(null)}},{key:"fetchJobExecutionsRelations",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.length<=o.length?Promise.resolve(o):this.fetchJobExecutionRelations(e[o.length],n).then(function(i){return o.push(i),t.fetchJobExecutionsRelations(e,n,o)})}},{key:"findStepExecutions",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.stepExecutionDao.getAllByIndex("jobExecutionId",e).then(function(e){return n?e.map(function(e){return t.reviveStepExecution(e)}):e})}},{key:"findJobExecutions",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.jobExecutionDao.getAllByIndex("jobInstanceId",e.id).then(function(e){var o=e.sort(function(e,t){return e.createTime.getTime()-t.createTime.getTime()});return n?t.fetchJobExecutionsRelations(o,!0):o})}},{key:"getLastJobExecutionByInstance",value:function(e){var t=this;return this.findJobExecutions(e,!1).then(function(e){return t.fetchJobExecutionRelations(e[e.length-1])})}},{key:"getLastStepExecution",value:function(e,t){return this.findJobExecutions(e).then(function(e){var n=[];e.forEach(function(e){return e.stepExecutions.filter(function(e){return e.stepName===t}).forEach(function(e){return n.push(e)})});var o=null;return n.forEach(function(e){(null==o||o.startTime.getTime()<e.startTime.getTime())&&(o=e)}),o})}},{key:"reviveJobInstance",value:function(e){return new d.JobInstance(e.id,e.jobName)}},{key:"reviveExecutionContext",value:function(e){var t=new h.ExecutionContext;t.context=e.context;var n=t.getData();if(n){var o=new v.DataModel;o.loadFromDTO(n,this.expressionsReviver),t.setData(o)}return t}},{key:"reviveJobExecution",value:function(e){var t=this,n=this.getJobByName(e.jobInstance.jobName),o=this.reviveJobInstance(e.jobInstance),i=n.createJobParameters(e.jobParameters.values),r=new b.JobExecution(o,i,e.id),a=this.reviveExecutionContext(e.executionContext);return p.Utils.mergeWith(r,e,function(e,n,u,s,c,l){return"jobInstance"===u?o:"executionContext"===u?a:"jobParameters"===u?i:"jobExecution"===u?r:"stepExecutions"===u?n.map(function(e){return t.reviveStepExecution(e,r)}):void 0})}},{key:"reviveStepExecution",value:function(e,t){var n=new y.StepExecution(e.stepName,t,e.id),o=this.reviveExecutionContext(e.executionContext);return p.Utils.mergeWith(n,e,function(e,n,i,r,a,u){return"jobExecution"===i?t:"executionContext"===i?o:void 0})}}]),t}(c.JobRepository),function(){function e(t,n){i(this,e),this.name=t,this.dbPromise=n}return s(e,[{key:"get",value:function(e){var t=this;return this.dbPromise.then(function(n){return n.transaction(t.name).objectStore(t.name).get(e)})}},{key:"getAllByIndex",value:function(e,t){var n=this;return this.dbPromise.then(function(o){return o.transaction(n.name).objectStore(n.name).index(e).getAll(t)})}},{key:"getByIndex",value:function(e,t){var n=this;return this.dbPromise.then(function(o){return o.transaction(n.name).objectStore(n.name).index(e).get(t)})}},{key:"set",value:function(e,t){var n=this;return this.dbPromise.then(function(o){var i=o.transaction(n.name,"readwrite");return i.objectStore(n.name).put(t,e),i.complete})}},{key:"remove",value:function(e){var t=this;return this.dbPromise.then(function(n){var o=n.transaction(t.name,"readwrite");return o.objectStore(t.name)["delete"](e),o.complete})}},{key:"clear",value:function(){var e=this;return this.dbPromise.then(function(t){var n=t.transaction(e.name,"readwrite");return n.objectStore(e.name).clear(),n.complete})}},{key:"keys",value:function(){var e=this;return this.dbPromise.then(function(t){var n=t.transaction(e.name),o=[],i=n.objectStore(e.name);return(i.iterateKeyCursor||i.iterateCursor).call(i,function(e){e&&(o.push(e.key),e["continue"]())}),n.complete.then(function(){return o})})}}]),e}())},{"../execution-context":31,"../job-execution":35,"../job-instance":36,"../step-execution":49,"./job-repository":42,idb:1,"sd-model":"sd-model","sd-utils":"sd-utils"}],42:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JobRepository=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../job-key-generator"),a=e("../job-instance"),u=e("sd-utils"),s=e("../job-execution"),c=e("../exceptions/job-execution-already-running-exception"),l=e("../job-status"),f=e("../exceptions/job-instance-already-complete-exception"),p=e("../execution-context"),b=e("../step-execution");n.JobRepository=function(){function e(){o(this,e),this.jobByName={}}return i(e,[{key:"registerJob",value:function(e){this.jobByName[e.name]=e}},{key:"getJobByName",value:function(e){return this.jobByName[e]}},{key:"getJobInstance",value:function(e,t){throw"JobRepository getJobInstance function not implemented!"}},{key:"saveJobInstance",value:function(e,t){throw"JobRepository.saveJobInstance function not implemented!"}},{key:"getJobExecutionById",value:function(e){throw"JobRepository.getJobExecutionById function not implemented!"}},{key:"saveJobExecution",value:function(e){throw"JobRepository.saveJobInstance function not implemented!"}},{key:"updateJobExecutionProgress",value:function(e,t){throw"JobRepository.saveJobInstance function not implemented!"}},{key:"getJobExecutionProgress",value:function(e){throw"JobRepository.getJobExecutionProgress function not implemented!"}},{key:"saveJobExecutionFlag",value:function(e,t){throw"JobRepository.saveJobExecutionFlag function not implemented!"}},{key:"getJobExecutionFlag",value:function(e){throw"JobRepository.getJobExecutionFlag function not implemented!"}},{key:"saveStepExecution",value:function(e){throw"JobRepository.saveStepExecution function not implemented!"}},{key:"findJobExecutions",value:function(e){throw"JobRepository.findJobExecutions function not implemented!"}},{key:"getJobResult",value:function(e){throw"JobRepository.getJobResult function not implemented!"}},{key:"getJobResultByInstance",value:function(e){throw"JobRepository.getJobResultByInstance function not implemented!"}},{key:"saveJobResult",value:function(e){throw"JobRepository.setJobResult function not implemented!"}},{key:"createJobInstance",value:function(e,t){var n=new a.JobInstance(u.Utils.guid(),e);return this.saveJobInstance(n,t)}},{key:"isJobInstanceExists",value:function(e,t){return this.getJobInstance(e,t).then(function(e){return!!e})["catch"](function(e){return!1})}},{key:"generateJobInstanceKey",value:function(e,t){return e+"|"+r.JobKeyGenerator.generateKey(t)}},{key:"createJobExecution",
value:function(e,t,n){var o=this;return this.getJobInstance(e,t).then(function(i){if(null!=i)return o.findJobExecutions(i).then(function(e){e.forEach(function(e){if(e.isRunning())throw new c.JobExecutionAlreadyRunningException("A job execution for this job is already running: "+i.jobName);if(e.status==l.JOB_STATUS.COMPLETED||e.status==l.JOB_STATUS.ABANDONED)throw new f.JobInstanceAlreadyCompleteException("A job instance already exists and is complete for parameters="+t+".  If you want to run this job again, change the parameters.")});var n=e[e.length-1].executionContext;return[i,n]});i=o.createJobInstance(e,t);var r=new p.ExecutionContext;return r.setData(n),Promise.all([i,r])}).then(function(e){var n=new s.JobExecution(e[0],t);return n.executionContext=e[1],n.lastUpdated=new Date,o.saveJobExecution(n)})["catch"](function(e){throw e})}},{key:"getLastJobExecution",value:function(e,t){var n=this;return this.getJobInstance(e,t).then(function(e){return e?n.getLastJobExecutionByInstance(e):null})}},{key:"getLastJobExecutionByInstance",value:function(e){return this.findJobExecutions(e).then(function(e){return e[e.length-1]})}},{key:"getLastStepExecution",value:function(e,t){return this.findJobExecutions(e).then(function(e){var n=[];e.forEach(function(e){return e.stepExecutions.filter(function(e){return e.stepName===t}).forEach(function(e){return n.push(e)})});var o=null;return n.forEach(function(e){(null==o||o.startTime.getTime()<e.startTime.getTime())&&(o=e)}),o})}},{key:"addStepExecution",value:function(e){return e.lastUpdated=new Date,this.saveStepExecution(e)}},{key:"update",value:function(e){if(e.lastUpdated=new Date,e instanceof s.JobExecution)return this.saveJobExecution(e);if(e instanceof b.StepExecution)return this.saveStepExecution(e);throw"Object not updatable: "+e}},{key:"remove",value:function(e){}},{key:"reviveJobInstance",value:function(e){return e}},{key:"reviveExecutionContext",value:function(e){return e}},{key:"reviveJobExecution",value:function(e){return e}},{key:"reviveStepExecution",value:function(e,t){return e}}]),e}()},{"../exceptions/job-execution-already-running-exception":26,"../exceptions/job-instance-already-complete-exception":27,"../execution-context":31,"../job-execution":35,"../job-instance":36,"../job-key-generator":37,"../job-status":45,"../step-execution":49,"sd-utils":"sd-utils"}],43:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.TimeoutJobRepository=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("./job-repository"),c=e("sd-utils");n.TimeoutJobRepository=function(e){function t(){var e,n,r,a;o(this,t);for(var u=arguments.length,s=Array(u),c=0;c<u;c++)s[c]=arguments[c];return n=r=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.jobInstancesByKey={},r.jobExecutions=[],r.stepExecutions=[],r.executionProgress={},r.executionFlags={},r.jobResults=[],a=n,i(r,a)}return r(t,e),u(t,[{key:"createTimeoutPromise",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise(function(n){setTimeout(function(){n(e)},t)})}},{key:"getJobInstance",value:function(e,t){var n=this.generateJobInstanceKey(e,t);return this.createTimeoutPromise(this.jobInstancesByKey[n])}},{key:"saveJobInstance",value:function(e,t){var n=this.generateJobInstanceKey(e.jobName,t);return this.jobInstancesByKey[n]=e,this.createTimeoutPromise(e)}},{key:"getJobResult",value:function(e){return this.createTimeoutPromise(c.Utils.find(this.jobResults,function(t){return t.id===e}))}},{key:"getJobResultByInstance",value:function(e){return this.createTimeoutPromise(c.Utils.find(this.jobResults,function(t){return t.jobInstance.id===e.id}))}},{key:"saveJobResult",value:function(e){return this.jobResults.push(e),this.createTimeoutPromise(e)}},{key:"getJobExecutionById",value:function(e){return this.createTimeoutPromise(c.Utils.find(this.jobExecutions,function(t){return t.id===e}))}},{key:"saveJobExecution",value:function(e){return this.jobExecutions.push(e),this.createTimeoutPromise(e)}},{key:"updateJobExecutionProgress",value:function(e,t){return this.executionProgress[e]=t,this.createTimeoutPromise(t)}},{key:"getJobExecutionProgress",value:function(e){return this.createTimeoutPromise(this.executionProgress[e])}},{key:"saveJobExecutionFlag",value:function(e,t){return this.executionFlags[e]=t,this.createTimeoutPromise(t)}},{key:"getJobExecutionFlag",value:function(e){return this.createTimeoutPromise(this.executionFlags[e])}},{key:"saveStepExecution",value:function(e){return this.stepExecutions.push(e),this.createTimeoutPromise(e)}},{key:"findJobExecutions",value:function(e){return this.createTimeoutPromise(this.jobExecutions.filter(function(t){return t.jobInstance.id==e.id}).sort(function(e,t){return e.createTime.getTime()-t.createTime.getTime()}))}},{key:"remove",value:function(e){}}]),t}(s.JobRepository)},{"./job-repository":42,"sd-utils":"sd-utils"}],44:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JobResult=void 0;var i=(e("./job-status"),e("./step-execution"),e("sd-utils"));e("./execution-context"),n.JobResult=function r(e,t){o(this,r),this.lastUpdated=null,null===t||void 0===t?this.id=i.Utils.guid():this.id=t,this.jobInstance=e}},{"./execution-context":31,"./job-status":45,"./step-execution":49,"sd-utils":"sd-utils"}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.JOB_STATUS={COMPLETED:"COMPLETED",STARTING:"STARTING",STARTED:"STARTED",STOPPING:"STOPPING",STOPPED:"STOPPED",FAILED:"FAILED",UNKNOWN:"UNKNOWN",ABANDONED:"ABANDONED",EXECUTING:"EXECUTING"}},{}],46:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Job=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-utils"),a=e("./job-status"),u=e("./exceptions/job-interrupted-exception"),s=e("./exceptions/job-parameters-invalid-exception"),c=e("./exceptions/job-data-invalid-exception"),l=e("./job-execution-flag"),f=e("./job-result");n.Job=function(){function e(t,n){o(this,e),this.steps=[],this.isRestartable=!0,this.executionListeners=[],this.name=t,this.jobParametersValidator=this.getJobParametersValidator(),this.jobDataValidator=this.getJobDataValidator(),this.jobRepository=n}return i(e,[{key:"setJobRepository",value:function(e){this.jobRepository=e}},{key:"execute",value:function(e){var t=this;r.log.debug("Job execution starting: ",e);var n;return this.checkExecutionFlags(e).then(function(e){if(e.status===a.JOB_STATUS.STOPPING)return e.status=a.JOB_STATUS.STOPPED,e.exitStatus=a.JOB_STATUS.COMPLETED,r.log.debug("Job execution was stopped: "+e),e;if(t.jobParametersValidator&&!t.jobParametersValidator.validate(e.jobParameters))throw new s.JobParametersInvalidException("Invalid job parameters in job execute");if(t.jobDataValidator&&!t.jobDataValidator.validate(e.getData()))throw new c.JobDataInvalidException("Invalid job data in job execute");return e.startTime=new Date,Promise.all([t.updateStatus(e,a.JOB_STATUS.STARTED),t.getResult(e),t.updateProgress(e)]).then(function(o){return e=o[0],n=o[1],n||(n=new f.JobResult(e.jobInstance)),t.executionListeners.forEach(function(t){return t.beforeJob(e)}),t.doExecute(e,n)})}).then(function(e){return r.log.debug("Job execution complete: ",e),e})["catch"](function(t){return t instanceof u.JobInterruptedException?(r.log.info("Encountered interruption executing job",t),e.status=a.JOB_STATUS.STOPPED,e.exitStatus=a.JOB_STATUS.STOPPED):(r.log.error("Encountered fatal error executing job",t),e.status=a.JOB_STATUS.FAILED,e.exitStatus=a.JOB_STATUS.FAILED),e.failureExceptions.push(t),e}).then(function(e){return n?t.jobRepository.saveJobResult(n).then(function(){return e}):e})["catch"](function(t){return r.log.error("Encountered fatal error saving job results",t),t&&e.failureExceptions.push(t),e.status=a.JOB_STATUS.FAILED,e.exitStatus=a.JOB_STATUS.FAILED,e}).then(function(e){return e.endTime=new Date,Promise.all([t.jobRepository.update(e),t.updateProgress(e)]).then(function(e){return e[0]})}).then(function(e){try{t.executionListeners.forEach(function(t){return t.afterJob(e)})}catch(n){r.log.error("Exception encountered in afterStep callback",n)}return e})}},{key:"updateStatus",value:function(e,t){return e.status=t,this.jobRepository.update(e)}},{key:"updateProgress",value:function(e){return this.jobRepository.updateJobExecutionProgress(e.id,this.getProgress(e))}},{key:"doExecute",value:function(e,t){throw"doExecute function not implemented for job: "+this.name}},{key:"getJobParametersValidator",value:function(){return{validate:function(e){return e.validate()}}}},{key:"getJobDataValidator",value:function(){return{validate:function(e){return!0}}}},{key:"addStep",value:function(e){this.steps.push(e)}},{key:"createJobParameters",value:function(e){throw"createJobParameters function not implemented for job: "+this.name}},{key:"getProgress",value:function(e){return{total:1,current:e.status===a.JOB_STATUS.COMPLETED?1:0}}},{key:"registerExecutionListener",value:function(e){this.executionListeners.push(e)}},{key:"checkExecutionFlags",value:function(e){return this.jobRepository.getJobExecutionFlag(e.id).then(function(t){return l.JOB_EXECUTION_FLAG.STOP===t&&e.stop(),e})}},{key:"getResult",value:function(e){return this.jobRepository.getJobResultByInstance(e.jobInstance)}}]),e}()},{"./exceptions/job-data-invalid-exception":25,"./exceptions/job-interrupted-exception":28,"./exceptions/job-parameters-invalid-exception":29,"./job-execution-flag":33,"./job-result":44,"./job-status":45,"sd-utils":"sd-utils"}],47:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.SimpleJob=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function h(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:h(i,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},c=e("sd-utils"),l=e("./job-status"),f=e("./job"),p=e("./execution-context"),b=e("./step"),d=e("./exceptions/job-interrupted-exception"),y=e("./exceptions/job-restart-exception");e("./job-execution-flag"),n.SimpleJob=function(e){function t(e,n){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return r(t,e),u(t,[{key:"getStep",value:function(e){return c.Utils.find(this.steps,function(t){return t.name==e})}},{key:"doExecute",value:function(e,t){return this.handleNextStep(e,t).then(function(t){return null!=t&&(c.log.debug("Updating JobExecution status: ",t),e.status=t.status,e.exitStatus=t.exitStatus),e})}},{key:"handleNextStep",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=0;if(o&&(r=this.steps.indexOf(o)+1),r>=this.steps.length)return Promise.resolve(i);var a=this.steps[r];return this.handleStep(a,e,t).then(function(o){return o.status!==l.JOB_STATUS.COMPLETED?o:n.handleNextStep(e,t,a,o)})}},{key:"handleStep",value:function(e,t,n){var o=this,i=t.jobInstance;return this.checkExecutionFlags(t).then(function(t){if(t.isStopping())throw new d.JobInterruptedException("JobExecution interrupted.");return o.jobRepository.getLastStepExecution(i,e.name)}).then(function(r){o.stepExecutionPartOfExistingJobExecution(t,r)&&(c.log.info("Duplicate step detected in execution of job. step: "+e.name+" jobName: ",i.jobName),r=null);var a=r;if(!o.shouldStart(a,t,e))return a;a=t.createStepExecution(e.name);var u=null!=r&&r.status===l.JOB_STATUS.COMPLETED,s=null!=r&&!u,f=u&&e.skipOnRestartIfCompleted;return s?(a.executionContext=r.executionContext,r.executionContext.containsKey("executed")&&a.executionContext.remove("executed")):a.executionContext=new p.ExecutionContext,f&&(a.exitStatus=l.JOB_STATUS.COMPLETED,a.status=l.JOB_STATUS.COMPLETED,a.executionContext.put("skipped",!0)),o.jobRepository.addStepExecution(a).then(function(t){return a=t,f?(c.log.info("Skipping completed step execution: ["+e.name+"]"),a):(c.log.info("Executing step: ["+e.name+"]"),e.execute(a,n))}).then(function(){return a.executionContext.put("executed",!0),a})["catch"](function(e){return t.status=l.JOB_STATUS.FAILED,o.jobRepository.update(t).then(function(t){throw e})})}).then(function(e){return e.status!=l.JOB_STATUS.STOPPING&&e.status!=l.JOB_STATUS.STOPPED||(t.status=l.JOB_STATUS.STOPPING),o.updateProgress(t).then(function(){return e})})}},{key:"stepExecutionPartOfExistingJobExecution",value:function(e,t){return null!=t&&t.jobExecution.id==e.id}},{key:"shouldStart",value:function(e,t,n){var o;if(o=null==e?l.JOB_STATUS.STARTING:e.status,o==l.JOB_STATUS.UNKNOWN)throw new y.JobRestartException("Cannot restart step from UNKNOWN status");return o!=l.JOB_STATUS.COMPLETED||n.isRestartable}},{key:"getProgress",value:function(e){var t=e.stepExecutions.length;return l.JOB_STATUS.COMPLETED!==e.stepExecutions[e.stepExecutions.length-1].status&&t--,Math.round(100*t/this.steps.length)}},{key:"addStep",value:function(){if(1===arguments.length)return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addStep",this).call(this,arguments[0]);var e=new b.Step(arguments[0],this.jobRepository);return e.doExecute=arguments[1],s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addStep",this).call(this,e)}}]),t}(f.Job)},{"./exceptions/job-interrupted-exception":28,"./exceptions/job-restart-exception":30,"./execution-context":31,"./job":46,"./job-execution-flag":33,"./job-status":45,"./step":50,"sd-utils":"sd-utils"}],48:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.StepExecutionListener=function(){function e(){o(this,e)}return i(e,[{key:"beforeStep",value:function(e){}},{key:"afterStep",value:function(e){}}]),e}()},{}],49:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.StepExecution=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-utils"),a=e("./execution-context"),u=e("./job-status"),s=e("./job-execution");n.StepExecution=function(){function e(t,n,i){o(this,e),this.status=u.JOB_STATUS.STARTING,this.exitStatus=u.JOB_STATUS.EXECUTING,this.executionContext=new a.ExecutionContext,this.startTime=new Date,this.endTime=null,this.lastUpdated=null,this.terminateOnly=!1,this.failureExceptions=[],null===i||void 0===i?this.id=r.Utils.guid():this.id=i,this.stepName=t,this.jobExecution=n,this.jobExecutionId=n.id}return i(e,[{key:"getJobParameters",value:function(){return this.jobExecution.jobParameters}},{key:"getJobExecutionContext",value:function(){return this.jobExecution.executionContext}},{key:"getData",value:function(){return this.jobExecution.getData()}},{key:"getDTO",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=r.Utils.cloneDeepWith;return t||(n=r.Utils.cloneWith),r.Utils.assign({},n(this,function(n,o,i,a){return e.indexOf(o)>-1?null:["executionContext"].indexOf(o)>-1?n.getDTO():n instanceof Error?r.Utils.getErrorDTO(n):n instanceof s.JobExecution?n.getDTO(["stepExecutions"],t):void 0}))}}]),e}()},{"./execution-context":31,"./job-execution":35,"./job-status":45,"sd-utils":"sd-utils"}],50:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Step=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./job-status"),a=e("sd-utils"),u=e("./exceptions/job-interrupted-exception");n.Step=function(){function e(t,n){o(this,e),this.isRestartable=!0,this.skipOnRestartIfCompleted=!0,this.steps=[],this.executionListeners=[],this.name=t,this.jobRepository=n}return i(e,[{key:"setJobRepository",value:function(e){this.jobRepository=e}},{key:"execute",value:function(e,t){var n=this;a.log.debug("Executing step: name="+this.name),e.startTime=new Date,e.status=r.JOB_STATUS.STARTED;var o;return this.jobRepository.update(e).then(function(e){return o=r.JOB_STATUS.EXECUTING,n.executionListeners.forEach(function(t){return t.beforeStep(e)}),n.open(e.executionContext),n.doExecute(e,t)}).then(function(t){if(e=t,o=e.exitStatus,e.terminateOnly)throw new u.JobInterruptedException("JobExecution interrupted.");return e.status=r.JOB_STATUS.COMPLETED,a.log.debug("Step execution success: name="+n.name),e})["catch"](function(t){return e.status=n.determineJobStatus(t),o=e.status,e.failureExceptions.push(t),e.status==r.JOB_STATUS.STOPPED?a.log.info("Encountered interruption executing step: "+n.name+" in job: "+e.jobExecution.jobInstance.jobName,t):a.log.error("Encountered an error executing step: "+n.name+" in job: "+e.jobExecution.jobInstance.jobName,t),e}).then(function(e){try{e.exitStatus=o,n.executionListeners.forEach(function(t){return t.afterStep(e)})}catch(t){a.log.error("Exception in afterStep callback in step "+n.name+" in job: "+e.jobExecution.jobInstance.jobName,t)}return e.endTime=new Date,e.exitStatus=o,n.jobRepository.update(e)}).then(function(e){try{n.close(e.executionContext)}catch(t){a.log.error("Exception while closing step execution resources in step: "+n.name+" in job: "+e.jobExecution.jobInstance.jobName,t),e.failureExceptions.push(t)}try{n.close(e.executionContext)}catch(t){a.log.error("Exception while closing step execution resources in step: "+n.name+" in job: "+e.jobExecution.jobInstance.jobName,t),e.failureExceptions.push(t)}return a.log.debug("Step execution complete: "+e.id),e})}},{key:"determineJobStatus",value:function(e){return e instanceof u.JobInterruptedException?r.JOB_STATUS.STOPPED:r.JOB_STATUS.FAILED}},{key:"doExecute",value:function(e,t){}},{key:"open",value:function(e){}},{key:"close",value:function(e){}},{key:"getProgress",value:function(e){return{total:1,current:e.status===r.JOB_STATUS.COMPLETED?1:0}}}]),e}()},{"./exceptions/job-interrupted-exception":28,"./job-status":45,"sd-utils":"sd-utils"}],51:[function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.engine=void 0;var i=e("./jobs-manager");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var r=e("./job-worker");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}})});var a=e("./engine/index"),u=o(a);n.engine=u},{"./engine/index":32,"./job-worker":53,"./jobs-manager":54}],52:[function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobInstanceManager=n.JobInstanceManagerConfig=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("./engine/job-execution-listener"),c=e("./engine/job-status"),l=e("./engine/job-instance"),f=e("sd-utils"),p=n.JobInstanceManagerConfig=function b(e){r(this,b),this.onJobStarted=function(){},this.onJobCompleted=function(e){},this.onJobFailed=function(e){},this.onJobStopped=function(){},this.onJobTerminated=function(){},this.onProgress=function(e){},this.updateInterval=100,e&&f.Utils.deepExtend(this,e)};n.JobInstanceManager=function(e){function t(e,n,i){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.progress=null,a.config=new p(i),a.jobsManger=e,n instanceof l.JobInstance?(a.jobInstance=n,a.getLastJobExecution().then(function(e){a.checkProgress()})):(a.lastJobExecution=n,a.jobInstance=a.lastJobExecution.jobInstance,a.checkProgress()),a.lastJobExecution&&!a.lastJobExecution.isRunning()?(a.afterJob(a.lastJobExecution),o(a)):(e.registerJobExecutionListener(a),a)}return i(t,e),u(t,[{key:"checkProgress",value:function(){var e=this,t=this;!this.terminated&&this.lastJobExecution.isRunning()&&100!==this.getProgressPercents(this.progress)&&this.jobsManger.getProgress(this.lastJobExecution).then(function(n){e.lastUpdateTime=new Date,n&&(e.progress=n,e.config.onProgress.call(e.config.callbacksThisArg||e,n)),setTimeout(function(){t.checkProgress()},e.config.updateInterval)})}},{key:"beforeJob",value:function(e){e.jobInstance.id===this.jobInstance.id&&(this.lastJobExecution=e,this.config.onJobStarted.call(this.config.callbacksThisArg||this))}},{key:"getProgressPercents",value:function(e){return e?100*e.current/e.total:0}},{key:"getProgressFromExecution",value:function(e){var t=this.jobsManger.getJobByName(e.jobInstance.jobName);return t.getProgress(e)}},{key:"afterJob",value:function(e){var t=this;e.jobInstance.id===this.jobInstance.id&&(this.lastJobExecution=e,c.JOB_STATUS.COMPLETED===e.status?(this.jobsManger.deregisterJobExecutionListener(this),this.progress=this.getProgressFromExecution(e),this.config.onProgress.call(this.config.callbacksThisArg||this,this.progress),this.jobsManger.getResult(e.jobInstance).then(function(e){t.config.onJobCompleted.call(t.config.callbacksThisArg||t,e.data)})["catch"](function(e){f.log.error(e)})):c.JOB_STATUS.FAILED===e.status?this.config.onJobFailed.call(this.config.callbacksThisArg||this,e.failureExceptions):c.JOB_STATUS.STOPPED===e.status&&this.config.onJobStopped.call(this.config.callbacksThisArg||this))}},{key:"getLastJobExecution",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!this.lastJobExecution||t?this.jobsManger.jobRepository.getLastJobExecutionByInstance(this.jobInstance).then(function(t){return e.lastJobExecution=t,t}):Promise.resolve(this.lastJobExecution)}},{key:"stop",value:function(){var e=this;return this.getLastJobExecution().then(function(){return e.jobsManger.stop(e.lastJobExecution)})}},{key:"resume",value:function(){var e=this;return this.getLastJobExecution().then(function(){return e.jobsManger.run(e.jobInstance.jobName,e.lastJobExecution.jobParameters.values,e.lastJobExecution.getData()).then(function(t){e.lastJobExecution=t,e.checkProgress()})["catch"](function(e){f.log.error(e)})})}},{key:"terminate",value:function(){var e=this;return this.getLastJobExecution().then(function(){return e.jobsManger.terminate(e.jobInstance).then(function(){return e.terminated=!0,e.config.onJobTerminated.call(e.config.callbacksThisArg||e,e.lastJobExecution),e.jobsManger.deregisterJobExecutionListener(e),e.lastJobExecution})})["catch"](function(e){f.log.error(e)})}}]),t}(s.JobExecutionListener)},{"./engine/job-execution-listener":34,"./engine/job-instance":36,"./engine/job-status":45,"sd-utils":"sd-utils"}],53:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.JobWorker=function(){function e(t,n,i){o(this,e),this.listeners={};var r=this;this.worker=new Worker(t),this.defaultListener=n||function(){},i&&(this.worker.onerror=i),this.worker.onmessage=function(e){if(e.data instanceof Object&&e.data.hasOwnProperty("queryMethodListener")&&e.data.hasOwnProperty("queryMethodArguments")){var t=r.listeners[e.data.queryMethodListener],n=e.data.queryMethodArguments;t.deserializer&&(n=t.deserializer(n)),t.fn.apply(t.thisArg,n)}else this.defaultListener.call(r,e.data)}}return i(e,[{key:"sendQuery",value:function(){if(arguments.length<1)throw new TypeError("JobWorker.sendQuery takes at least one argument");this.worker.postMessage({queryMethod:arguments[0],queryArguments:Array.prototype.slice.call(arguments,1)})}},{key:"runJob",value:function(e,t,n){this.sendQuery("runJob",e,t,n)}},{key:"executeJob",value:function(e){this.sendQuery("executeJob",e)}},{key:"recompute",value:function(e,t,n,o){this.sendQuery("recompute",e,t,n,o)}},{key:"postMessage",value:function(e){this.worker.postMessage(e)}},{key:"terminate",value:function(){this.worker.terminate()}},{key:"addListener",value:function(e,t,n,o){this.listeners[e]={fn:t,thisArg:n||this,deserializer:o}}},{key:"removeListener",value:function(e){delete this.listeners[e]}}]),e}()},{}],54:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.JobsManager=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-utils"),c=e("./configurations/sensitivity-analysis/sensitivity-analysis-job"),l=e("./engine/job-launcher"),f=e("./job-worker"),p=e("./engine/job-execution-listener"),b=e("./engine/job-parameters"),d=e("./engine/job-repository/idb-job-repository"),y=e("./engine/job-execution-flag"),h=e("./configurations/recompute/recompute-job"),v=e("./configurations/probabilistic-sensitivity-analysis/probabilistic-sensitivity-analysis-job"),m=(e("./engine/job-repository/timeout-job-repository"),e("./configurations/tornado-diagram/tornado-diagram-job")),g=e("./engine/job-status");n.JobsManager=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.jobExecutionListeners=[],a.afterJobExecutionPromiseResolves={},a.jobInstancesToTerminate={},a.expressionEngine=e.expressionEngine,a.expressionsEvaluator=e,a.objectiveRulesManager=n,a.jobRepository=new d.IdbJobRepository(a.expressionEngine.getJsonReviver()),a.registerJobs(),a.useWorker=!!r,a.useWorker&&a.initWorker(r),a.jobLauncher=new l.JobLauncher(a.jobRepository,a.jobWorker,function(e){return a.serializeData(e)}),a}return r(t,e),u(t,[{key:"serializeData",value:function(e){return e.serialize(!0,!1,!1,this.expressionEngine.getJsonReplacer())}},{key:"getProgress",value:function(e){var t=e;return s.Utils.isString(e)||(t=e.id),this.jobRepository.getJobExecutionProgress(t)}},{key:"getResult",value:function(e){return this.jobRepository.getJobResultByInstance(e)}},{key:"run",value:function(e,t,n){var o=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.jobLauncher.run(e,t,n,i).then(function(e){return i||!e.isRunning()?e:new Promise(function(t,n){o.afterJobExecutionPromiseResolves[e.id]=t})})}},{key:"execute",value:function(e){return this.jobLauncher.execute(e)}},{key:"stop",value:function(e){var t=this,n=e;return s.Utils.isString(e)||(n=e.id),this.jobRepository.getJobExecutionById(n).then(function(n){return n?n.isRunning()?t.jobRepository.saveJobExecutionFlag(n.id,y.JOB_EXECUTION_FLAG.STOP).then(function(){return n}):(s.log.warn("Job Execution not running, status: "+n.status+", endTime: "+n.endTime),n):(s.log.error("Job Execution not found: "+e),null)})}},{key:"terminate",value:function(e){var t=this;return this.jobRepository.getLastJobExecutionByInstance(e).then(function(e){
if(e&&e.isRunning())return t.jobRepository.saveJobExecutionFlag(e.id,y.JOB_EXECUTION_FLAG.STOP).then(function(){return e})}).then(function(){t.jobInstancesToTerminate[e.id]=e})}},{key:"getJobByName",value:function(e){return this.jobRepository.getJobByName(e)}},{key:"createJobParameters",value:function(e,t){var n=this.jobRepository.getJobByName(e);return n.createJobParameters(t)}},{key:"getLastJobExecution",value:function(e,t){return this.useWorker?this.jobWorker:(t instanceof b.JobParameters||(t=this.createJobParameters(t)),this.jobRepository.getLastJobExecution(e,t))}},{key:"initWorker",value:function(e){var t=arguments,n=this;this.jobWorker=new f.JobWorker(e,function(){s.log.error("error in worker",t)});var o=function(e){return[n.jobRepository.reviveJobExecution(e[0])]};this.jobWorker.addListener("beforeJob",this.beforeJob,this,o),this.jobWorker.addListener("afterJob",this.afterJob,this,o),this.jobWorker.addListener("jobFatalError",this.onJobFatalError,this)}},{key:"registerJobs",value:function(){this.registerJob(new c.SensitivityAnalysisJob(this.jobRepository,this.expressionsEvaluator,this.objectiveRulesManager)),this.registerJob(new m.TornadoDiagramJob(this.jobRepository,this.expressionsEvaluator,this.objectiveRulesManager)),this.registerJob(new v.ProbabilisticSensitivityAnalysisJob(this.jobRepository,this.expressionsEvaluator,this.objectiveRulesManager)),this.registerJob(new h.RecomputeJob(this.jobRepository,this.expressionsEvaluator,this.objectiveRulesManager))}},{key:"registerJob",value:function(e){this.jobRepository.registerJob(e),e.registerExecutionListener(this)}},{key:"registerJobExecutionListener",value:function(e){this.jobExecutionListeners.push(e)}},{key:"deregisterJobExecutionListener",value:function(e){var t=this.jobExecutionListeners.indexOf(e);t>-1&&this.jobExecutionListeners.splice(t,1)}},{key:"beforeJob",value:function(e){s.log.debug("beforeJob",this.useWorker,e),this.jobExecutionListeners.forEach(function(t){return t.beforeJob(e)})}},{key:"afterJob",value:function(e){s.log.debug("afterJob",this.useWorker,e),this.jobExecutionListeners.forEach(function(t){return t.afterJob(e)});var t=this.afterJobExecutionPromiseResolves[e.id];t&&t(e),this.jobInstancesToTerminate[e.jobInstance.id]&&this.jobRepository.remove(e.jobInstance)}},{key:"onJobFatalError",value:function(e,t){var n=this,o=this.afterJobExecutionPromiseResolves[e];o&&this.jobRepository.getJobExecutionById(e).then(function(e){return e.status=g.JOB_STATUS.FAILED,t&&e.failureExceptions.push(t),n.jobRepository.saveJobExecution(e).then(function(){o(e)})})["catch"](function(e){s.log.error(e)}),s.log.debug("onJobFatalError",e,t)}}]),t}(p.JobExecutionListener)},{"./configurations/probabilistic-sensitivity-analysis/probabilistic-sensitivity-analysis-job":8,"./configurations/recompute/recompute-job":11,"./configurations/sensitivity-analysis/sensitivity-analysis-job":13,"./configurations/tornado-diagram/tornado-diagram-job":21,"./engine/job-execution-flag":33,"./engine/job-execution-listener":34,"./engine/job-launcher":38,"./engine/job-parameters":40,"./engine/job-repository/idb-job-repository":41,"./engine/job-repository/timeout-job-repository":43,"./engine/job-status":45,"./job-worker":53,"sd-utils":"sd-utils"}],55:[function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ObjectiveRulesManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("./rules"),u=e("sd-utils"),s=e("sd-model"),c=o(s);n.ObjectiveRulesManager=function(){function e(t,n,o){i(this,e),this.ruleByName={},this.data=t,this.expressionEngine=n;var r=new a.ExpectedValueMaximizationRule(n),u=new a.MaxiMinRule(n),s=new a.MaxiMaxRule(n),c=new a.ExpectedValueMinimizationRule(n),l=new a.MiniMinRule(n),f=new a.MiniMaxRule(n);this.ruleByName[r.name]=r,this.ruleByName[u.name]=u,this.ruleByName[s.name]=s,this.ruleByName[c.name]=c,this.ruleByName[l.name]=l,this.ruleByName[f.name]=f,this.rules=[r,c,u,s,l,f],o?this.currentRule=this.ruleByName[o]:this.currentRule=this.rules[0]}return r(e,[{key:"isRuleName",value:function(e){return!!this.ruleByName[e]}},{key:"setCurrentRuleByName",value:function(e){this.currentRule=this.ruleByName[e]}},{key:"recompute",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=(new Date).getTime();u.log.trace("recomputing rules, all: "+e),this.data.getRoots().forEach(function(o){t.recomputeTree(o,e,n)});var i=(new Date).getTime()-o/1e3;return u.log.trace("recomputation took "+i+"s"),this}},{key:"recomputeTree",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u.log.trace("recomputing rules for tree ...",e);var o=(new Date).getTime(),i=[this.currentRule];t&&(i=this.rules),i.forEach(function(t){t.setDecisionPolicy(n),t.computePayoff(e),t.computeOptimal(e),t.clearDecisionPolicy()});var r=((new Date).getTime()-o)/1e3;return u.log.trace("recomputation took "+r+"s"),this}},{key:"getNodeDisplayValue",value:function(e,t){return e.computedValue(this.currentRule.name,t)}},{key:"getEdgeDisplayValue",value:function(e,t){return"probability"===t?e.parentNode instanceof c.domain.DecisionNode?e.computedValue(this.currentRule.name,"probability"):e.parentNode instanceof c.domain.ChanceNode?e.computedBaseProbability():null:"payoff"===t?e.computedBasePayoff():"optimal"===t?e.computedValue(this.currentRule.name,"optimal"):void 0}}]),e}()},{"./rules":58,"sd-model":"sd-model","sd-utils":"sd-utils"}],56:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.ExpectedValueMaximizationRule=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("sd-model"),l=e("./objective-rule"),f=e("sd-utils"),p=n.ExpectedValueMaximizationRule=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.NAME,e))}return a(t,e),s(t,[{key:"makeDecision",value:function(e,t){return f.Utils.indexesOf(t,this.max.apply(this,o(t)))}},{key:"computeOptimal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.cValue(e,"optimal",!0),e instanceof c.domain.TerminalNode&&this.cValue(e,"probabilityToEnter",o),e.childEdges.forEach(function(i){!t.subtract(t.cValue(e,"payoff"),n).equals(t.cValue(i.childNode,"payoff"))&&e instanceof c.domain.DecisionNode?t.cValue(i,"optimal",!1):(t.cValue(i,"optimal",!0),t.computeOptimal(i.childNode,t.basePayoff(i),t.multiply(o,t.cValue(i,"probability"))))})}}]),t}(l.ObjectiveRule);p.NAME="expected-value-maximization"},{"./objective-rule":63,"sd-model":"sd-model","sd-utils":"sd-utils"}],57:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.ExpectedValueMinimizationRule=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("sd-model"),l=e("./objective-rule"),f=e("sd-utils"),p=n.ExpectedValueMinimizationRule=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.NAME,e))}return a(t,e),s(t,[{key:"makeDecision",value:function(e,t){return f.Utils.indexesOf(t,this.min.apply(this,o(t)))}},{key:"computeOptimal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.cValue(e,"optimal",!0),e instanceof c.domain.TerminalNode&&this.cValue(e,"probabilityToEnter",o),e.childEdges.forEach(function(i){!t.subtract(t.cValue(e,"payoff"),n).equals(t.cValue(i.childNode,"payoff"))&&e instanceof c.domain.DecisionNode?t.cValue(i,"optimal",!1):(t.cValue(i,"optimal",!0),t.computeOptimal(i.childNode,t.basePayoff(i),t.multiply(o,t.cValue(i,"probability"))))})}}]),t}(l.ObjectiveRule);p.NAME="expected-value-minimization"},{"./objective-rule":63,"sd-model":"sd-model","sd-utils":"sd-utils"}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./objective-rule");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=e("./expected-value-maximization-rule");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var r=e("./expected-value-minimization-rule");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}})});var a=e("./maxi-max-rule");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});var u=e("./maxi-min-rule");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}})});var s=e("./mini-max-rule");Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}})});var c=e("./mini-min-rule");Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return c[e]}})})},{"./expected-value-maximization-rule":56,"./expected-value-minimization-rule":57,"./maxi-max-rule":59,"./maxi-min-rule":60,"./mini-max-rule":61,"./mini-min-rule":62,"./objective-rule":63}],59:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.MaxiMaxRule=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("sd-model"),l=e("./objective-rule"),f=e("sd-utils"),p=n.MaxiMaxRule=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.NAME,e))}return a(t,e),s(t,[{key:"makeDecision",value:function(e,t){return f.Utils.indexesOf(t,this.max.apply(this,o(t)))}},{key:"modifyChanceProbability",value:function(e,t,n,o,i){var r=this;e.forEach(function(e){r.clearComputedValues(e),r.cValue(e,"probability",r.cValue(e.childNode,"payoff")<t?0:1/n)})}},{key:"computeOptimal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.cValue(e,"optimal",!0),e instanceof c.domain.TerminalNode&&this.cValue(e,"probabilityToEnter",o);var i=null;e instanceof c.domain.ChanceNode&&(i=f.Utils.maxBy(e.childEdges,function(e){return t.cValue(e.childNode,"payoff")})),e.childEdges.forEach(function(r){var a=!1;a=i?t.cValue(i.childNode,"payoff").equals(t.cValue(r.childNode,"payoff")):!(!t.subtract(t.cValue(e,"payoff"),n).equals(t.cValue(r.childNode,"payoff"))&&e instanceof c.domain.DecisionNode),a?(t.cValue(r,"optimal",!0),t.computeOptimal(r.childNode,t.basePayoff(r),t.multiply(o,t.cValue(r,"probability")))):t.cValue(r,"optimal",!1)})}}]),t}(l.ObjectiveRule);p.NAME="maxi-max"},{"./objective-rule":63,"sd-model":"sd-model","sd-utils":"sd-utils"}],60:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.MaxiMinRule=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("sd-model"),l=e("./objective-rule"),f=e("sd-utils"),p=n.MaxiMinRule=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.NAME,e))}return a(t,e),s(t,[{key:"makeDecision",value:function(e,t){return f.Utils.indexesOf(t,this.max.apply(this,o(t)))}},{key:"modifyChanceProbability",value:function(e,t,n,o,i){var r=this;e.forEach(function(e){r.clearComputedValues(e),r.cValue(e,"probability",r.cValue(e.childNode,"payoff")>o?0:1/i)})}},{key:"computeOptimal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.cValue(e,"optimal",!0),e instanceof c.domain.TerminalNode&&this.cValue(e,"probabilityToEnter",o);var i=null;e instanceof c.domain.ChanceNode&&(i=f.Utils.minBy(e.childEdges,function(e){return t.cValue(e.childNode,"payoff")})),e.childEdges.forEach(function(r){var a=!1;a=i?t.cValue(i.childNode,"payoff").equals(t.cValue(r.childNode,"payoff")):!(!t.subtract(t.cValue(e,"payoff"),n).equals(t.cValue(r.childNode,"payoff"))&&e instanceof c.domain.DecisionNode),a?(t.cValue(r,"optimal",!0),t.computeOptimal(r.childNode,t.basePayoff(r),t.multiply(o,t.cValue(r,"probability")))):t.cValue(r,"optimal",!1)})}}]),t}(l.ObjectiveRule);p.NAME="maxi-min"},{"./objective-rule":63,"sd-model":"sd-model","sd-utils":"sd-utils"}],61:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.MiniMaxRule=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("sd-model"),l=e("./objective-rule"),f=e("sd-utils"),p=n.MiniMaxRule=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.NAME,e))}return a(t,e),s(t,[{key:"makeDecision",value:function(e,t){return f.Utils.indexesOf(t,this.min.apply(this,o(t)))}},{key:"modifyChanceProbability",value:function(e,t,n,o,i){var r=this;e.forEach(function(e){r.clearComputedValues(e),r.cValue(e,"probability",r.cValue(e.childNode,"payoff")<t?0:1/n)})}},{key:"computeOptimal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.cValue(e,"optimal",!0),e instanceof c.domain.TerminalNode&&this.cValue(e,"probabilityToEnter",o);var i=null;e instanceof c.domain.ChanceNode&&(i=f.Utils.maxBy(e.childEdges,function(e){return t.cValue(e.childNode,"payoff")})),e.childEdges.forEach(function(r){var a=!1;a=i?t.cValue(i.childNode,"payoff").equals(t.cValue(r.childNode,"payoff")):!(!t.subtract(t.cValue(e,"payoff"),n).equals(t.cValue(r.childNode,"payoff"))&&e instanceof c.domain.DecisionNode),a?(t.cValue(r,"optimal",!0),t.computeOptimal(r.childNode,t.basePayoff(r),t.multiply(o,t.cValue(r,"probability")))):t.cValue(r,"optimal",!1)})}}]),t}(l.ObjectiveRule);p.NAME="mini-max"},{"./objective-rule":63,"sd-model":"sd-model","sd-utils":"sd-utils"}],62:[function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.MiniMinRule=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("sd-model"),l=e("./objective-rule"),f=e("sd-utils"),p=n.MiniMinRule=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.NAME,e))}return a(t,e),s(t,[{key:"makeDecision",value:function(e,t){return f.Utils.indexesOf(t,this.min.apply(this,o(t)))}},{key:"modifyChanceProbability",value:function(e,t,n,o,i){var r=this;e.forEach(function(e){r.clearComputedValues(e),r.cValue(e,"probability",r.cValue(e.childNode,"payoff")>o?0:1/i)})}},{key:"computeOptimal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.cValue(e,"optimal",!0),e instanceof c.domain.TerminalNode&&this.cValue(e,"probabilityToEnter",o);var i=null;e instanceof c.domain.ChanceNode&&(i=f.Utils.minBy(e.childEdges,function(e){return t.cValue(e.childNode,"payoff")})),e.childEdges.forEach(function(r){var a=!1;a=i?t.cValue(i.childNode,"payoff").equals(t.cValue(r.childNode,"payoff")):!(!t.subtract(t.cValue(e,"payoff"),n).equals(t.cValue(r.childNode,"payoff"))&&e instanceof c.domain.DecisionNode),a?(t.cValue(r,"optimal",!0),t.computeOptimal(r.childNode,t.basePayoff(r),t.multiply(o,t.cValue(r,"probability")))):t.cValue(r,"optimal",!1)})}}]),t}(l.ObjectiveRule);p.NAME="mini-min"},{"./objective-rule":63,"sd-model":"sd-model","sd-utils":"sd-utils"}],63:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ObjectiveRule=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-expression-engine"),a=e("sd-model"),u=(e("../../policies/decision"),e("../../policies/policy"));n.ObjectiveRule=function(){function e(t,n){o(this,e),this.name=t,this.expressionEngine=n}return i(e,[{key:"setDecisionPolicy",value:function(e){this.decisionPolicy=e}},{key:"clearDecisionPolicy",value:function(){this.decisionPolicy=null}},{key:"makeDecision",value:function(e,t){throw"makeDecision function not implemented for rule: "+this.name}},{key:"_makeDecision",value:function(e,t){if(this.decisionPolicy){var n=u.Policy.getDecision(this.decisionPolicy,e);return n?[n.decisionValue]:[]}return this.makeDecision(e,t)}},{key:"modifyChanceProbability",value:function(e,t,n,o,i){}},{key:"computePayoff",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0;if(e.childEdges.length){if(e instanceof a.domain.DecisionNode){var r=this._makeDecision(e,e.childEdges.map(function(e){return t.computePayoff(e.childNode,t.basePayoff(e),t.add(t.basePayoff(e),o))}));e.childEdges.forEach(function(e,n){t.clearComputedValues(e),t.cValue(e,"probability",r.indexOf(n)<0?0:1)})}else{var u=-(1/0),s=1,c=1/0,l=1;e.childEdges.forEach(function(e){var n=t.computePayoff(e.childNode,t.basePayoff(e),t.add(t.basePayoff(e),o));n<c?(c=n,l=1):n.equals(c)&&l++,n>u?(u=n,s=1):n.equals(u)&&s++,t.clearComputedValues(e),t.cValue(e,"probability",t.baseProbability(e))}),this.modifyChanceProbability(e.childEdges,u,s,c,l)}var f=0;e.childEdges.forEach(function(e){f=t.add(f,t.cValue(e,"probability"))}),f>0&&e.childEdges.forEach(function(e){i=t.add(i,t.multiply(t.cValue(e,"probability"),t.cValue(e.childNode,"payoff")).div(f))})}return n=this.add(n,i),this.clearComputedValues(e),e instanceof a.domain.TerminalNode?(this.cValue(e,"aggregatedPayoff",o),this.cValue(e,"probabilityToEnter",0)):this.cValue(e,"childrenPayoff",i),this.cValue(e,"payoff",n)}},{key:"computeOptimal",value:function(e){throw"computeOptimal function not implemented for rule: "+this.name}},{key:"cValue",value:function(e,t,n){return e.computedValue(this.name,t,n)}},{key:"baseProbability",value:function(e){return e.computedBaseProbability()}},{key:"basePayoff",value:function(e){return e.computedBasePayoff()}},{key:"clearComputedValues",value:function(e){e.clearComputedValues(this.name)}},{key:"add",value:function(e,t){return r.ExpressionEngine.add(e,t)}},{key:"subtract",value:function(e,t){return r.ExpressionEngine.subtract(e,t)}},{key:"divide",value:function(e,t){return r.ExpressionEngine.divide(e,t)}},{key:"multiply",value:function(e,t){return r.ExpressionEngine.multiply(e,t)}},{key:"max",value:function(){return r.ExpressionEngine.max.apply(r.ExpressionEngine,arguments)}},{key:"min",value:function(){return r.ExpressionEngine.min.apply(r.ExpressionEngine,arguments)}}]),e}()},{"../../policies/decision":67,"../../policies/policy":69,"sd-expression-engine":"sd-expression-engine","sd-model":"sd-model"}],64:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.FlipSubtree=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("sd-model"),c=e("sd-expression-engine"),l=e("sd-utils"),f=e("./operation"),p=e("../validation/tree-validator"),b=n.FlipSubtree=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.$NAME));return r.data=e,r.expressionEngine=n,r.treeValidator=new p.TreeValidator(n),r}return r(t,e),u(t,[{key:"isApplicable",value:function(e){return e instanceof s.domain.ChanceNode}},{key:"canPerform",value:function(e){if(!this.isApplicable(e))return!1;if(!this.treeValidator.validate(this.data.getAllNodesInSubtree(e)).isValid())return!1;if(e.childEdges.length<1)return!1;var t,n=null,o=[],i=new Set;return!!e.childEdges.every(function(e){var r=e.childNode;return r instanceof s.domain.ChanceNode&&(!i.has(e.name.trim())&&(i.add(e.name.trim()),null===n?(n=r.childEdges.length,!(n<1)&&(r.childEdges.forEach(function(e){o.push(e.name.trim())}),t=new Set(o),t.size===o.length)):r.childEdges.length==n&&!!r.childEdges.every(function(e,t){return o[t]===e.name.trim()})))})}},{key:"perform",value:function(e){var t=this,n=this.data.cloneSubtree(e,!0),o=e.childEdges.length,i=e.childEdges[0].childNode.childEdges.length,r=i,a=o,u=this.data.callbacksDisabled;this.data.callbacksDisabled=!0;var l=e.childEdges[0].childNode.location.x,f=e.childEdges[0].childNode.childEdges[0].childNode.location.y,p=e.childEdges[o-1].childNode.childEdges[i-1].childNode.location.y,b=p-f,d=b/(r+1);e.childEdges.slice().forEach(function(e){return t.data.removeNode(e.childNode)});for(var y=0;y<r;y++){var h=new s.domain.ChanceNode(new s.domain.Point(l,f+(y+1)*d)),v=this.data.addNode(h,e);v.name=n.childEdges[0].childNode.childEdges[y].name,v.probability=0;for(var m=0;m<a;m++){var g=n.childEdges[m].childNode.childEdges[y].childNode,E=this.data.attachSubtree(g,h);E.name=n.childEdges[m].name,E.payoff=c.ExpressionEngine.add(n.childEdges[m].computedBasePayoff(),n.childEdges[m].childNode.childEdges[y].computedBasePayoff()),E.probability=c.ExpressionEngine.multiply(n.childEdges[m].computedBaseProbability(),n.childEdges[m].childNode.childEdges[y].computedBaseProbability()),v.probability=c.ExpressionEngine.add(v.probability,E.probability)}var x=function(e){return c.ExpressionEngine.divide(e,v.probability)};if(v.probability.equals(0)){var j=c.ExpressionEngine.divide(1,a);x=function(e){return j}}var O=0;h.childEdges.forEach(function(e){e.probability=x(e.probability),O=c.ExpressionEngine.add(O,e.probability),e.probability=t.expressionEngine.serialize(e.probability)}),this._normalizeProbabilitiesAfterFlip(h.childEdges,O),v.probability=this.expressionEngine.serialize(v.probability)}this._normalizeProbabilitiesAfterFlip(e.childEdges),this.data.callbacksDisabled=u,this.data._fireNodeAddedCallback()}},{key:"_normalizeProbabilitiesAfterFlip",value:function(e,t){var n=this;if(t||(t=0,e.forEach(function(e){t=c.ExpressionEngine.add(t,e.probability)})),!t.equals(1)){l.log.info("Sum of the probabilities in child nodes is not equal to 1 : ",t);var o=0,i=1e12,r=12;e.forEach(function(e){e.probability=parseInt(c.ExpressionEngine.round(e.probability,r)*i),o+=e.probability});var a=i-o;l.log.info("Normalizing with rounding to precision: "+r,a),e[0].probability=c.ExpressionEngine.add(a,e[0].probability),o=0,e.forEach(function(e){e.probability=n.expressionEngine.serialize(c.ExpressionEngine.divide(parseInt(e.probability),i))})}}}]),t}(f.Operation);b.$NAME="flipSubtree"},{"../validation/tree-validator":72,"./operation":65,"sd-expression-engine":"sd-expression-engine","sd-model":"sd-model","sd-utils":"sd-utils"}],65:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.Operation=function(){function e(t){o(this,e),this.name=t}return i(e,[{key:"isApplicable",value:function(){throw"isApplicable function not implemented for operation: "+this.name}},{key:"canPerform",value:function(e){throw"canPerform function not implemented for operation: "+this.name}},{key:"perform",value:function(e){throw"perform function not implemented for operation: "+this.name}}]),e}()},{}],66:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.OperationsManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,
o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./flip-subtree");n.OperationsManager=function(){function e(t,n){o(this,e),this.operations=[],this.operationByName={},this.data=t,this.expressionEngine=n,this.registerOperation(new r.FlipSubtree(t,n))}return i(e,[{key:"registerOperation",value:function(e){this.operations.push(e),this.operationByName[e.name]=e}},{key:"getOperationByName",value:function(e){return this.operationByName[e]}},{key:"operationsForObject",value:function(e){return this.operations.filter(function(t){return t.isApplicable(e)})}}]),e}()},{"./flip-subtree":64}],67:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.Decision=function(){function e(t,n){o(this,e),this.children=[],this.node=t,this.decisionValue=n,this.key=e.generateKey(this)}return i(e,[{key:"addDecision",value:function(t,n){var o=new e(t,n);return this.children.push(o),this.key=e.generateKey(this),o}},{key:"getDecision",value:function(t){return e.getDecision(this,t)}},{key:"toDecisionString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e.toDecisionString(this,t)}}],[{key:"generateKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$id",n=e.node.childEdges[e.decisionValue],o=e.node[t]+":"+(n[t]?n[t]:e.decisionValue+1);return o.replace(/\n/g," ")}},{key:"getDecision",value:function(t,n){if(t.node===n||t.node.$id===n.$id)return t;for(var o=0;o<t.children.length;o++){var i=e.getDecision(t.children[o],n);if(i)return i}}},{key:"toDecisionString",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=e.generateKey(t,o),a="";return t.children.forEach(function(t){a&&(a+=n?"\n"+i:", "),a+=e.toDecisionString(t,n,o,i+"\t")}),t.children.length&&(a=n?"\n"+i+a:" - ("+a+")"),r+a}}]),e}()},{}],68:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PoliciesCollector=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./policy"),a=e("sd-model"),u=e("sd-utils"),s=e("./decision");n.PoliciesCollector=function(){function e(t,n){var i=this;o(this,e),this.policies=[],this.ruleName=!1,this.ruleName=n,this.collect(t).forEach(function(e,t){i.policies.push(new r.Policy("#"+(t+1),e))}),1===this.policies.length&&(this.policies[0].id="default")}return i(e,[{key:"collect",value:function(e){for(var t,n=this,o=[e],i=[];o.length;)t=o.shift(),this.ruleName&&!t.computedValue(this.ruleName,"optimal")||(t instanceof a.domain.DecisionNode?i.push(t):t.childEdges.forEach(function(e,t){o.push(e.childNode)}));return u.Utils.cartesianProductOf(i.map(function(e){var t=[];return e.childEdges.forEach(function(o,i){if(!n.ruleName||o.computedValue(n.ruleName,"optimal")){var r=n.collect(o.childNode);r.forEach(function(n){var o=new s.Decision(e,i);t.push(o),o.children=n})}}),t}))}}]),e}()},{"./decision":67,"./policy":69,"sd-model":"sd-model","sd-utils":"sd-utils"}],69:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Policy=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./decision");n.Policy=function(){function e(t,n){o(this,e),this.decisions=[],this.id=t,this.decisions=n||[],this.key=e.generateKey(this)}return i(e,[{key:"addDecision",value:function(t,n){var o=new r.Decision(t,n);return this.decisions.push(o),this.key=e.generateKey(this),o}},{key:"equals",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.key==e.key&&(t||this.id===e.id)}},{key:"getDecision",value:function(t){return e.getDecision(this,t)}},{key:"toPolicyString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e.toPolicyString(this,t)}}],[{key:"generateKey",value:function(e){var t="";return e.decisions.forEach(function(e){return t+=(t?"&":"")+e.key}),t}},{key:"getDecision",value:function(e,t){for(var n=0;n<e.decisions.length;n++){var o=r.Decision.getDecision(e.decisions[n],t);if(o)return o}return null}},{key:"toPolicyString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o="";return e.decisions.forEach(function(e){o&&(o+=t?"\n":", "),o+=r.Decision.toDecisionString(e,t,"name","\t")}),n&&void 0!==e.id?e.id+" "+o:o}}]),e}()},{"./decision":67}],70:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PayoffValueValidator=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-expression-engine");e("sd-utils"),n.PayoffValueValidator=function(){function e(t){o(this,e),this.expressionEngine=t}return i(e,[{key:"validate",value:function(e){if(null===e||void 0===e)return!1;var e=r.ExpressionEngine.toNumber(e);return e.compare(Number.MIN_SAFE_INTEGER)>=0&&e.compare(Number.MAX_SAFE_INTEGER)<=0}}]),e}()},{"sd-expression-engine":"sd-expression-engine","sd-utils":"sd-utils"}],71:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProbabilityValueValidator=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("sd-expression-engine");e("sd-utils"),n.ProbabilityValueValidator=function(){function e(t){o(this,e),this.expressionEngine=t}return i(e,[{key:"validate",value:function(e,t){if(null===e||void 0===e)return!1;var e=r.ExpressionEngine.toNumber(e);return e.compare(0)>=0&&e.compare(1)<=0}}]),e}()},{"sd-expression-engine":"sd-expression-engine","sd-utils":"sd-utils"}],72:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TreeValidator=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=(e("sd-utils"),e("sd-model")),a=e("sd-expression-engine"),u=e("./probability-value-validator"),s=e("./payoff-value-validator");n.TreeValidator=function(){function e(t){o(this,e),this.expressionEngine=t,this.probabilityValueValidator=new u.ProbabilityValueValidator(t),this.payoffValueValidator=new s.PayoffValueValidator(t)}return i(e,[{key:"validate",value:function(e){var t=this,n=new r.ValidationResult;return e.forEach(function(e){t.validateNode(e,n)}),n}},{key:"validateNode",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.ValidationResult;if(!(e instanceof r.domain.TerminalNode)){e.childEdges.length||n.addError("incompletePath",e);var o=a.ExpressionEngine.toNumber(0);return e.childEdges.forEach(function(i,u){if(i.setValueValidity("probability",!0),i.setValueValidity("payoff",!0),e instanceof r.domain.ChanceNode){var s=i.computedBaseProbability();t.probabilityValueValidator.validate(s)?o=a.ExpressionEngine.add(o,s):a.ExpressionEngine.isHash(i.probability)||(n.addError({name:"invalidProbability",data:{number:u+1}},e),i.setValueValidity("probability",!1))}var c=i.computedBasePayoff();t.payoffValueValidator.validate(c)||(n.addError({name:"invalidPayoff",data:{number:u+1}},e),i.setValueValidity("payoff",!1))}),e instanceof r.domain.ChanceNode&&(!isNaN(o)&&o.equals(1)||n.addError("probabilityDoNotSumUpTo1",e)),n}}}]),e}()},{"./payoff-value-validator":70,"./probability-value-validator":71,"sd-expression-engine":"sd-expression-engine","sd-model":"sd-model","sd-utils":"sd-utils"}],"sd-computations":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/index");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})})},{"./src/index":6}]},{},[]);
//# sourceMappingURL=sd-computations.min.js.map
